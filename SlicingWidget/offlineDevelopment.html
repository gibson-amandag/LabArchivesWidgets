
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<!-- START:stylesheet
-->

  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/stylesheets/labarchive.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/jquery-ui.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/themes/base/ui.all.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/chosen/chosen.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/DataTables-1.9.3/media/css/jquery.dataTables_themeroller.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/DataTables-1.9.3/extras/TableTools/media/css/TableTools.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/DataTables-1.9.3/extras/ColVis/media/css/ColVis.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/jquery.calculator.package-1.3.2/jquery.calculator.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/freezerbox/jquery.freezerbox.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/freezerbox/jquery.colorselect.css">
          <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/jquery-1.7.2.min.js"></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/jquery-ui-1.9.1.custom.min.js"></script>
                    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/populate/jquery.populate.pack.js" defer="defer"></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/numeric/jquery.numeric.js" defer="defer"></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/jquery.calculator.package-1.3.2/jquery.calculator.js" defer="defer"></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/daepark-postmessage/postmessage.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/forms/widget_proxy.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/forms/parent_form_script.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/forms/database_form_script.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/DataTables-1.9.3/media/js/jquery.dataTables.min.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/DataTables-1.9.3/extras/TableTools/media/js/TableTools.min.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/DataTables-1.9.3/extras/TableTools/media/js/ZeroClipboard.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/DataTables-1.9.3/extras/ColVis/media/js/ColVis.min.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/DataTables-1.9.3/extras/ColResize/ColReorderWithResize.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/chosen/chosen.jquery_modified.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/autoresize/jquery.autoresize.min.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/freezerbox/jquery.freezerbox.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/freezerbox/jquery.colorselect.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/freezerbox/freezerbox_form_script.js" ></script>
    
<title></title>
</head>
<body>
<script>
var form_script = null;
try {
$(document).ready(function () {
      
      
      // Create window var to store the locale for the datepicker
      window.datepicker_locale = '';
//***************************************************************************
//***************************************************************************
//***************************************************************************
//place your javascript code below and when you have it the way you want it
//just paste it into the LA Dev tool
//***************************************************************************
//***************************************************************************
//***************************************************************************
      form_script = my_widget_script =
{
init: function (mode, json_data) {
    //this method is called when the form is being constructed
    // parameters
    // mode = if it equals 'view' than it should not be editable
    //        if it equals 'edit' then it will be used for entry
    //        if it equals 'view_dev' same as view,  does some additional checks that may slow things down in production
    //        if it equals 'edit_dev' same as edit,   does some additional checks that may slow things down in production

    // json_data will contain the data to populate the form with, it will be in the form of the data
    // returned from a call to to_json or empty if this is a new form.
    //By default it calls the parent_class's init.


    /* -----------------------------------------------------------------------------
    ** USE DEBUGGER TO INSPECT AND VIEW CODE
    ** -----------------------------------------------------------------------------
    */

    //debugger;

    /* -----------------------------------------------------------------------------
    ** CREATE jsonString AND parsedJSON VARIABLEs FROM json_data
    ** -----------------------------------------------------------------------------
    */
    var jsonString;
    //check if string or function because preview test is function and page is string
    if (typeof json_data === "string") {
        jsonString = json_data;
    } else {
        jsonString = json_data();
    };
    //Take input string into js object to be able to use elsewhere
    var parsedJson = JSON.parse(jsonString);

    //Uncomment to print parsedJson to consol
    //console.log("init", parsedJson);

    /* -----------------------------------------------------------------------------
    ** CHECK parsedJson FOR INFORMATION NOT CONTAINED IN FORM INPUTS
    **
    ** Content that is created dynamically and therefore not contained wtihin the 
    ** HTML script cannot be passed by the default json_data behavior of LA widgets.
    ** This additional information has to be passed within to_json
        ** This could include something such as row number or the existance of a div
    ** That information that then has to be used here to re-initialize the
    ** appropriate page contents. Use parsedJson.[objectName] to get this data
    ** -----------------------------------------------------------------------------
    */


    /* -----------------------------------------------------------------------------
    ** ADJUST FORM DESIGN AND BUTTONS BASED ON MODE
    
    ** If you do not want a button to be available when not editing disable it here
    ** If you do not want certain elements to be available when not editing,
    ** hide them here
    ** -----------------------------------------------------------------------------
    */

    if (mode !== "edit" && mode !== "edit_dev") {
        //disable when not editing
        $("#calculate").prop("disabled", true)
    };

    /* -----------------------------------------------------------------------------
    ** RESIZE THE CONTENT BOX WHEN THE WINDOW SIZE CHANGES
    ** -----------------------------------------------------------------------------
    */

    window.onresize = my_widget_script.resize;

    /* -----------------------------------------------------------------------------
    ** DEFINE BEHAVIOR WHEN BUTTONS ARE CLICKED OR CHECKBOXES/SELECTIONS CHANGE
    ** -----------------------------------------------------------------------------
    */

    //Show/hide the table
    $("#toggleTable").click(function () { //when the showTable button is clicked, run this function
        //alert("button pressed");
        my_widget_script.resize();
        my_widget_script.data_valid_form(); //run to give error, but allow to calc regardless
        my_widget_script.calcValues();
        $("#tableDiv").toggle();
        //resize the container (need here for when toggle off)
        my_widget_script.parent_class.resize_container();
    });

    //when the calculate button is clicked, run the calcValues function
    $('#calculate').click(function () {
        my_widget_script.data_valid_form(); //run to give error, but allow to calc regardless
        my_widget_script.calcValues();

    });

    //when the toCSV button is clicked, run the exportTableToCSV function
    $('#toCSV').click(function () {
        var data_valid = my_widget_script.data_valid_form();
        //alert(data_valid);
        if (data_valid) {
            my_widget_script.calcValues();
            my_widget_script.exportTableToCSV('mouseData', 'outTable');
        };
    });

    //When the copy button is clicked, run the copyTableRow function
    $("#copyDataButton").click(function () {
        var data_valid = my_widget_script.data_valid_form();
        //alert(data_valid);
        if (data_valid) {
            //alert("I'm clicked");
            my_widget_script.calcValues();
            my_widget_script.copyTableRow();
        } else {
            alert("Nothing was copied");
        };
    });

    //when the showGoogleDoc button is clicked, resize the containers, and toggle visability
    $("#showGoogleDoc").click(function () {
        //alert("button pressed");
        my_widget_script.resize();
        $(".iFrameDiv").toggle();
        //resize the container (need here for when toggle off)
        my_widget_script.parent_class.resize_container();
    });

    //Show/hide elements based on sex
    $("#sex").change(function () { //when sex is changed
        if ($("#sex").val() === "female") {
            $(".female").show() //show female class elements
            $(".male").hide() //hide male class elements
            if ($("#gonadstatus").val() === "intact") {
                $(".cycle").show() //only show cycle if intact is also true
            } else {
                $(".cycle").hide()
            }
        } else if ($("#sex").val() === "male") { //if male
            $(".female").hide() //hide female class elements
            $(".male").show() //show male class elements
            $(".cycle").hide() //hide cycles for male
        } else { //if not selected, hide everything
            $(".female").hide() //hide female class elements
            $(".male").hide() //hide male class elements
            $(".cycle").hide() //hide cycles for male
        };

    });

    //Show/hide elements based on gonad status
    $("#gonadstatus").change(function () { //when gonad status is changed
        if ($("#gonadstatus").val() === "intact") {
            $(".intact").show() //show intact class elements
            $(".gdx").hide() //hide gdx class elements
            if ($("#sex").val() === "female") {
                $(".cycle").show()
            } else {
                $(".cycle").hide()
            }
        } else if ($("#gonadstatus").val() === "gdx") {
            $(".intact").hide() //hide intact class elements
            $(".gdx").show() //show gdx class elements
            $(".cycle").hide()
        } else {
            $(".intact").hide() //hide intact class elements
            $(".gdx").hide() //hide gdx class elements
            $(".cycle").hide() //hide cycle
        }
    });

    $("#implantBox").change(function () {
        if ($("#implantBox").is(":checked")) {
            $(".implant").show() //show implant class elements
        } else {
            $(".implant").hide()
        }
    });

    /* -----------------------------------------------------------------------------
    ** INITIALIZE THE FORM WITH THE STORED WIDGET DATA
    ** -----------------------------------------------------------------------------
    */

    //use the expected LabArchives data (just the stringified widgetData)
    this.parent_class.init(mode, () => JSON.stringify(parsedJson.widgetData));

    /* -----------------------------------------------------------------------------
    ** ADD RED ASTERISKS AFTER REQUIRED FIELDS
    ** -----------------------------------------------------------------------------
    */

    //source: https://stackoverflow.com/questions/18495310/checking-if-an-input-field-is-required-using-jquery

    $('.needForTable').each(function () { //find element with class "needForForm"
        //alert($(this).val());
        $(this).after("<span style='color:blue'>#</span>"); //add # after
    });

    $('#the_form').find('select, textarea, input').each(function () { //find each select field, textarea, and input
        if ($(this).prop('required')) { //if has the attribute "required"
            $(this).after("<span style='color:red'>*</span>"); //add asterisk after
        }
    });

    /* -----------------------------------------------------------------------------
    ** ADD ADDITIONAL FUNCTIONS AND STEPS THAT SHOULD BE TAKEN TO INITIALIZE HTML

    ** For example, ensure that shown/hiden elements are properly displayed
    ** based on the contents of the form
    ** -----------------------------------------------------------------------------
    */
    if ($("#sex").val() === "female") {
        $(".female").show() //show female class elements
        $(".male").hide() //hide male class elements
        if ($("#gonadstatus").val() === "intact") {
            $(".cycle").show() //only show cycle if intact is also true
        } else {
            $(".cycle").hide()
        }
    } else if ($("#sex").val() === "male") { //if male
        $(".female").hide() //hide female class elements
        $(".male").show() //show male class elements
        $(".cycle").hide() //hide cycles for male
    } else { //if not selected, hide everything
        $(".female").hide() //hide female class elements
        $(".male").hide() //hide male class elements
        $(".cycle").hide() //hide cycles for male
    };

    if ($("#gonadstatus").val() === "intact") {
        $(".intact").show() //show intact class elements
        $(".gdx").hide() //hide gdx class elements
        if ($("#sex").val() === "female") {
            $(".cycle").show()
        } else {
            $(".cycle").hide()
        }
    } else if ($("#gonadstatus").val() === "gdx") {
        $(".intact").hide() //hide intact class elements
        $(".gdx").show() //show gdx class elements
        $(".cycle").hide()
    } else {
        $(".intact").hide() //hide intact class elements
        $(".gdx").hide() //hide gdx class elements
        $(".cycle").hide() //hide cycle
    }

    if ($("#implantBox").is(":checked")) {
        $(".implant").show() //show implant class elements
    } else {
        $(".implant").hide()
    };

    //Run the calculate values function to fill with the loaded data
    this.calcValues();

},

to_json: function () {
    //should return a json string containing the data entered into the form by the user
    //whatever is return from the method is persisted in LabArchives.  must not be binary data.
    //called when the user hits the save button, when adding or editing an entry

    /* -----------------------------------------------------------------------------
    ** ACQUIRE INPUT DATA FROM THE FORM
    **
    ** This uses LabArchives's to_json() function to get the form data as a string
    ** -----------------------------------------------------------------------------
    */

    var widgetJsonString = this.parent_class.to_json();

    /* -----------------------------------------------------------------------------
    ** DEFINE ADDITIONAL VARIABLES OR PARAMETERS TO MONITOR DYNAMIC CONTENT
    **
    ** These should be simple variables, such as true/false, a number, or a state
    ** This cannot be something complex like a full <div>
    ** -----------------------------------------------------------------------------
    */

    /* -----------------------------------------------------------------------------
    ** ADD widgetJsonString AND ADDITIONAL VARIABLES TO OUTPUT
    **
    ** This information will be accessed within the init function
    ** -----------------------------------------------------------------------------
    */

    //If you do not need to add additional dynamic content, use this line
    var output = { widgetData: JSON.parse(widgetJsonString) };

    // Define additional output components
    //var output = { widgetData: JSON.parse(widgetJsonString), existsMyContent: existsMyContent };

    //uncomment to check stringified output - note that complicated objects like divs cannot be passed this way
    //console.log("to JSON", JSON.stringify(output));

    /* -----------------------------------------------------------------------------
    ** RETURN STRINGIFIED OUTPUT
    ** -----------------------------------------------------------------------------
    */

    return JSON.stringify(output);
},

from_json: function (json_data) {
    //populates the form with json_data

    // all data into string format within json_data is parsed into an object parsedJson
    var parsedJson = JSON.parse(json_data);

    //use parsedJson to get widgetData and turn into a string
    //parent class uses the widget data to fill in inputs
    this.parent_class.from_json(JSON.stringify(parsedJson.widgetData));
},

test_data: function () {
    //during development this method is called to populate your form while in preview mode

    /* -----------------------------------------------------------------------------
    ** ORIGINAL LABARCHIVES RETURN FOR TEST DATA
    **
    ** note that this will randomly select options for dropdown menus, 
    ** radio buttons, and checkboxes
    ** -----------------------------------------------------------------------------
    */

    //return this.parent_class.test_data();

    /* -----------------------------------------------------------------------------
    ** DEFINE YOUR OWN TEST DATA
    **
    ** note that this will randomly select options for dropdown menus, 
    ** radio buttons, and checkboxes if you still use parent_class.test_data()
    **
    ** Add additional test data infromation based on dynamic content
    ** -----------------------------------------------------------------------------
    */

    //store the outcome of the the test data within the testData variable
    var testData = JSON.parse(this.parent_class.test_data());

    //If no additional dynamic content 
    var output = { widgetData: testData };

    //The additional content should match the objects in to_json
    //var output = { widgetData: testData, existsMyContent: isCheckedAddDiv};

    //return the stringified output for use by the init function
    return JSON.stringify(output);
},

is_valid: function (b_suppress_message) {
    //called when the user hits the save button, to allow for form validation.
    //returns an array of dom elements that are not valid - default is those elements marked as mandatory
    // that have no data in them.
    //You can modify this method, to highlight bad form elements etc...
    //LA calls this method with b_suppress_message and relies on your code to communicate issues to the user
    //Returning an empty array [] or NULL equals no error
    //TO DO write code specific to your form

    /* -----------------------------------------------------------------------------
    ** VALIDATE FORM ENTRY BEFORE SAVING
    **
    ** This function will now check that all fields with the required attribute
    ** are not blank. If there are blank elements, it will return an alert that
    ** provides a fail log with the ids of the elements that are missing
    **
    ** source: source: https://stackoverflow.com/questions/18495310/checking-if-an-input-field-is-required-using-jquery
    ** -----------------------------------------------------------------------------
    */

    var fail = false; //begin with a fail variable that is false
    var fail_log = ''; //begin with an empty fail log
    var name; //create a name variable

    //search the_form for all elements that are of type select, textarea, or input
    $('#the_form').find('select, textarea, input').each(function () {
        if (!$(this).prop('required')) { //if this element does not have a required attribute
            //don't change anything (fail remains false)
        } else { //if there is a required attribute
            if (!$(this).val()) { //if there is not a value for this input
                fail = true; //change fail to true
                name = $(this).attr('id'); //replace the name variable with the name attribute of this element
                fail_log += name + " is required \n"; //add to the fail log that this name is required
            }

        }
    });

    if (fail) { //if fail is true (meaning a required element didn't have a value)
        return alert(fail_log); //return the fail log as an alert
    } else {
        var noErrors = [];
        return noErrors;
    }; //otherwise, return empty array

    /* -----------------------------------------------------------------------------
    ** ORIGINAL LABARCHIVES is_valid FUNCTION
    **
    ** This checks for fields that have _mandatory appended to the name attribute
    ** -----------------------------------------------------------------------------
    */

    //return this.parent_class.is_valid(b_suppress_message);
},

is_edited: function () {
    //should return true if the form has been edited since it was loaded or since reset_edited was called
    return this.parent_class.is_edited();
},

reset_edited: function () {
    //typically called have a save
    //TO DO write code specific to your form
    return this.parent_class.reset_edited();
},

data_valid_form: function () {
    /* -----------------------------------------------------------------------------
    ** VALIDATE FORM ENTRY BEFORE SAVING OR COPYING TABLE
    **
    ** This function will check that elements with a class "needForTable"
    ** are not blank. If there are blank elements, it will return false
    ** and will post an error message "Please fill out all elements marked by a blue #"
    **
    ** source: source: https://stackoverflow.com/questions/18495310/checking-if-an-input-field-is-required-using-jquery
    ** -----------------------------------------------------------------------------
    */

    var valid = true; //begin with a valid value of true
    //var fail_log = ''; //begin with an empty fail log
    //var name; //create a name variable

    //search the_form for all elements that are of class "needForForm"
    $('.needForTable').each(function () {
        if (!$(this).val()) { //if there is not a value for this input
            valid = false; //change valid to false
            //name = $(this).attr('id'); //replace the name variable with the name attribute of this element
            //fail_log += name + " is required \n"; //add to the fail log that this name is required
        }
    });

    if (!valid) {
        $("#errorMsg").html("<span style='color:red; font-size:36px;'>Please fill out all elements marked by a</span><span style='color:blue; font-size:36px;'> blue #</span>");
    } else {
        $("#errorMsg").html("");
    };

    return valid;
},

resize: function () {
    /* -----------------------------------------------------------------------------
    ** resize function
    **
    ** This function can be used to ensure that if a table or other large content
    ** exists on the page or gets created, that it doesn't try to resize the 
    ** entry and push it off of the viewable page within the notebook.
    ** 
    ** This function also resizes the container using the LA parent_class script.
    ** my_widget_script.parent_class.resize_container(); should be called each time
    ** content is created, modified, or deleted within a function.
    ** -----------------------------------------------------------------------------
    */

    //gets the inner width of the window.
    var width = window.innerWidth;

    //TO DO resize any specific divs (such as those with a large table) based on the innerWidth
    $(".tableDiv").width(width * .95); //make width of table div 95% of current width
    $(".iFrameDiv").width(width * .95);

    //resize the container
    my_widget_script.parent_class.resize_container();
},

calcValues: function () {
    /* -----------------------------------------------------------------------------
    ** calcValues function
    **
    ** This function takes the form contents and adds them to the output table.
    ** For elements that are blank or NaN, the function provides an output of NA
    **
    ** The function does not currently require validation in order to provide a
    ** calculation, but this could be easily modified.
    **
    ** my_widget_script.parent_class.resize_container(); is called at the end
    ** -----------------------------------------------------------------------------
    */

    //Add check for validity

    //Mouse ID
    $("#MouseID_calc").text($("#MouseID").val());

    //Cage number
    $("#Cage_calc").text($("#Cage").val());

    //treatment
    //if want text from selected, instead of value $("#Treatment").children("option:selected").text())
    $("#Treatment_calc").text($("#Treatment").val());
    //generic treatment
    if ($("#Treatment_calc").text() === "CON" || //if Treatment_calc equals CON, CON_main, or VEH,
        $("#Treatment_calc").text() === "CON_main" ||
        $("#Treatment_calc").text() === "VEH") {
        $("#GenTreatment_calc").text("Control"); //GenTreatment_calc equals "Control"
    } else {
        $("#GenTreatment_calc").text("PNA") //else equals "PNA"
    }

    //Cycle stage
    if ($("#sex").val() === "female" && $("#gonadstatus").val() === "intact") { //only for intact females
        $("#CycleStage_calc").text($("#CycleStage").val());
    } else {
        $("#CycleStage_calc").text("NA");
    }

    //body mass
    $("#BodyMass_g_calc").text($("#BodyMass_g").val());

    //uterine mass
    if ($("#sex").val() === "female") {
        $("#UterineMass_calc").text($("#gonadMass").val());
    } else {
        $("#UterineMass_calc").text("NA");
    }
    //uterine mass per body mass
    if ($("#sex").val() === "female") {
        var uterine_mg_per_g = $("#gonadMass").val() / $("#BodyMass_g").val();
        $("#Uterine_mg_per_g_calc").text(uterine_mg_per_g.toFixed(4));
    } else {
        $("#Uterine_mg_per_g_calc").text("NA");
    }

    //Date of birth
    $("#Date_of_birth_calc").text($("#Date_of_birth").val());

    //Recording date
    $("#Recording_date_calc").text($("#Recording_date").val());

    //Age in days
    //https://www.geeksforgeeks.org/how-to-calculate-the-number-of-days-between-two-dates-in-javascript/
    var DOBisDay = 1; //change to 0 if want DOB to be day 0
    var Recording_date_as_ms = new Date($("#Recording_date").val()).getTime();
    var DOB_as_ms = new Date($("#Date_of_birth").val()).getTime();
    var Age_in_days = (Recording_date_as_ms - DOB_as_ms) / (1000 * 3600 * 24) + DOBisDay;
    $("#Age_in_days_calc").text(Age_in_days);

    //saved pituitary
    if ($("#Saved_pit").is(":checked")) {
        var Saved_pit = "Y";
    } else {
        var Saved_pit = "N";
    }
    $("#Saved_pit_calc").text(Saved_pit);

    //Daylight savings
    $("#Daylight_Savings_calc").text($("#Daylight_Savings").val());

    //Time of sacrifice
    $("#Time_sac_calc").text($("#Time_sac").val());

    //Hours since lights on
    //http://jsfiddle.net/44NCk/4/
    var time_sac = $("#Time_sac").val().split(":");
    if ($("#Daylight_Savings").val() === "Y") { //if daylight savings time
        var lights_on = "04:00"; //lights on at 4am
        var lights_on_split = lights_on.split(":");
    } else {
        var lights_on = "03:00" //otherwise, lights on at 3a
        var lights_on_split = lights_on.split(":");
    }
    var hours_sac = parseInt(time_sac[0], 10), //get the hours component for time sac
        hours_lights = parseInt(lights_on_split[0], 10),
        min_sac = parseInt(time_sac[1], 10), //get the min component
        min_lights = parseInt(lights_on_split[1], 10);
    var hours = hours_sac - hours_lights, mins = 0; //subtract time of sac from lights on
    if (hours < 0) hours = 24 + hours; //if a negative number, add 24
    if (min_sac >= min_lights) { //if the min time of sac is greater than min time lights on
        mins = min_sac - min_lights; //subtract as is
    } else {
        mins = (min_sac + 60) - min_lights; //otherwise add 60 min and remove an hour
        hours--;
    }

    mins = mins / 60; //divide min by 60 to get decimal
    hours += mins; //add min to hours
    hours = hours.toFixed(3); //three decimal points
    $("#Sac_hr_calc").text(hours);
    $("#Who_calc").text($("#Who").val());

    $("#outTable tr").each(function () { //for each row
        $("td", this).each(function () { //for each cell
            var value = $(this).text(); //get the value of the text
            if (value === "" || value === "NaN" || value === "___") { //if blank or NaN
                $(this).text("NA"); //make NA
            }
        })
    });

    //resize the container
    my_widget_script.parent_class.resize_container();

},

downloadCSV: function (csv, filename) {
    /* -----------------------------------------------------------------------------
    ** downloadCSV function
    **
    ** This function takes a csv element and filename that are passed from the 
    ** exportTableToCSV function.
    **
    ** This creates a csvFile and builds a download link that references this file
    ** The download link is "clicked" by the function to prompt the browser to 
    ** download this file
    **
    ** source: https://www.codexworld.com/export-html-table-data-to-csv-using-javascript/
    ** -----------------------------------------------------------------------------
    */
    var csvFile;
    var downloadLink;

    // CSV file
    csvFile = new Blob([csv], { type: "text/csv" });

    // Download link
    downloadLink = document.createElement("a");

    // File name
    downloadLink.download = filename;

    // Create a link to the file
    downloadLink.href = window.URL.createObjectURL(csvFile);

    // Hide download link
    downloadLink.style.display = "none";

    // Add the link to DOM
    document.body.appendChild(downloadLink);

    // Click download link
    downloadLink.click();
},

exportTableToCSV: function (filename, table) {
    /* -----------------------------------------------------------------------------
    ** exportTableToCSV function
    **
    ** This function takes a filename and table name (both strings) as input
    ** It then creates a csv element from the table
    ** This csv element is passed to the downloadCSV function along with the filename
    ** 
    ** source: https://www.codexworld.com/export-html-table-data-to-csv-using-javascript/
    ** -----------------------------------------------------------------------------
    */

    var csv = [];
    var datatable = document.getElementById(table);
    var rows = datatable.querySelectorAll("tr");

    for (var i = 0; i < rows.length; i++) {
        var row = [], cols = rows[i].querySelectorAll("td, th");

        for (var j = 0; j < cols.length; j++)
            row.push(cols[j].innerText);

        csv.push(row.join(","));
    }

    // Download CSV file
    this.downloadCSV(csv.join("\n"), filename);
},

copyTableRow: function () {
    //create a temporary text area
    var $temp = $("<text" + "area style='opacity:0;'></text" + "area>");
    $("#mouseDataRow").children().each(function () { //add each child of the row
        $temp.text($temp.text() + $(this).text() + "\t")
    });

    $temp.appendTo($('body')).focus().select(); //add temp to body and select
    document.execCommand("copy"); //copy the "selected" text
    $temp.remove(); //remove temp
}
};
//**************************************************************************
//End of your code
//**************************************************************************
//**************************************************************************
      //the parent class functionality is added to your class below.
      form_script.parent_class = parent_form_script;
      //**************************************************************************
      //**************************************************************************
      //call to the init function in your script.  Note that you can change the mode in the call here.
      //your choices are view,view_dev,edit,edit_dev,  see the parent class source for details
      form_script.init("view", function() {return form_script.test_data()});


    }
)

}
catch (e) {

}

parent_form_script.wiget_version_info ={"version":11,"created":"2020-12-13T19:35:35-05:00","last_modified_at":"2020-12-14T14:03:56-05:00","last_modified_by":"Amanda Gibson","owned_by":"unknown"};

</script>
<form id="the_form" style="display:table">
<!------------------------------------------------------------------------------------------>
<!--the html for your tool goes here.  Paste it into the LA dev tool when you have it the way you want it-->
<!------------------------------------------------------------------------------------------>
<style type="text/css">.columns {
display: flex;
flex-wrap: wrap;
column-gap: 2%;
}

.column3 {
flex: 0 30%;
}

.container {
/* display: flex; */
/* flex-wrap: wrap; */
}

.container>div {
/* flex: 0 50%; */
margin-bottom: 5px;
}

.implant {
display: none;
}

.tableDiv {
width: 400px;
overflow-x: scroll;

}

.iFrameDiv {
width: 800px; 
overflow-x: scroll;
padding-left: 2.5%;
display: none;
}
</style>
<h1><span style="font-size:36px;">Slicing</span></h1>

<em>I'm slow to load. Please be patient with me</em>

<p>Elements that are required to save this page are marked with a red asterisk <span style="color:red">*</span><br/>
Elements that are required to copy the table or save to CSV are marked with a blue pound sign <span style="color:blue">#</span></p>

<div class="columns">
<div class="column3">
<div>
<h3>General Info</h3>
</div>

<div class="container">
<div>Experimenter</div>

<div><input class="needForTable" id="Who" name="who" required="" /></div>

<div>Date</div>

<div><input class="needForTable" id="Recording_date" name="slicedate" required="" type="date" /></div>

<div>Time of Sacrifice</div>

<div><input class="needForTable" id="Time_sac" name="sactime" type="time" /></div>

<div>Daylight Savings Time</div>

<div><label for="daylightsaving">Select:</label> <select class="needForTable" id="Daylight_Savings" name="daylightsaving" required=""><option value="">[Select]</option><option value="Y">Daylight Savings Time (summer)</option><option value="N">Standard Time (winter)</option> </select></div>

<div>
<h3>Mouse Information</h3>
</div>

<div>&nbsp;</div>

<div>Mouse ID # or Ear Tag</div>

<div><input class="needForTable" id="MouseID" name="mouseid" required="" /></div>

<div>Transgenic Line</div>

<div><input class="needForTable" id="strain" name="strain" /></div>

<div>Zygosity</div>

<div><label for="zygosity">Select:</label> <select class="needForTable" id="zygosity" name="zygosity" required=""><option value="">[Select]</option><option value="homoPlus">+/+</option><option value="hetero">+/-</option><option value="homoNeg">-/-</option> </select></div>

<div>Cage #</div>

<div><input id="Cage" name="cagenum" /></div>

<div>Date of Birth</div>

<div><input class="needForTable" id="Date_of_birth" name="dob" required="" type="date" /></div>

<div>Treatment</div>

<div><select id="Treatment" name="treatment"><option value="">[Select]</option><option value="CON">Control</option><option value="CON_main">Main colony control</option><option value="VEH">Vehicle</option><option value="DHT">DHT</option> </select></div>

<div>Sex</div>

<div><label for="sex">Select:</label> <select class="needForTable" id="sex" name="sex" required=""><option value="">[Select]</option><option value="female">Female</option><option value="male">Male</option> </select></div>

<div>Body mass (g)</div>

<div><input class="needForTable" id="BodyMass_g" name="bodymass" step="0.1" type="number" /></div>

<div>
<div class="female">Uterine Mass (mg)</div>

<div class="male" style="display: none;">Seminal Vesicle Mass (mg)</div>
</div>

<div><input class="needForTable" id="gonadMass" name="gonadmass" step="0.01" type="number" /></div>

<div>Blood Glucose (mg/100mL)</div>

<div><input id="glucose" name="glucose" step="0.001" type="number" /></div>
</div>
</div>

<div class="column3">
<div>
<h3>Gonadal Status</h3>
</div>

<div class="container">
<div>Gonad Status</div>

<div><label for="gonadstatus">Status:</label> <select class="needForTable" id="gonadstatus" name="gonadstatus" required=""><option value="">[Select]</option><option value="intact">Intact</option><option value="gdx">Gonadectomized</option> </select></div>

<div class="cycle">Cycle Stage</div>

<div class="cycle"><label for="cyclestage">Select:</label> <select id="CycleStage" name="cyclestage"><option value="">[Select]</option><option value="NA">NA</option><option value="D">Diestrus</option><option value="P">Proestrus</option><option value="E">Estrus</option> </select><br />
<label for="stagecomment">Comment:</label> <input name="stagecomment" /></div>

<div class="gdx" style="display: none;">Date of surgery</div>

<div class="gdx" style="display: none;"><input id="surgerydate" name="surgerydate" type="date" /></div>
</div>

<h3>Steroid Implants</h3>

<div class="container">
<div>Implant?</div>

<div><label for="implant">Check if yes:</label> <input id="implantBox" name="implant" type="checkbox" /></div>

<div class="implant">Type of implant</div>

<div class="implant"><select id="implantType" name="implanttype"><option value="">[Select]</option><option value="e2">E2</option><option value="dht">DHT</option><option value="pira">P IRA</option><option value="other">Other</option> </select></div>

<div class="implant">Implant Comment</div>

<div class="implant"><input name="implantcomment" /></div>

<div>
<h3>Samples</h3>
</div>

<div>&nbsp;</div>

<div>Serum Tube Label</div>

<div><input class="needForTable" id="tubeLabel" name="tubelabel" /></div>

<div>Pituitary</div>

<div><label for="pituitary">Saved pituitary</label> <input id="Saved_pit" name="pituitary" type="checkbox" /></div>
</div>
</div>

<div class="column3">
<div>
<h3>Slice Info</h3>
</div>

<div class="container">
<div>Nucleus/Area of Interest</div>

<div><input class="needForTable" id="nucleus" name="nucleus" /></div>

<div>Slicing Orientation</div>

<div><input class="needForTable" id="orientation" name="orientation" /></div>

<div>Quality</div>

<div><label for="slicequal">Select:</label> <select id="slicequal" name="slicequal"><option value="">[Select]</option><option value="good">Good</option><option value="fair">Fair</option><option value="poor">Poor</option> </select><br />
<label for="slicecomment">Comment:</label> <input name="slicecomment" /></div>

<div>Fluorescent Quality</div>

<div><label for="fluorqual">Select:</label> <select id="fluorqual" name="fluorqual"><option value="">[Select]</option><option value="good">Good</option><option value="fair">Fair</option><option value="poor">Poor</option> </select><br />
<label for="fluorcomment">Comment:</label> <input name="fluorcomment" /></div>

<div>
<h3>Solutions</h3>
</div>

<div>&nbsp;</div>

<div>External and addition</div>

<div><input id="externalsoln" name="externalsoln" /></div>

<div>Internal Solution</div>

<div><input id="externalsoln" name="internalsoln" /></div>

<div>Internal Date</div>

<div><input id="internaldate" name="internaldate" type="date" /></div>

<div>Pipette</div>

<div><input id="pipette" name="pipette" /></div>

<div>Date of pipette solution</div>

<div><input id="pipette" name="pipettedate" type="date" /></div>

<div>Pipette Lot</div>

<div><input id="pipettelot" name="pipettelot" /></div>

<div>Internal Solution</div>

<div><input id="internalsoln" name="internalsoln" /></div>
</div>
</div>
</div>
<!--End columns div-->

<p>&nbsp;</p>

<h2>Comments:</h2>

<p><textarea cols="50%" name="comments" rows="5"></textarea><br />
<br />
<input id="toggleTable" name="toggletable" type="button" value="Show/Hide Table" /> <input id="calculate" name="calcvalues" type="button" value="Calculate Values" /> <input id="toCSV" name="tocsv" type="button" value="Save CSV" /> <input id="copyDataButton" name="copydatabutton" type="button" value="Copy Data" /></p>

<div id="errorMsg">&nbsp;</div>

<div class="tableDiv" id="tableDiv" style="display:none">
<table border="1pt" id="outTable">
<tbody>
    <tr>
        <th>MouseID</th>
        <th>Cage</th>
        <th>Treatment</th>
        <th>GenTreatment</th>
        <th>CycleStage</th>
        <th>BodyMass_g</th>
        <th>UterineMass</th>
        <th>Uterine_mg_per_g</th>
        <th>Date_of_birth</th>
        <th>Recording_date</th>
        <th>Age_in_days</th>
        <th>Saved_pit</th>
        <th>Daylight_Savings</th>
        <th>Time_sac</th>
        <th>Sac_hr</th>
        <th>Who</th>
    </tr>
    <tr id="mouseDataRow">
        <td id="MouseID_calc">&nbsp;</td>
        <td id="Cage_calc">&nbsp;</td>
        <td id="Treatment_calc">&nbsp;</td>
        <td id="GenTreatment_calc">&nbsp;</td>
        <td id="CycleStage_calc">&nbsp;</td>
        <td id="BodyMass_g_calc">&nbsp;</td>
        <td id="UterineMass_calc">&nbsp;</td>
        <td id="Uterine_mg_per_g_calc">&nbsp;</td>
        <td id="Date_of_birth_calc">&nbsp;</td>
        <td id="Recording_date_calc">&nbsp;</td>
        <td id="Age_in_days_calc">&nbsp;</td>
        <td id="Saved_pit_calc">&nbsp;</td>
        <td id="Daylight_Savings_calc">&nbsp;</td>
        <td id="Time_sac_calc">&nbsp;</td>
        <td id="Sac_hr_calc">&nbsp;</td>
        <td id="Who_calc">&nbsp;</td>
    </tr>
</tbody>
</table>

<p>&nbsp;</p>
</div>

<div><input id="showGoogleDoc" name="showgoogledoc" type="button" value="Show/Hide Google Doc" /> or <big><a href="https://docs.google.com/spreadsheets/d/18s84qpAjEYcbvC4cn_6BaMAZXi8em_mEMkldO7pK_0Y/edit?usp=sharing" target="_blank">click here</a></big> to open the Google Sheet in a new window<br />
<label for="enteredDatatoDoc">Have you copied the data into the Google Doc?</label> <select id="enteredDatatoDoc" name="entereddatatodoc" required=""><option value="">[Select]</option><option value="no">Not yet</option><option value="yes">Yes!</option> </select></div>

<div class="iFrameDiv">
<div id="labGoogleSheet"><iframe frameborder="0" height="600" scrolling="auto" src="https://docs.google.com/spreadsheets/d/18s84qpAjEYcbvC4cn_6BaMAZXi8em_mEMkldO7pK_0Y/edit?usp=sharing" style="border:0" width="800"></iframe></div>
</div>

<div id="hiddenDiv" style="display:none"><textarea id="forCopying" name="forcopying"></textarea></div>

<!------------------------------------------------------------------------------------------>
<!--end of your code-->
<!------------------------------------------------------------------------------------------>

</form>
</body>
</html>