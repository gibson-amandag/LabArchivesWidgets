my_widget_script={init:function(mode,json_data){this.include("https://code.jquery.com/jquery-3.5.1.min.js","sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=","anonymous",()=>{$(document).ready(()=>{
this.include("https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js","sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl","anonymous",()=>{$(document).ready(()=>{
this.include("https://cdn.jsdelivr.net/npm/luxon@1.26.0/build/global/luxon.min.js","sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0=","anonymous",()=>{$(document).ready(()=>{
this.include("https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.min.js","sha512-RdSPYh1WA6BF0RhpisYJVYkOyTzK4HwofJ3Q7ivt/jkpW6Vc8AurL1R+4AUcvn9IwEKAPm/fk7qFZW3OuiUDeg==","anonymous",()=>{$(document).ready(()=>{$jq351=jQuery.noConflict(true),this.myInit(mode,json_data)})})})})})})})})},
include:function(src,integrity,crossorigin,onload){var head=document.getElementsByTagName("head")[0],script=document.createElement("script");script.setAttribute("integrity",integrity),script.setAttribute("crossorigin",crossorigin),script.src=src,script.type="text/javascript",
script.onload=script.onreadystatechange=function(){if(script.readyState){if("complete"===script.readyState||"loaded"===script.readyState)script.onreadystatechange=null,onload()}else onload()},head.appendChild(script)},myInit:function(mode,json_data){var parsedJson=this.parseInitJson(json_data)
;this.initDynamicContent(parsedJson),window.onresize=this.resize,this.addEventListeners(),this.parent_class.init(mode,()=>JSON.stringify(parsedJson.widgetData)),this.addRequiredFieldIndicators(),this.setUpInitialState(),this.adjustForMode(mode)},to_json:function(){
var widgetJsonString=this.parent_class.to_json(),dynamicContent=this.getDynamicContent(),output={widgetData:JSON.parse(widgetJsonString),addedRows:dynamicContent.addedRows};return JSON.stringify(output)},from_json:function(json_data){var parsedJson=JSON.parse(json_data)
;this.parent_class.from_json(JSON.stringify(parsedJson.widgetData))},test_data:function(){var testData=JSON.parse(this.parent_class.test_data()),output={widgetData:testData,addedRows:3};return JSON.stringify(output)},is_valid:function(b_suppress_message){var fail=false,fail_log="",name
;if($("#the_form").find("select, textarea, input").each(function(){if(!$(this).prop("required"));else if(!$(this).val())fail=true,name=$(this).attr("id"),fail_log+=name+" is required \n"}),$("input[type='date']").each(function(){var date=$(this).val();if(date){
var validDate=my_widget_script.isValidDate(date);if(!validDate)fail=true,fail_log+="Please enter valid date in form 'YYYY-MM-DD'"}}),$("input[type='time']").each(function(){var time=$(this).val();if(time){var validtime=my_widget_script.isValidTime(time);if(!validtime)fail=true,
fail_log+="Please enter valid time in form 'hh:mm' - 24 hr time"}}),fail)return bootbox.alert(fail_log);else{var noErrors=[];return noErrors}},is_edited:function(){return this.parent_class.is_edited()},reset_edited:function(){return this.parent_class.reset_edited()},
parseInitJson:function(json_data){var jsonString;if("string"===typeof json_data)jsonString=json_data;else jsonString=json_data();var parsedJson=JSON.parse(jsonString);return parsedJson},initDynamicContent:function(parsedJson){for(var i=0;i<parsedJson.addedRows;i++){var tableName=$("#dataTable")
;my_widget_script.createRow(tableName)}},adjustForMode:function(mode){if("edit"!==mode&&"edit_dev"!==mode)$(".disableOnView").prop("disabled",true)},addEventListeners:function(){$("#addRow").on("click",function(){var $table=$("#dataTable");my_widget_script.createRow($table),
my_widget_script.calcSpontLength(),$("#errorMsg").text("")}),$("#removeRow").on("click",e=>{var $table=$("#dataTable");this.deleteRow($table,e.currentTarget),this.calcSpontLength(),$("#errorMsg").text("")}),$("#toCSV").on("click",function(){
var fileName="recordingInfo_"+$("#cellid").val(),$datatable=$("#dataTable"),$errorMsg=$("#errorMsg");my_widget_script.toCSVFuncs(fileName,$datatable,$errorMsg)}),$("#copyDataButton").on("click",function(){
var $copyHead=$("#copyHead"),$tableToCopy=$("#dataTable"),$tableDiv=$("#seriesDiv"),$errorMsg=$("#errorMsg"),$divForCopy=$("#forCopy");my_widget_script.copyDataFuncs($copyHead,$tableToCopy,$tableDiv,$errorMsg,$divForCopy)}),$("#seriesLength").on("input",function(){my_widget_script.calcSpontLength()
}),$("#addEvent").on("click",function(){if(""==!$("#eventLog").val())addLine="\n";else addLine="";var textToAdd=addLine+new Date+" during Series # "+$("#whichSeries").val()+": "+$("#eventName").val()+"\n ---------";$("#eventLog").val($("#eventLog").val()+textToAdd).each(function(){
this.style.height="auto",this.style.height=this.scrollHeight+"px",my_widget_script.resize()})}),$("#calcSpont").on("change",function(){if($(this).is(":checked"))my_widget_script.calcSpontLength();else $("#spontLength").val("")})},addRequiredFieldIndicators:function(){
$(".needForTableLab").each(function(){$(this).html("<span style='color:blue'>#</span>"+$(this).html())}),$(".requiredLab").each(function(){$(this).html("<span style='color:red'>*</span>"+$(this).html())})},isValidTime:function(timeString){var regEx="^(((([0-1][0-9])|(2[0-3])):[0-5][0-9]))$"
;if(!timeString.match(regEx))return false;else return true},isTimeSupported:function(){var input=document.createElement("input");input.setAttribute("type","time");var supported=true;if("time"!==input.type)supported=false;return my_widget_script.timeSupported=supported,supported},timeSupported:true,
checkTimeFormat:function($timeInput){if(!my_widget_script.timeSupported){$timeInput.next(".timeWarning").remove();var time=$timeInput.val(),isValid=my_widget_script.isValidTime(time);if(!isValid)$timeInput.after('<div class="text-danger timeWarning">Enter time as "hh:mm" in 24-hr format</div>')
;my_widget_script.resize()}},isValidDate:function(dateString){var regEx=/^\d{4}-\d{2}-\d{2}$/;if(!dateString.match(regEx))return false;var d=new Date(dateString),dNum=d.getTime();if(!dNum&&0!==dNum)return false;return d.toISOString().slice(0,10)===dateString},isDateSupported:function(){
var input=document.createElement("input");input.setAttribute("type","date");var supported=true;if("date"!==input.type)supported=false;return my_widget_script.dateSupported=supported,supported},dateSupported:true,checkDateFormat:function($dateInput){if(!my_widget_script.dateSupported){
$dateInput.next(".dateWarning").remove();var date=$dateInput.val(),isValid=my_widget_script.isValidDate(date);if(!isValid)$dateInput.after('<div class="text-danger dateWarning">Enter date as "YYYY-MM-DD"</div>');$dateInput.datepicker({dateFormat:"yy-mm-dd"}),my_widget_script.resize()}},
setUpInitialState:function(){my_widget_script.isDateSupported(),my_widget_script.isTimeSupported(),$("input[type='date']").prop("placeholder","YYYY-MM-DD").on("change",function(){my_widget_script.checkDateFormat($(this))}).each(function(){my_widget_script.checkDateFormat($(this))}),
$("input[type='time']").prop("placeholder","hh:mm").on("change",function(){my_widget_script.checkTimeFormat($(this))}).each(function(){my_widget_script.checkTimeFormat($(this))}),$(".myLeftCol").addClass("col-12 col-sm-6 col-md-4 col-lg-3 text-left text-sm-right"),
$("textarea.autoAdjust").each(function(){this.setAttribute("style","height:"+this.scrollHeight+"px;overflow-y:hidden;")}).on("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px",my_widget_script.resize()}),my_widget_script.resize()},resize:function(){
my_widget_script.parent_class.resize_container()},getDynamicContent:function(){var addedRows=$("#dataTable").find("tbody tr").length,dynamicContent={addedRows:addedRows};return dynamicContent},data_valid_form:function(){var valid=true
;if(!valid)$("#errorMsg").html("<span style='color:red; font-size:36px;'>Please fill out all elements marked by a</span><span style='color:blue; font-size:36px;'> blue #</span>");else $("#errorMsg").html("");return valid},downloadCSV:function(csv,filename){var csvFile,downloadLink
;csvFile=new Blob([csv],{type:"text/csv"}),downloadLink=document.createElement("a"),downloadLink.download=filename,downloadLink.href=window.URL.createObjectURL(csvFile),downloadLink.style.display="none",document.body.appendChild(downloadLink),downloadLink.click()},
exportTableToCSV:function(filename,$datatable){var csv=[];csv=['"Series","Resistance (MOhm)","Time","Series type","Notes"'],console.log(csv),$datatable.find("tbody").find("tr").each(function(){var row=[];$(this).find("td").each(function(){console.log("The value is: "+$(this).children().val())
;var cellText='"'+$(this).children().val()+'"';row.push(cellText),console.log(row)}),csv.push(row.join(",")),console.log(csv)}),this.downloadCSV(csv.join("\n"),filename)},copyTable:function($table,copyHead,$divForCopy){var $temp=$("<text"+"area style='opacity:0;'></text"+"area>"),addLine=""
;if(copyHead)$temp.text("Series\tResistance (Mâ„¦)\tTime\tSeries type\tBath temp\tNotes"),addLine="\n";$table.find("tbody").children("tr").each(function(){$temp.text($temp.text()+addLine);var addTab="";$(this).find("td").each(function(){
if($(this).children().val())var addText=$(this).children().val();else var addText="NA";$temp.text($temp.text()+addTab+addText),addTab="\t",addLine="\n"})}),$temp.appendTo($divForCopy).focus().select(),document.execCommand("copy"),$temp.remove()},toCSVFuncs:function(fileName,$datatable,$errorMsg){
var data_valid=my_widget_script.data_valid_form();if(data_valid)my_widget_script.exportTableToCSV(fileName,$datatable),$errorMsg.html("<span style='color:grey; font-size:24px;'>Saved successfully</span>");else $errorMsg.append("<br/><span style='color:grey; font-size:24px;'>Did not export</span>")},
copyDataFuncs:function($copyHead,$tableToCopy,$tableDiv,$errorMsg,$divForCopy){var data_valid=my_widget_script.data_valid_form(),copyHead;if($copyHead.is(":checked"))copyHead=true;else copyHead=false;if(data_valid)$tableDiv.show(),my_widget_script.resize(),
my_widget_script.copyTable($tableToCopy,copyHead,$divForCopy),$errorMsg.html("<span style='color:grey; font-size:24px;'>Copied successfully</span>");else $errorMsg.append("<br/><span style='color:grey; font-size:24px;'>Nothing was copied</span>")},calcSpontLength:function(){
if($("#calcSpont").is(":checked")){var spontSeriesNum=0;$("#dataTable tbody").find("select").each(function(){if("Spontaneous"===$(this).val())spontSeriesNum++});var seriesLength=parseInt($("#seriesLength").val());if(seriesLength)$("#spontLength").val(spontSeriesNum*seriesLength)}},
createRow:function(tableName){var rowCount=$(tableName).find("tbody tr").length+1,rowID="Row_"+rowCount,col1ID="series_"+rowCount,col2ID="resistance_"+rowCount,col3ID="seriestime_"+rowCount,col4ID="seriestype_"+rowCount,col5ID="notes_"+rowCount,colTempID="temp_"+rowCount
;$(tableName).find("tbody").append($('<tr style="font-size: 0.8rem"></tr>',{id:rowID}).append($("<td></td>").append($("<input/>",{id:col1ID,name:col1ID,type:"number",min:"1",step:"1",class:"needForTable"}).css("width","7ex"))).append($("<td></td>").append($("<input/>",{id:col2ID,name:col2ID,
type:"number",min:"0",step:"0.01",class:"needForTable"}).css("width","8ex"))).append($("<td></td>").append($("<input/>",{id:col3ID,name:col3ID,type:"time",class:"needForTable",placeholder:"hh:mm"}).each(function(){my_widget_script.checkTimeFormat($(this))}).on("change",function(){
my_widget_script.checkTimeFormat($(this))}))).append($("<td></td>").append($("<select></select>",{id:col4ID,name:col4ID,class:"needForTable"
}).append("<option value=''>[Select]</option>","<option value='Stabilization'>Stabilization</option>","<option value='Spontaneous'>Spontaneous</option>","<option value='Addition'>Addition</option>","<option value='Washout'>Washout</option>").on("change",function(){my_widget_script.calcSpontLength()
}))).append($("<td></td>").append($("<input/>",{id:colTempID,name:colTempID,type:"number",min:"0",step:"1",class:"needForTable"}).css("width","8ex"))).append($("<td></td>").append($("<text"+"area></text"+"area>",{id:col5ID,name:col5ID,rows:1,class:"autoAdjust"}).on("input",function(){
this.style.height="auto",this.style.height=this.scrollHeight+"px",my_widget_script.resize()}))));var previousSeries=$("#series_"+(rowCount-1)).val();if(previousSeries)$("#series_"+rowCount).val(parseInt(previousSeries)+1);else $("#series_"+rowCount).val(rowCount)
;$("#whichSeries").val($("#series_"+rowCount).val()),my_widget_script.resize()},deleteRow:function(tableName,elForHeight=null){this.runIfConfirmed("Are you sure you want to remove the row?",()=>{var lastRow=$(tableName).find("tbody tr").last();$(lastRow).remove(),this.resize()
},elForHeight=elForHeight)},getOffsetTop:function(element){var offsetTop=0,lastElement=0;while(element&&!lastElement){var formChild=$(element).children("#the_form");if(formChild.length>0)lastElement=1;offsetTop+=element.offsetTop,element=element.offsetParent}return offsetTop},
runIfConfirmed:function(text,functionToCall,elForHeight=null){var thisMessage="Are you sure?";if(text)thisMessage=text;var top="auto";if(elForHeight)top=this.getOffsetTop(elForHeight)+"px";bootbox.confirm({message:thisMessage,callback:proceed=>{if(proceed)functionToCall()}}),
$(".modal-dialog").css("top",top)},dialogConfirmx:function(text,functionToCall,elForHeight=null){var thisMessage="Do you want to proceed?";if(text)thisMessage=text;var top="auto";if(elForHeight)top=this.getOffsetTop(elForHeight)+"px";bootbox.confirm({message:thisMessage,callback:result=>{
functionToCall(result)}}),$(".modal-dialog").css("top",top)},runBasedOnInput:function(prompt,functionToCall,elForHeight=null,defValue=null){var thisTitle="Enter value:";if(prompt)thisTitle=prompt;var top="auto";if(elForHeight)top=this.getOffsetTop(elForHeight)+"px";bootbox.prompt({title:thisTitle,
callback:result=>{functionToCall(result)},value:defValue}),$(".modal-dialog").css("top",top)}};