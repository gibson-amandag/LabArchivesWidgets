my_widget_script={init:function(mode,json_data){this.include("https://code.jquery.com/jquery-3.5.1.min.js","sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=","anonymous",()=>{$(document).ready(()=>{
this.include("https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js","sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl","anonymous",()=>{$(document).ready(()=>{
this.include("https://cdn.jsdelivr.net/npm/luxon@1.26.0/build/global/luxon.min.js","sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0=","anonymous",()=>{$(document).ready(()=>{
this.include("https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.min.js","sha512-RdSPYh1WA6BF0RhpisYJVYkOyTzK4HwofJ3Q7ivt/jkpW6Vc8AurL1R+4AUcvn9IwEKAPm/fk7qFZW3OuiUDeg==","anonymous",()=>{$(document).ready(()=>{$jq351=jQuery.noConflict(true),this.myInit(mode,json_data)})})})})})})})})},
include:function(src,integrity,crossorigin,onload){var head=document.getElementsByTagName("head")[0],script=document.createElement("script");script.setAttribute("integrity",integrity),script.setAttribute("crossorigin",crossorigin),script.src=src,script.type="text/javascript",
script.onload=script.onreadystatechange=function(){if(script.readyState){if("complete"===script.readyState||"loaded"===script.readyState)script.onreadystatechange=null,onload()}else onload()},head.appendChild(script)},myInit:function(mode,json_data){$("#VCcardDiv").text("")
;var parsedJson=this.parseInitJson(json_data);this.initDynamicContent(parsedJson),window.onresize=(()=>this.resize()),this.addEventListeners(),this.parent_class.init(mode,()=>JSON.stringify(parsedJson.widgetData)),this.addRequiredFieldIndicators(),this.setUpInitialState(),this.adjustForMode(mode),
this.checkForNames()},to_json:function(){var widgetJsonString=this.parent_class.to_json(),dynamicContent=this.getDynamicContent(),output={widgetData:JSON.parse(widgetJsonString),VCSeriesNums:this.VCSeriesNums};return JSON.stringify(output)},from_json:function(json_data){
var parsedJson=JSON.parse(json_data);this.parent_class.from_json(JSON.stringify(parsedJson.widgetData))},test_data:function(){var testData=JSON.parse(this.parent_class.test_data()),output={widgetData:testData,VCSeriesNums:[1,4,5]};return JSON.stringify(output)},is_valid:function(b_suppress_message){
var fail=false,fail_log="",name;if($("#the_form").find("select, textarea, input").each((i,e)=>{if(!$(e).prop("required"));else if(!$(e).val())fail=true,name=$(e).attr("id"),fail_log+=name+" is required \n"}),$("input[type='date']").each((i,e)=>{var date=$(e).val();if(date){
var validDate=this.isValidDate(date);if(!validDate)fail=true,fail_log+="Please enter valid date in form 'YYYY-MM-DD'"}}),$("input[type='time']").each((i,e)=>{var time=$(e).val();if(time){var validtime=this.isValidTime(time);if(!validtime)fail=true,
fail_log+="Please enter valid time in form 'hh:mm' - 24 hr time"}}),fail)return bootbox.alert (fail_log);else{var noErrors=[];return noErrors}},is_edited:function(){return this.parent_class.is_edited()},reset_edited:function(){return this.parent_class.reset_edited()},
parseInitJson:function(json_data){var jsonString;if("string"===typeof json_data)jsonString=json_data;else jsonString=json_data();var parsedJson=JSON.parse(jsonString);return parsedJson},initDynamicContent:function(parsedJson){if(parsedJson.VCSeriesNums){this.VCSeriesNums=parsedJson.VCSeriesNums
;for(var i=0;i<parsedJson.VCSeriesNums.length;i++){var seriesNum=parsedJson.VCSeriesNums[i];this.makeVCcard(seriesNum)}}},adjustForMode:function(mode){if("edit"!==mode&&"edit_dev"!==mode)$(".disableOnView").prop("disabled",true),$("input[type='date']").removeClass(".hasDatePicker"),
$(".hideView").hide();else $("input[type='date']").each((i,e)=>{this.checkDateFormat($(e))}),$("input[type='time']").each((i,e)=>{this.checkTimeFormat($(e))})},addEventListeners:function(){},addRequiredFieldIndicators:function(){$(".needForTableLab").each((i,e)=>{
$(e).html("<span class='hideView' style='color:blue'>#</span>"+$(e).html())}),$(".requiredLab").each((i,e)=>{$(e).html("<span class='hideView' style='color:red'>*</span>"+$(e).html())})},isValidTime:function(timeString){var regEx="^(((([0-1][0-9])|(2[0-3])):[0-5][0-9]))$"
;if(!timeString.match(regEx))return false;else return true},isTimeSupported:function(){var input=document.createElement("input");input.setAttribute("type","time");var supported=true;if("time"!==input.type)supported=false;return this.timeSupported=supported,input.remove(),supported},
timeSupported:true,checkTimeFormat:function($timeInput){if(!this.timeSupported){$timeInput.next(".timeWarning").remove();var time=$timeInput.val(),isValid=this.isValidTime(time);if(!isValid)$timeInput.after('<div class="text-danger timeWarning">Enter time as "hh:mm" in 24-hr format</div>')
;this.resize()}},isValidDate:function(dateString){var regEx=/^\d{4}-\d{2}-\d{2}$/;if(!dateString.match(regEx))return false;var d=new Date(dateString),dNum=d.getTime();if(!dNum&&0!==dNum)return false;return d.toISOString().slice(0,10)===dateString},isDateSupported:function(){
var input=document.createElement("input");input.setAttribute("type","date");var supported=true;if("date"!==input.type)supported=false;return this.dateSupported=supported,input.remove(),supported},dateSupported:true,checkDateFormat:function($dateInput){if(!this.dateSupported){
$dateInput.next(".dateWarning").remove();var date=$dateInput.val(),isValid=this.isValidDate(date);if(!isValid)$dateInput.after('<div class="text-danger dateWarning">Enter date as "YYYY-MM-DD"</div>');$dateInput.datepicker({dateFormat:"yy-mm-dd"}),this.resize()}},setUpInitialState:function(){
$(".myLeftCol").addClass("col-12 col-sm-6 col-md-4 col-lg-3 text-left text-sm-right"),this.isDateSupported(),this.isTimeSupported(),$("input[type='date']").prop("placeholder","YYYY-MM-DD").on("change",e=>{this.checkDateFormat($(e.currentTarget))}),
$("input[type='time']").prop("placeholder","hh:mm").on("change",e=>{this.checkTimeFormat($(e.target))}),$("textarea.autoAdjust").each((i,e)=>{e.setAttribute("style","height:"+e.scrollHeight+"px;overflow-y:hidden;")}).on("input",e=>{e.target.style.height="auto",
e.target.style.height=e.target.scrollHeight+"px",this.resize()}),$(".toggleTable").on("click",e=>{var tableID=$(e.currentTarget).data("table"),$table=$("#"+tableID);this.toggleTableFuncs($table)}),$(".toCSV").on("click",e=>{
var tableID=$(e.currentTarget).data("table"),dateToday=luxon.DateTime.now().toISODate(),fileName="table_"+tableID+"_"+dateToday,$errorMsg=$("#errorMsg");this.toCSVFuncs(fileName,tableID,$errorMsg)}),$(".copyData").on("click",e=>{
var tableID=$(e.currentTarget).data("table"),tableSearch=this.tableSearch(tableID),$copyHead=$(".copyHead"+tableSearch),$transpose=$(".transpose"+tableSearch),$tableToCopy=$("#"+tableID),$tableDiv=$tableToCopy.parent(),$errorMsg=$("#errorMsg"),$divForCopy=$("#forCopy")
;this.copyDataFuncs($copyHead,$tableToCopy,$tableDiv,$errorMsg,$divForCopy,$transpose)}),$("#the_form").on("input",e=>{if($(e.target).data("watch"))this.watchValue($(e.target));else this.updateCalcFromEl(e.target)}),$("input, select, textarea").each((i,e)=>{
if("button"!=$(e).attr("type"))if($(e).data("watch"))this.watchValue($(e));else this.updateCalcFromEl(e)}),$("#internalSoln").each((i,e)=>{this.showOther($(e))}).on("click",e=>{this.showOther($(e.currentTarget))}),$("#addVCseries").on("click",e=>{this.addVCseries()}),this.resize()},VCSeriesNums:[],
resize:function(){this.parent_class.resize_container()},checkForNames:function(){$("input, select, textarea").each((i,e)=>{var thisName=$(e).attr("name");if(!thisName)console.log("There is no name attribute for: ",e.id);else{var hasUpper=/[A-Z]/.test(thisName)
;if(hasUpper)console.log("The name contains an uppercase letter for: ",e.id)}})},getDynamicContent:function(){var dynamicContent={};return dynamicContent},data_valid_form:function($errorMsg){var valid=true,fail_log=$("<div></div>").append("Missing values for:"),name
;if($(".needForTable").each((i,e)=>{if(!$(e).val())valid=false,name=$(e).attr("id"),fail_log.append("<br/>"+name)}),!valid)$errorMsg.html("<span style='color:red; font-size:36px;'>"+"Please fill out all elements marked by a"+"</span><span style='color:blue; font-size:36px;'>"+" blue #"+"</span>"),
$errorMsg.append(fail_log);else $errorMsg.html("");return this.resize(),valid},runIfConfirmed:function(text,functionToCall,elForHeight=null){var thisMessage="Are you sure?";if(text)thisMessage=text;var top="auto";if(elForHeight)top=elForHeight.offsetTop+"px";bootbox.confirm ({message:thisMessage,
callback:proceed=>{if(proceed)functionToCall()}}),$(".modal-dialog").css("top",top)},dialogConfirm:function(text,functionToCall,elForHeight=null){var thisMessage="Do you want to proceed?";if(text)thisMessage=text;var top="auto";if(elForHeight)top=elForHeight.offsetTop+"px";bootbox.confirm ({
message:thisMessage,callback:result=>{functionToCall(result)}}),$(".modal-dialog").css("top",top)},runBasedOnInput:function(prompt,functionToCall,elForHeight=null){var thisTitle="Enter value:";if(prompt)thisTitle=prompt;var top="auto";if(elForHeight)top=elForHeight.offsetTop+"px";bootbox.prompt({
title:thisTitle,callback:result=>{functionToCall(result)}}),$(".modal-dialog").css("top",top)},checkInArray:function(searchVal,array){var proceed=-1!==$.inArray(searchVal,array);return proceed},dataSearch:function(dataName,dataValue){var dataSearch="[data-"+dataName+"='"+dataValue+"']"
;return dataSearch},tableSearch:function(table){var tableSearch=this.dataSearch("table",table);return tableSearch},calcSearch:function(calc){var calcSearch=this.dataSearch("calc",calc);return calcSearch},daySearch:function(day){var daySearch=this.dataSearch("day",day);return daySearch},
mouseSearch:function(mouse){var mouseSearch=this.dataSearch("mouse",mouse);return mouseSearch},seriesSearch:function(seriesNum){var seriesSearch=this.dataSearch("series",seriesNum);return seriesSearch},updateCalcFromEl:function(el){var calc=el.id,val=el.value,calcSearch=this.calcSearch(calc)
;$(calcSearch).html(val),this.resize()},updateCalcFromVal:function(calc,val){var calcSearch=this.calcSearch(calc);$(calcSearch).text(val),this.resize()},watchValue:function($el){
var watch=$el.data("watch"),calcSearch=my_widget_script.calcSearch(watch),dayNum=$el.data("day"),mouseNum=$el.data("mouse"),seriesNum=$el.data("series"),val=$el.val();if(dayNum)calcSearch+=my_widget_script.daySearch(dayNum);if(mouseNum)calcSearch+=my_widget_script.mouseSearch(mouseNum)
;if(seriesNum)calcSearch+=my_widget_script.seriesSearch(seriesNum);if("mouse"==watch)if(!val)val="Mouse "+mouseNum;if("seriesNum"==watch)if(!val)val=seriesNum;$(calcSearch).html(val),my_widget_script.resize()},showOther:function($el){if("other"===$el.val()){
var $other=$el.next(".ifOther").show(),thisScrollHeight=$other.prop("scrollHeight");$other.css("height",thisScrollHeight).css("overflow-y","hidden")}else $el.next(".ifOther").hide();this.resize()},toggleTableFuncs:function($table){this.data_valid_form(),$table.toggle(),this.resize()},
toCSVFuncs:function(fileName,tableID,$errorMsg){var data_valid=this.data_valid_form($errorMsg);if(data_valid)this.exportTableToCSV(fileName,tableID),
$errorMsg.html("<span style='color:grey; font-size:24px;'>Saved successfully</span>");else $errorMsg.append("<br/><span style='color:grey; font-size:24px;'>Did not export</span>")},downloadCSV:function(csv,filename){var csvFile,downloadLink;csvFile=new Blob([csv],{type:"text/csv"}),
downloadLink=document.createElement("a"),downloadLink.download=filename,downloadLink.href=window.URL.createObjectURL(csvFile),downloadLink.style.display="none",document.body.appendChild(downloadLink),downloadLink.click()},exportTableToCSV:function(filename,table){
for(var csv=[],datatable=document.getElementById(table),rows=datatable.querySelectorAll("tr"),i=0;i<rows.length;i++){for(var row=[],cols=rows[i].querySelectorAll("td, th"),j=0;j<cols.length;j++){var cellText='"'+cols[j].innerText+'"';row.push(cellText)}csv.push(row.join(","))}
this.downloadCSV(csv.join("\n"),filename)},copyDataFuncs:function($copyHead,$tableToCopy,$tableDiv,$errorMsg,$divForCopy,$transpose){var data_valid=this.data_valid_form($errorMsg),copyHead=false,transpose=false;if($copyHead.is(":checked"))copyHead=true;if($transpose.is(":checked"))transpose=true
;if(data_valid)$tableDiv.show(),this.resize(),this.copyTable($tableToCopy,copyHead,$divForCopy,transpose),$errorMsg.html("<span style='color:grey; font-size:24px;'>Copied successfully</span>");else $errorMsg.append("<br/><span style='color:grey; font-size:24px;'>Nothing was copied</span>")},
copyTable:function($table,copyHead,$divForCopy,transpose){var $temp=$("<text"+"area style='opacity:0;'></text"+"area>"),rows=[],rowNum=0;if(copyHead)$table.find("thead").children("tr").each((i,e)=>{if(transpose)rowNum=0;if($(e).find("td, th").each((i,e)=>{if(void 0===rows[rowNum])rows[rowNum]=[]
;if(rows[rowNum].push($(e).text()),transpose)rowNum++}),!transpose)rowNum++});$table.find("tbody").children("tr").each((i,e)=>{if(transpose)rowNum=0;if($(e).find("td, th").each((i,e)=>{if(void 0===rows[rowNum])rows[rowNum]=[];if(rows[rowNum].push($(e).text()),transpose)rowNum++}),!transpose)rowNum++
});for(var i=0;i<rows.length;i++)rows[i]=rows[i].join("\t");$temp.append(rows.join("\n")),$temp.appendTo($divForCopy).select(),document.execCommand("copy"),$temp.remove()},toggleCard:function($cardHead){$cardHead.next().toggleClass("collapse"),
$cardHead.next().find("textarea.autoAdjust").each((i,e)=>{if(!$(e).is(":hidden"))e.setAttribute("style","height:"+e.scrollHeight+"px;overflow-y:hidden;")}),this.resize()},makeCard:function($div,cardHeadContent,cardBodyContent){$div.append($("<div></div>",{class:"card"
}).append($("<button></button>",{type:"button",class:"card-header"}).on("click",e=>{this.toggleCard($(e.currentTarget))}).append(cardHeadContent)).append($("<div></div>",{class:"card-body collapse"}).append(cardBodyContent))),this.resize()},addVCseries:function(){
if(this.VCSeriesNums.length>0)var lastSeries=this.VCSeriesNums[this.VCSeriesNums.length-1],seriesNum=lastSeries+1;else var seriesNum=1;this.VCSeriesNums.push(seriesNum),this.makeVCcard(seriesNum)},makeVCcard:function(seriesNum){
var seriesSearch=this.seriesSearch(seriesNum),inputTypes=["seriesNum","seriesDur","passBefore","passAfter","notes"],inputTypesNice=["Series #","Duration (sec):","Passive Series Before","Passive Series After","Notes"],cardHead=$("<h3></h3>").append("Series <span data-series='"+seriesNum+"' data-calc='seriesNum'>"+seriesNum+"</span>"),cardBody=$("<div></div>",{
class:"container","data-series":seriesNum});cardBody.append($("<div></div>",{class:"row hideView"}).append($("<div></div>",{class:"col"}).append($("<input></input>",{type:"button",name:"deleteser"+seriesNum,id:"deleteSeries"+seriesNum,"data-series":seriesNum,
class:"fullWidth deleteSeries disableOnView",value:"Delete Series"}).on("click",e=>{this.deleteSeries(seriesNum)})))),$("#VCcardDiv").append($("<div></div>",{class:"col-12 col-md-4 cardDiv","data-series":seriesNum}));for(var i=0;i<inputTypes.length;i++){var inputType=inputTypes[i],inputObject={
class:"fullWidth watch "+inputType,id:inputType+seriesNum,name:inputType.toLowerCase()+seriesNum,"data-series":seriesNum,"data-watch":inputType};if("notes"===inputType){var $input=$("<text"+"area></text"+"area>",inputObject);$input.addClass("autoAdjust").on("input",e=>{e.target.style.height="auto",
e.target.style.height=e.target.scrollHeight+"px",this.resize()})}else{inputObject.type="number";var $input=$("<input></input>",inputObject)}cardBody.append($("<div></div>",{class:"row"}).append($("<div></div>",{class:"col-12 font-weight-bold"}).append(inputTypesNice[i])).append($("<div></div>",{
class:"col"}).append($input)))}var $div=$("#VCcardDiv").find(".cardDiv"+seriesSearch);this.makeCard($div,cardHead,cardBody)},deleteSeries:function(seriesNum){var index=this.VCSeriesNums.indexOf(seriesNum);if(index>-1)this.VCSeriesNums.splice(index,1);var seriesSearch=this.seriesSearch(seriesNum)
;$(".cardDiv"+seriesSearch).remove(),this.resize()}};