my_widget_script={init:function(mode,json_data){this.include("https://code.jquery.com/jquery-3.5.1.min.js","sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=","anonymous",()=>{$(document).ready(()=>{
this.include("https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js","sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl","anonymous",()=>{$(document).ready(()=>{
this.include("https://cdn.jsdelivr.net/npm/luxon@1.26.0/build/global/luxon.min.js","sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0=","anonymous",()=>{$(document).ready(()=>{
this.include("https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.min.js","sha512-RdSPYh1WA6BF0RhpisYJVYkOyTzK4HwofJ3Q7ivt/jkpW6Vc8AurL1R+4AUcvn9IwEKAPm/fk7qFZW3OuiUDeg==","anonymous",()=>{$(document).ready(()=>{$jq351=jQuery.noConflict(true),this.myInit(mode,json_data)})})})})})})})})},
include:function(src,integrity,crossorigin,onload){var head=document.getElementsByTagName("head")[0],script=document.createElement("script");script.setAttribute("integrity",integrity),script.setAttribute("crossorigin",crossorigin),script.src=src,script.type="text/javascript",
script.onload=script.onreadystatechange=function(){if(script.readyState){if("complete"===script.readyState||"loaded"===script.readyState)script.onreadystatechange=null,onload()}else onload()},head.appendChild(script)},myInit:function(mode,json_data){var parsedJson=this.parseInitJson(json_data)
;this.makeOutputTableCards(),this.addOptionsToCustom(),this.initDynamicContent(parsedJson),window.onresize=(()=>this.resize()),this.parent_class.init(mode,()=>JSON.stringify(parsedJson.widgetData)),this.addRequiredFieldIndicators(),this.setUpInitialState(),this.adjustForMode(mode),
this.checkForNames()},to_json:function(){var widgetJsonString=this.parent_class.to_json(),dynamicContent=this.getDynamicContent(),output={widgetData:JSON.parse(widgetJsonString),solns:this.solns,numExtAdds:dynamicContent.numExtAdds,numIntAdds:dynamicContent.numIntAdds,
selected:this.outputTables.custom.columns,unselected:this.outputTables.custom.unSelColumns};return JSON.stringify(output)},from_json:function(json_data){var parsedJson=JSON.parse(json_data);this.parent_class.from_json(JSON.stringify(parsedJson.widgetData))},test_data:function(){
var testData=JSON.parse(this.parent_class.test_data()),output={widgetData:testData,solns:{internal:[1],external:[1,2]},selected:this.allOptions.slice(0,3),unselected:this.allOptions.slice(3,this.allOptions.length)};return JSON.stringify(output)},is_valid:function(b_suppress_message){
var fail=false,fail_log="",name;if($("#the_form").find("select, textarea, input").each(function(){if(!$(this).prop("required"));else if(!$(this).val())fail=true,name=$(this).attr("id"),fail_log+=name+" is required \n"}),$("input[type='date']").each(function(){var date=$(this).val();if(date){
var validDate=my_widget_script.isValidDate(date);if(!validDate)fail=true,fail_log+="Please enter valid date in form 'YYYY-MM-DD'"}}),$("input[type='time']").each(function(){var time=$(this).val();if(time){var validtime=my_widget_script.isValidTime(time);if(!validtime)fail=true,
fail_log+="Please enter valid time in form 'hh:mm' - 24 hr time"}}),fail)return bootbox.alert (fail_log);else{var noErrors=[];return noErrors}},is_edited:function(){return this.parent_class.is_edited()},reset_edited:function(){return this.parent_class.reset_edited()},
parseInitJson:function(json_data){var jsonString;if("string"===typeof json_data)jsonString=json_data;else jsonString=json_data();var parsedJson=JSON.parse(jsonString);return parsedJson},initDynamicContent:function(parsedJson){
if(parsedJson.solns)for(type in parsedJson.solns)for(var i=0;i<parsedJson.solns[type].length;i++){var solnNum=parsedJson.solns[type][i];this.addSoln(type,solnNum)}if(parsedJson.selected&&parsedJson.unselected)this.resetOptionsList(parsedJson.unselected,parsedJson.selected)
;for(var i=0;i<parsedJson.numExtAdds;i++)this.addSoln("external",i+1);for(var i=0;i<parsedJson.numIntAdds;i++)this.addSoln("internal",i+1)},adjustForMode:function(mode,parsedJson){if("edit"!==mode&&"edit_dev"!==mode)$(".disableOnView").prop("disabled",true),
$("input[type='date']").removeClass(".hasDatePicker"),$(".hideView").hide(),$("#tableDiv").show(),$(".outCardContainer").insertAfter($(".firstDiv")),$(".reqTextInfo").hide();else $("input[type='date']").each((i,e)=>{this.checkDateFormat($(e))}),$("input[type='time']").each((i,e)=>{
this.checkTimeFormat($(e))})},runIfConfirmed:function(text,functionToCall){var thisMessage="Are you sure?";if(text)thisMessage=text;bootbox.confirm ({message:thisMessage,callback:proceed=>{if(proceed)functionToCall()}})},dialogConfirm:function(text,functionToCall){
var thisMessage="Do you want to proceed?";if(text)thisMessage=text;bootbox.confirm ({message:thisMessage,callback:result=>{functionToCall(result)}})},runBasedOnInput:function(prompt,functionToCall){var thisTitle="Enter value:";if(prompt)thisTitle=prompt;bootbox.prompt({title:thisTitle,
callback:result=>{functionToCall(result)}})},addRequiredFieldIndicators:function(){$(".requiredLab").each(function(){$(this).html("<span style='color:red'>*</span>"+$(this).html())})},isValidTime:function(timeString){var regEx="^(((([0-1][0-9])|(2[0-3])):[0-5][0-9]))$"
;if(!timeString.match(regEx))return false;else return true},isTimeSupported:function(){var input=document.createElement("input");input.setAttribute("type","time");var supported=true;if("time"!==input.type)supported=false;return my_widget_script.timeSupported=supported,supported},timeSupported:true,
checkTimeFormat:function($timeInput){if(!my_widget_script.timeSupported){$timeInput.next(".timeWarning").remove();var time=$timeInput.val(),isValid=my_widget_script.isValidTime(time);if(!isValid)$timeInput.after('<div class="text-danger timeWarning">Enter time as "hh:mm" in 24-hr format</div>')
;this.resize()}},isValidDate:function(dateString){var regEx=/^\d{4}-\d{2}-\d{2}$/;if(!dateString.match(regEx))return false;var d=new Date(dateString),dNum=d.getTime();if(!dNum&&0!==dNum)return false;return d.toISOString().slice(0,10)===dateString},isDateSupported:function(){
var input=document.createElement("input");input.setAttribute("type","date");var supported=true;if("date"!==input.type)supported=false;return my_widget_script.dateSupported=supported,supported},dateSupported:true,checkDateFormat:function($dateInput){if(!my_widget_script.dateSupported){
$dateInput.next(".dateWarning").remove();var date=$dateInput.val(),isValid=my_widget_script.isValidDate(date);if(!isValid)$dateInput.after('<div class="text-danger dateWarning">Enter date as "YYYY-MM-DD"</div>');$dateInput.datepicker({dateFormat:"yy-mm-dd"}),this.resize()}},selectedTable:{id:"",
name:""},setUpInitialState:function(){this.isDateSupported(),this.isTimeSupported(),$("input[type='date']").prop("placeholder","YYYY-MM-DD").on("change",e=>{this.checkDateFormat($(e.currentTarget))}),$("input[type='time']").prop("placeholder","hh:mm").on("change",e=>{
this.checkTimeFormat($(e.target))}),$("textarea.autoAdjust").each((i,e)=>{e.setAttribute("style","height:"+e.scrollHeight+"px;overflow-y:hidden;")}).on("input",e=>{e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px",this.resize()}),
$(".myLeftCol").addClass("col-12 col-sm-6 col-md-4 col-lg-3 text-left text-sm-right"),$("#addToExternal").on("click",()=>{this.addSolnClick("external")}),$("#addToInternal").on("click",()=>{this.addSolnClick("internal")}),$("#removeLastExternal").on("click",()=>{this.removeSoln("external")}),
$("#removeLastInternal").on("click",()=>{this.removeSoln("internal")}),$("[data-table]").not(".dontHide").hide(),$(".showTable").on("click",e=>{if($(e.target).hasClass("showTable")){$("[data-table]").not(".dontHide").hide()
;var table=$(e.target).data("table"),tableName=$(e.target).data("tablename"),tableSearch=this.tableSearch(table);$(tableSearch).show(),$(".card"+tableSearch).find(".card-body").removeClass("collapse"),this.selectedTable={id:table,name:tableName},$("#errorMsg").html(""),this.resize()}}),
$(".toCSV").on("click",e=>{var tableID=this.selectedTable.id;if(tableID){var tableName=this.selectedTable.name,dateToday=luxon.DateTime.now().toISODate(),fileName="table_"+tableName+"_"+dateToday,$errorMsg=$("#errorMsg");this.toCSVFuncs(fileName,tableID,$errorMsg)
}else $("#errorMsg").html("Please select a table first"),this.resize()}),$(".copyData").on("click",e=>{var tableID=this.selectedTable.id;if(tableID){
var tableSearch=this.tableSearch(tableID),$copyHead=$("#copyHead"),$transpose=$("#transpose"),$tableToCopy=$("#"+tableID),$tableDiv=$tableToCopy.parent(),$errorMsg=$("#errorMsg"),$divForCopy=$("#forCopy");this.copyDataFuncs($copyHead,$tableToCopy,$tableDiv,$errorMsg,$divForCopy,$transpose)
}else $("#errorMsg").html("Please select a table first"),this.resize()}),$("#the_form").on("input",e=>{this.updateCalcFromEl(e.target)}),$("#sex").on("change",()=>{this.checkSexAndGonadStatus()}),$("#gonadStatus").on("change",()=>{this.checkSexAndGonadStatus(),this.calcSurgeryDate()}),
$("#surgeryDate").on("change",()=>{this.calcSurgeryDate()}),$("#implantBox").on("change",e=>{this.showWithCheck($(e.target),$("[data-implant]"))}),$(".implantCalc").on("change",()=>{my_widget_script.calcImplant()}),$(".treatmentCalc").on("change",()=>{my_widget_script.calcTreatment()}),
$(".cycleCalc").on("change",()=>{my_widget_script.calcCycleStage()}),$(".massCalc").on("input",()=>{my_widget_script.calcUterineMass(),my_widget_script.calcUterineMass_perBodyMass(),my_widget_script.calcReproTractMass_perBodyMass()}),$(".ageCalc").on("input",()=>{my_widget_script.calcAgeInDays()}),
$("#savedPit").on("change",()=>{my_widget_script.calcSavedPit()}),$("#savedBlood").on("change",()=>{my_widget_script.calcSavedBlood()}),$(".timeCalc").on("input",()=>{my_widget_script.calcHoursPostLightsOn()}),$("input, select, textarea").each((i,e)=>{
if("button"!=$(e).attr("type"))this.updateCalcFromEl(e)}),this.calcValues(),this.resize()},resize:function(){this.parent_class.resize_container()},checkForNames:function(){$("input, select, textarea").each((i,e)=>{var thisName=$(e).attr("name")
;if(!thisName)console.log("There is no name attribute for: ",e.id);else{var hasUpper=/[A-Z]/.test(thisName);if(hasUpper)console.log("The name contains an uppercase letter for: ",e.id)}})},getDynamicContent:function(){numExtAdds=$("#externalAdditionsTable").find("tbody tr").length,
numIntAdds=$("#internalAdditionsTable").find("tbody tr").length;var dynamicContent={numExtAdds:numExtAdds,numIntAdds:numIntAdds};return dynamicContent},data_valid_form:function($errorMsg=$("#errorMsg")){var valid=true,fail_log=$("<div></div>").append("Missing values for:"),name
;if($(".needForTable").each((i,e)=>{if(!$(e).val())name=$(e).attr("id"),fail_log.append("<br/>"+name)}),!valid)$errorMsg.html("<span style='color:red; font-size:36px;'>"+"Please fill out all elements marked by a"+"</span><span style='color:blue; font-size:36px;'>"+" blue #"+"</span>"),
$errorMsg.append(fail_log);else $errorMsg.html("");return this.resize(),valid},updateCalcFromEl:function(el){var calc=el.id,val=el.value,calcSearch=this.calcSearch(calc);$(calcSearch).html(val),this.resize()},updateCalcFromVal:function(calc,val){var calcSearch=this.calcSearch(calc)
;$(calcSearch).text(val),this.resize()},resizeTextareaInEl:function($el){$el.find("textarea.autoAdjust").each((i,e)=>{if(!$(e).is(":hidden"))e.setAttribute("style","height:"+e.scrollHeight+"px;overflow-y:hidden;")})},showWithCheck:function($chbx,$toToggle){if($chbx.is(":checked"))$toToggle.show(),
this.resizeTextareaInEl($toToggle);else $toToggle.hide();my_widget_script.resize()},sexGonads:"",checkSexAndGonadStatus:function(){var sex=$("#sex").val(),gonads=$("#gonadStatus").val(),sexSearch=this.sexSearch(sex),gonadsSearch=this.gonadsSearch(gonads);if(this.sexGonads=sex+"-"+gonads,
$("[data-sex]").hide(),$("[data-gonads]").hide(),sex)$(sexSearch).not("[data-gonads]").show().each((i,e)=>{this.resizeTextareaInEl($(e))});if(gonads)$(gonadsSearch).not("[data-sex]").show().each((i,e)=>{this.resizeTextareaInEl($(e))});if(sex&&gonads)$(sexSearch+gonadsSearch).show().each((i,e)=>{
this.resizeTextareaInEl($(e))});this.resize()},calcTreatment:function(){var genTreatment="",treatment="",projType=$("#projectType").val();if($("[data-proj]").hide(),projType){var projSearch=this.projSearch(projType);$(projSearch).show();var treatment=$(projSearch).val()
;if("DHT"===treatment)genTreatment="PNA";else if("ALPS"===treatment)genTreatment="stress";else if("CON"===treatment||"CON_main"===treatment||"VEH"===treatment)genTreatment="control"}if(!genTreatment)genTreatment="NA";if(!treatment)treatment="NA";this.updateCalcFromVal("genTreatment",genTreatment),
this.updateCalcFromVal("treatment",treatment),this.resize()},calcCycleStage:function(){var stage,comment;if("female-intact"===this.sexGonads)stage=$("#cycleStage").val(),comment=$("#stageComment").val();if(!stage)stage="NA";if(!comment)comment="NA";this.updateCalcFromVal("cycleStage",stage),
this.updateCalcFromVal("stageComment",comment),this.resize()},calcUterineMass:function(){var uterineMass;if("female"===$("#sex").val())var uterineMass=$("#reproTractMass").val();if(!(isFinite(uterineMass)&&uterineMass))uterineMass="NA";this.updateCalcFromVal("uterineMass",uterineMass),this.resize()
},calcUterineMass_perBodyMass:function(){var uterine_mg_per_g;if("female"===$("#sex").val())var uterine_mg_per_g=$("#reproTractMass").val()/$("#bodyMass").val();if(isFinite(uterine_mg_per_g)&&uterine_mg_per_g)uterine_mg_per_g=uterine_mg_per_g.toFixed(4);else uterine_mg_per_g="NA"
;this.updateCalcFromVal("uterine_mg_per_g",uterine_mg_per_g),this.resize()},calcReproTractMass_perBodyMass:function(){var reprotract_mg_per_g=$("#reproTractMass").val()/$("#bodyMass").val()
;if(isFinite(reprotract_mg_per_g)&&reprotract_mg_per_g)reprotract_mg_per_g=reprotract_mg_per_g.toFixed(4);else reprotract_mg_per_g="NA";this.updateCalcFromVal("reproTract_mg_per_g",reprotract_mg_per_g);var reproTractMass=$("#reproTractMass").val(),reproTractMass_g=reproTractMass/1e3
;if(!(isFinite(reproTractMass_g)&&reproTractMass))reproTractMass_g="NA";this.updateCalcFromVal("reproTractMass_g",reproTractMass_g),this.resize()},getPND:function(dateInputVal,DOBisDay){var textOutput,DOB_val=$("#dateOfBirth").val();if(DOB_val)if(dateInputVal){
var compDate=luxon.DateTime.fromISO(dateInputVal).startOf("day"),DOB=luxon.DateTime.fromISO(DOB_val).startOf("day").minus({days:DOBisDay}),pnd=compDate.diff(DOB,"days").as("day");textOutput=pnd}else textOutput="[Enter Recording Date]";else textOutput="[Enter DOB]";return textOutput},
calcAgeInDays:function(){var DOBisDay=parseInt($("#DOB_equals").val()),recordingDate=$("#recordingDate").val(),ageInDays=my_widget_script.getPND(recordingDate,DOBisDay);this.updateCalcFromVal("ageInDays",ageInDays);var ageGroup=""
;if(ageInDays>=50)ageGroup="adult";else if(ageInDays>=18&&ageInDays<=21)ageGroup="3wk";this.updateCalcFromVal("ageGroup",ageGroup),this.resize()},calcSavedPit:function(){var savedPit="FALSE",savedPit_yn="N";if($("#savedPit").is(":checked"))savedPit="TRUE",savedPit_yn="Y"
;this.updateCalcFromVal("savedPit",savedPit),this.updateCalcFromVal("savedPit_yn",savedPit_yn),this.resize()},calcSavedBlood:function(){var savedBlood="FALSE",savedBlood_yn="N";if($("#savedBlood").is(":checked"))savedBlood="TRUE",savedBlood_yn="Y";this.updateCalcFromVal("savedBlood",savedBlood),
this.updateCalcFromVal("savedBlood_yn",savedBlood_yn),this.resize()},calcHoursPostLightsOn:function(){var sacTime_dur=luxon.Duration.fromISOTime($("#sacTime").val()),sacHrs
;if("Y"===$("#daylightSavings").val())var lights_on="04:00";else if("N"===$("#daylightSavings").val())var lights_on="03:00";else return sacHrs="Select daylight savings",this.updateCalcFromVal("sacHrs",sacHrs),void 0;var lights_on_dur=luxon.Duration.fromISOTime(lights_on)
;if(sacHrs=sacTime_dur.minus(lights_on_dur).as("hour"),!isFinite(sacHrs))sacHrs="NA";else sacHrs=sacHrs.toFixed(2);this.updateCalcFromVal("sacHrs",sacHrs),this.resize()},calcSurgeryDate:function(){var surgeryDate="NA";if("gdx"===$("#gonadStatus").val())if(surgeryDateVal=$("#surgeryDate").val(),
surgeryDateVal)surgeryDate=surgeryDateVal;this.updateCalcFromVal("surgeryDate",surgeryDate),this.resize()},calcImplant:function(){var implant="FALSE",type="NA",date="NA",comment="NA";if($("#implantBox").is(":checked")){if(implant="TRUE",typeVal=$("#implantType").val(),
dateVal=$("#implantDate").val(),commentVal=$("#implantComment").val(),typeVal)type=typeVal;if(dateVal)date=dateVal;if(commentVal)comment=commentVal}this.updateCalcFromVal("implant",implant),this.updateCalcFromVal("implantType",type),this.updateCalcFromVal("implantDate",date),
this.updateCalcFromVal("implantComment",comment),this.resize()},checkTableForBlanks:function(){$(".outTable tr").each((i,e)=>{$("td",e).each((i,e)=>{if(!("NA"===$(e).data("calc"))){var value=$(e).text();if(""===value||"NaN"===value||"___"===value||"Select daylight saving"===value)$(e).text("NA")}})
}),this.resize()},calcValues:function(){this.checkSexAndGonadStatus(),this.calcTreatment(),this.calcCycleStage(),this.calcUterineMass(),this.calcUterineMass_perBodyMass(),this.calcReproTractMass_perBodyMass(),this.calcAgeInDays(),this.calcSavedPit(),this.calcSavedBlood(),
this.calcHoursPostLightsOn(),this.calcSurgeryDate(),this.calcImplant(),this.showWithCheck($("#implantBox"),$("[data-implant]")),this.checkTableForBlanks(),this.resize()},toCSVFuncs:function(fileName,tableID,$errorMsg){var data_valid=this.data_valid_form($errorMsg)
;if(data_valid)this.checkTableForBlanks(),this.exportTableToCSV(fileName,tableID),$errorMsg.html("<span style='color:grey; font-size:24px;'>Saved successfully</span>");else $errorMsg.append("<br/><span style='color:grey; font-size:24px;'>Did not export</span>");this.resize()},
downloadCSV:function(csv,filename){var csvFile,downloadLink;csvFile=new Blob([csv],{type:"text/csv"}),downloadLink=document.createElement("a"),downloadLink.download=filename,downloadLink.href=window.URL.createObjectURL(csvFile),downloadLink.style.display="none",
document.body.appendChild(downloadLink),downloadLink.click()},exportTableToCSV:function(filename,table){for(var csv=[],datatable=document.getElementById(table),rows=datatable.querySelectorAll("tr"),i=0;i<rows.length;i++){for(var row=[],cols=rows[i].querySelectorAll("td, th"),j=0;j<cols.length;j++){
var cellText='"'+cols[j].innerText+'"';row.push(cellText)}csv.push(row.join(","))}this.downloadCSV(csv.join("\n"),filename)},copyDataFuncs:function($copyHead,$tableToCopy,$tableDiv,$errorMsg,$divForCopy,$transpose){var data_valid=this.data_valid_form($errorMsg),copyHead=false,transpose=false
;if($copyHead.is(":checked"))copyHead=true;if($transpose.is(":checked"))transpose=true;if(this.checkTableForBlanks(),data_valid)$tableDiv.show(),this.resize(),this.copyTable($tableToCopy,copyHead,$divForCopy,transpose),
$errorMsg.html("<span style='color:grey; font-size:24px;'>Copy attempted</span><br/><span style='color:grey;'>If it didn't work, please press copy again</span>");else $errorMsg.append("<br/><span style='color:grey; font-size:24px;'>Nothing was copied</span>");this.resize()},
copyTable:function($table,copyHead,$divForCopy,transpose){var $temp=$("<text"+"area style='opacity:0;'></text"+"area>"),rows=[],rowNum=0;if(copyHead)$table.find("thead").children("tr").each((i,e)=>{if(transpose)rowNum=0;if($(e).find("td, th").each((i,e)=>{if(void 0===rows[rowNum])rows[rowNum]=[]
;if(rows[rowNum].push($(e).text()),transpose)rowNum++}),!transpose)rowNum++});$table.find("tbody").children("tr").each((i,e)=>{if(transpose)rowNum=0;if($(e).find("td, th").each((i,e)=>{if(void 0===rows[rowNum])rows[rowNum]=[];if(rows[rowNum].push($(e).text()),transpose)rowNum++}),!transpose)rowNum++
});for(var i=0;i<rows.length;i++)rows[i]=rows[i].join("\t");$temp.append(rows.join("\n")),$temp.appendTo($divForCopy).select(),document.execCommand("copy"),$temp.remove()},watchValue:function($elToWatch,$elToUpdate){},dataSearch:function(dataName,dataValue){
var dataSearch="[data-"+dataName+"='"+dataValue+"']";return dataSearch},tableSearch:function(table){var tableSearch=this.dataSearch("table",table);return tableSearch},calcSearch:function(calc){var calcSearch=this.dataSearch("calc",calc);return calcSearch},watchSearch:function(watch){
var watchSearch=this.dataSearch("watch",watch);return watchSearch},sexSearch:function(sex){var sexSearch="[data-sex~='"+sex+"']";return sexSearch},gonadsSearch:function(gonadsStatus){var gonadsSearch=this.dataSearch("gonads",gonadsStatus);return gonadsSearch},projSearch:function(proj){
var projSearch=this.dataSearch("proj",proj);return projSearch},checkInArray:function(searchVal,array){var inArray=-1!==$.inArray(searchVal,array);return inArray},solns:{internal:[],external:[]},addSolnClick:function(basename){
var solnNum=1,theseSolnNums=this.solns[basename],numSolns=theseSolnNums.length;if(numSolns>0){var lastSoln=theseSolnNums[numSolns-1];solnNum=lastSoln+1}var inArray=this.checkInArray(solnNum,theseSolnNums);if(!inArray)this.addSoln(basename,solnNum)},addSoln:function(basename,solnNum){
var $solnDiv,$solnTable;this.solns[basename].push(solnNum),$solnDiv=$("#"+basename+"AdditionsDiv"),$solnTable=$("#"+basename+"Additions")
;var additionID=basename+"_addition_"+solnNum,additionDateID=basename+"_additiondate_"+solnNum,additionLabelHTML='<div class="mt-2">Addition '+solnNum+" Name</div>",additionalDateLabelHTML='<div class="mt-2">Addition '+solnNum+" Date</div>";$solnDiv.append($("<div></div>",{class:"addition",
"data-soln":basename,"data-solnnum":solnNum}).append(additionLabelHTML).append($("<div></div>").append($("<input></input>",{id:additionID,name:additionID,class:"fullWidth"}))).append(additionalDateLabelHTML).append($("<div></div>").append($("<input></input>",{id:additionDateID,name:additionDateID,
class:"fullWidth",type:"date",placeholder:"YYYY-MM-DD"}).each((i,e)=>{this.checkDateFormat($(e))}).on("input",e=>{this.checkDateFormat($(e.currentTarget))})))),$solnTable.find("tbody").append($("<tr></tr>",{"data-soln":basename,"data-solnnum":solnNum}).append($("<td></td>",{"data-calc":additionID
})).append($("<td></td>",{"data-calc":additionDateID}))),this.resize()},removeSoln:function(basename){var $solnDiv,$solnTable;if($solnDiv=$("#"+basename+"AdditionsDiv"),$solnTable=$("#"+basename+"AdditionsTable"),this.solns[basename].length>0){
var lastSolnIndex=this.solns[basename].length-1,lastSolnNum=this.solns[basename][lastSolnIndex];this.solns[basename].splice(lastSolnIndex,1);var search=this.dataSearch("soln",basename)+this.dataSearch("solnnum",lastSolnNum);$(search).remove()}},outputTables:{labGoogleSheet:{id:"labGoogleSheet",
label:"Lab Google Sheet",saveName:"fullLabSlicing",
columns:["mouseID","cageNum","who","recordingDate","dateOfBirth","ageInDays","sacTime","daylightSavings","sacHrs","strain","zygosity","sex","bodyMass","reproTractMass","reproTract_mg_per_g","gonadStatus","cycleStage","stageComment","surgeryDate","implant","implantType","implantDate","implantComment","tubeLabel","savedPit","genTreatment","treatment","glucose","nucleus","orientation","sliceQual","sliceComment","fluorQual","fluorComment","externalSoln","externalDate","internalSoln","internalDate","pipette","pipetteLot"],
num:1},mouseInfo:{id:"mouseInfo",label:"Mouse Information",saveName:"mouseInfo",columns:["mouseID","cageNum","generation","damID","sireID","genTreatment","treatment","dateOfBirth","DOB_equals","sex","zygosity","strain","gonadStatus","surgeryDate","implantType","implantDate"],num:2},slicingInfo:{
id:"slicingInfo",label:"Slicing Information",saveName:"slicingInfo",columns:["mouseID","recordingDate","ageInDays","savedPit","daylightSavings","sacTime","sacHrs","who","cycleStage","bodyMass","reproTractMass"],num:3},slicingTiming:{id:"slicingTiming",label:"Slicing Timing",saveName:"slicingTiming",
columns:["mouseID","daylightSavings","sacTime","sacHrs"],num:4},KNDyPNA_extracellular:{id:"KNDyPNA_extracellular",label:"KNDy PNA Extracell",saveName:"KNDyPNA_extracellular",
columns:["mouseID","cageNum","genTreatment","treatment","cycleStage","bodyMass","uterineMass","uterine_mg_per_g","dateOfBirth","recordingDate","ageInDays","savedPit","daylightSavings","sacTime","sacHrs","who","zygosity"],num:5},jennPNA:{id:"jennPNA",label:"Jenn PNA Project",saveName:"JennPNA",
columnNames:["CellID","mouseID","Exclude reason","Cage","TX","Group","DOB","Age","RecordingAge","RecordingDay","Mass (g)","Ut. mass (g)","Ut. mass (mg)","Cycle Stage","Sac time","Sac hour","Pit","Blood","Notes"],
columns:["NA","mouseID","NA","cageNum","treatment","genTreatment","dateOfBirth","ageGroup","ageInDays","recordingDate","bodyMass","reproTractMass_g","reproTractMass","cycleStage","sacTime","sacHrs","savedPit_yn","savedBlood_yn","NA"],num:6},externalAdditions:{id:"externalAdditions",
label:"External Additions",saveName:"externalAdditions",columnNames:["Addition Name","Addition Date"],columns:[],num:7},internalAdditions:{id:"internalAdditions",label:"Internal Additions",saveName:"internalAdditions",columnNames:["Addition Name","Addition Date"],columns:[],num:8},custom:{
id:"custom",label:"Custom",saveName:"custom",columns:[],num:9}},makeOutputTableCards:function(){for(table in this.outputTables){var tableObj=this.outputTables[table];this.makeViewButtons(tableObj),this.makeOutputTableCard(tableObj)}},toggleCard:function($cardHead){
$cardHead.next().toggleClass("collapse"),this.resizeTextareaInEl($cardHead.next()),this.resize()},makeCard:function($div,cardHeadContent,cardBodyContent){$div.append($("<div/>",{class:"card"}).append($("<button></button>",{type:"button",class:"card-header"}).on("click",e=>{
this.toggleCard($(e.currentTarget))}).append(cardHeadContent)).append($("<div/>",{class:"card-body collapse"}).append(cardBodyContent))),this.resize()},makeOutputTableCard:function(tableObj){
var $div=$(".outCardContainer"),cardHead=tableObj.label,$body=$("<div></div>"),table=this.makeOutputTable(tableObj);$body.append(table),this.makeCard($div,cardHead,$body),$div.find(".card").last().attr("data-table",tableObj.id)},makeViewButtons:function(tableObj){
var numForTags=tableObj.num,tableID=tableObj.id,tableName=tableObj.saveName,tableLabel=tableObj.label,$buttonsDiv=$(".viewTableButtons");if(1===numForTags)$buttonsDiv.html("");$buttonsDiv.append($("<div></div>",{class:"col-12 col-sm-6 col-md-4, col-lg-3"}).append($("<input></input>",{type:"button",
id:"showTable"+numForTags,name:"showtable"+numForTags,class:"showTable fullWidth dontHide","data-table":tableID,"data-tablename":tableName,value:tableLabel})))},makeOutputTable:function(tableObj){var columnNames=tableObj.columns
;if(tableObj.hasOwnProperty("columnNames"))columnNames=tableObj.columnNames;var $div=this.makeCalcTable(tableObj.id,columnNames,tableObj.columns);return $div},makeCalcTable:function(tableID,colNames,colCalcs){for(var $table=$("<div></div>",{class:"container calcTableContainer"
}).append($("<div></div>",{class:"row"}).append($("<div></div>",{class:"col-12 table-responsive xsTableDiv"}).append($("<table></table>",{id:tableID,class:"table outTable"
}).append($("<thead></thead>")).append($("<tbody></tbody>"))))),headRow=document.createElement("tr"),bodyRow=document.createElement("tr"),i=0;i<colNames.length;i++){var colName=colNames[i],headCell=document.createElement("th");if(headCell.append(colName),headRow.appendChild(headCell),
colCalcs.length>0){var colCalc=colCalcs[i],bodyCell=document.createElement("td");bodyCell.dataset.calc=colCalc,bodyRow.appendChild(bodyCell)}}if($table.find("thead").append(headRow),colCalcs.length>0)$table.find("tbody").append(bodyRow);return $table},
allOptions:["mouseID","cageNum","generation","damID","sireID","who","recordingDate","dateOfBirth","ageInDays","sacTime","daylightSavings","sacHrs","strain","zygosity","sex","bodyMass","reproTractMass","reproTract_mg_per_g","gonadStatus","cycleStage","stageComment","surgeryDate","implant","implantType","implantDate","implantComment","tubeLabel","savedPit","genTreatment","treatment","glucose","nucleus","orientation","sliceQual","sliceComment","fluorQual","fluorComment","externalSoln","externalDate","internalSoln","internalDate","pipette","pipetteLot"],
sortableOptions:function(){$('.sortable[sortable="true"]').sortable({connectWith:".sortable",placeholder:"ui-state-highlight",update:()=>{this.getSelectedOrder()}})},getSelectedOrder:function(){this.outputTables.custom.columns=$("#selectedOptions").sortable("toArray"),
this.outputTables.custom.unSelColumns=$("#unselected").sortable("toArray"),this.updateCustomTable()},addOptionsToCustom:function(){$cardBody=$(".card"+this.tableSearch("custom")).find(".card-body"),$cardBody.append($("<div></div>",{class:"row"}).append($("<div></div>",{class:"col-12"
}).append($("<input></input>",{name:"resetoptions",id:"resetOptions",value:"Reset",type:"button",class:"fullWidth"}).on("click",e=>{this.resetOptionsList()})))).append($("<div></div>",{class:"row"}).append($("<div></div>",{class:"col"
}).append("Drag and drop variables to add to table"))).append($("<div></div>",{class:"row"}).append($("<div></div>",{class:"col-6"}).append("<h3>Selected:</h3>").append($("<ul></ul>",{id:"selectedOptions",sortable:"true",class:"sortable"}).append("&nbsp;"))).append($("<div></div>",{class:"col-6"
}).append("<h3>Unselected:</h3>").append($("<ul></ul>",{id:"unselected",sortable:"true",class:"sortable"}).append("&nbsp;")))),this.sortableOptions(),this.resetOptionsList()},updateCustomTable:function(){var columns=this.outputTables.custom.columns,$customCard=$(".card"+this.tableSearch("custom"))
;$customCard.find(".calcTableContainer").remove();var $table=this.makeCalcTable("custom",columns,columns);$table.prependTo($customCard.find(".card-body")),$("input, select, textarea").each((i,e)=>{if("button"!=$(e).attr("type"))this.updateCalcFromEl(e)}),this.calcValues()},
resetOptionsList:function(unselected=this.allOptions,selected){$("#selectedOptions").html("&nbsp;"),$("#unselected").html("&nbsp;");for(var i=0;i<unselected.length;i++){var option=unselected[i];$("#unselected").append($("<li></li>",{id:option}).append(option))}
if(selected)for(var i=0;i<selected.length;i++){var option=selected[i];$("#selectedOptions").append($("<li></li>",{id:option}).append(option))}this.getSelectedOrder()}};