
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<!-- START:stylesheet
-->

  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/stylesheets/labarchive.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/jquery-ui.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/themes/base/ui.all.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/chosen/chosen.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/DataTables-1.9.3/media/css/jquery.dataTables_themeroller.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/DataTables-1.9.3/extras/TableTools/media/css/TableTools.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/DataTables-1.9.3/extras/ColVis/media/css/ColVis.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/jquery.calculator.package-1.3.2/jquery.calculator.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/freezerbox/jquery.freezerbox.css">
  <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/freezerbox/jquery.colorselect.css">
          <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/jquery-1.7.2.min.js"></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/jquery-ui-1.9.1.custom.min.js"></script>
                    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/populate/jquery.populate.pack.js" defer="defer"></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/numeric/jquery.numeric.js" defer="defer"></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/jquery.calculator.package-1.3.2/jquery.calculator.js" defer="defer"></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/daepark-postmessage/postmessage.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/forms/widget_proxy.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/forms/parent_form_script.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/forms/database_form_script.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/DataTables-1.9.3/media/js/jquery.dataTables.min.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/DataTables-1.9.3/extras/TableTools/media/js/TableTools.min.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/DataTables-1.9.3/extras/TableTools/media/js/ZeroClipboard.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/DataTables-1.9.3/extras/ColVis/media/js/ColVis.min.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/DataTables-1.9.3/extras/ColResize/ColReorderWithResize.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/chosen/chosen.jquery_modified.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/autoresize/jquery.autoresize.min.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/freezerbox/jquery.freezerbox.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/freezerbox/jquery.colorselect.js" ></script>
            <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/freezerbox/freezerbox_form_script.js" ></script>
    
<title></title>
</head>
<body>
<script>
    // #region
var form_script = null;
try {
$(document).ready(function () {
      
      
      // Create window var to store the locale for the datepicker
      window.datepicker_locale = '';
//***************************************************************************
//***************************************************************************
//***************************************************************************
//place your javascript code below and when you have it the way you want it
//just paste it into the LA Dev tool
//***************************************************************************
//***************************************************************************
//***************************************************************************
// #endregion
    form_script = 
    my_widget_script={_numEntries:0,_numExits:0,
_duration:NaN,_fileName:"",_startState:"",
_vid:document.getElementById("videoPlayer"),
_timeOffNest:0,_timeOnNest:0,_stampTimes:[],
_stampStates:[],_allDurations:[],_entryStamps:[],
_exitStamps:[],_entryDurs:[],_exitDurs:[],
_percOffNest:0,_percOnNest:0,
init:function(mode,json_data){
var parsedJson=this.parseInitJson(json_data)
;this.initDynamicContent(parsedJson),
window.onresize=this.resize,window.onresize=this.GoogleChartTimeLine,
this.addEventListeners(),
this.parent_class.init(mode,()=>JSON.stringify(parsedJson.widgetData)),
this.addRequiredFieldIndicators(),
this.setUpInitialState(),this.adjustForMode(mode),
this.GoogleChartTimeLine()},to_json:function(){
var widgetJsonString=this.parent_class.to_json(),dynamicContent=this.getDynamicContent(),output={
widgetData:JSON.parse(widgetJsonString),
fileName:dynamicContent.fileName,
startState:dynamicContent.startState,
duration:dynamicContent.duration,
numExits:dynamicContent.numExits,
numEntries:dynamicContent.numEntries,
stampTimes:dynamicContent.stampTimes,
stampStates:dynamicContent.stampStates,
allDurations:dynamicContent.allDurations}
;return JSON.stringify(output)},
from_json:function(json_data){
var parsedJson=JSON.parse(json_data)
;this.parent_class.from_json(JSON.stringify(parsedJson.widgetData))
},test_data:function(){
var testData=JSON.parse(this.parent_class.test_data()),stampStates=["entry","exit","entry","exit","entry","exit","entry"],stampTimes=[0,1,3,6,10,15,21],allDurations=[1,2,3,4,5,6,979],output={
fileName:"test",widgetData:testData,
startState:"on",duration:1e3,numEntries:3,
numExits:3,stampStates:stampStates,
stampTimes:stampTimes,allDurations:allDurations}
;return JSON.stringify(output)},
is_valid:function(b_suppress_message){
var fail=false,fail_log="",name
;if($("#the_form").find("select, textarea, input").each(function(){
if(!$(this).prop("required"));else if(!$(this).val())fail=true,
name=$(this).attr("id"),
fail_log+=name+" is required \n"
}),$("input[type='date']").each(function(){
var date=$(this).val();if(date){
var validDate=my_widget_script.isValidDate(date)
;if(!validDate)fail=true,fail_log+="Please enter valid date in form 'YYYY-MM-DD'"
}}),$("input[type='time']").each(function(){
var time=$(this).val();if(time){
var validtime=my_widget_script.isValidTime(time)
;if(!validtime)fail=true,fail_log+="Please enter valid time in form 'hh:mm' - 24 hr time"
}}),fail)return alert(fail_log);else{
var noErrors=[];return noErrors}},
is_edited:function(){
return this.parent_class.is_edited()},
reset_edited:function(){
return this.parent_class.reset_edited()},
parseInitJson:function(json_data){var jsonString
;if("string"===typeof json_data)jsonString=json_data;else jsonString=json_data()
;var parsedJson=JSON.parse(jsonString)
;return parsedJson},
initDynamicContent:function(parsedJson){
$(".filePath").text(parsedJson.fileName),
my_widget_script._fileName=parsedJson.fileName,
$(".clearOnLoad").text(""),my_widget_script._numExits=parsedJson.numExits,
my_widget_script._numEntries=parsedJson.numEntries,
my_widget_script._duration=parsedJson.duration,
$("#videoDur").val(my_widget_script._duration)
;var startState=parsedJson.startState
;if(my_widget_script._startState=parsedJson.startState,
my_widget_script.changeToState(my_widget_script._startState),
parsedJson.stampStates)my_widget_script._stampStates=parsedJson.stampStates
;if(parsedJson.stampTimes)my_widget_script._stampTimes=parsedJson.stampTimes
;if(parsedJson.allDurations)my_widget_script._allDurations=parsedJson.allDurations
;for(i=0;i<my_widget_script._stampStates.length;i++){
var movement="",time=NaN,duration=NaN
;movement=my_widget_script._stampStates[i],
time=my_widget_script._stampTimes[i],
duration=my_widget_script._allDurations[i]
;var $stampsDiv=$(".stampsDiv")
;if("exit"==movement)var newState="OFF",stateForButton="off";else if("entry"==movement)var newState="ON",stateForButton="on";else var newState="",stateForButton=""
;if(my_widget_script.makeStampRow($stampsDiv,movement,newState,time,duration),
i==my_widget_script._stampStates.length-1)my_widget_script.changeToState(stateForButton)
}my_widget_script.calcValues()},
adjustForMode:function(mode){
if("edit"!==mode&&"edit_dev"!==mode)$(".disableOnView").prop("disabled",true),
$(".hideView").hide(),
$(".bookmarkLink").parent().addClass("noPlay");else $(".hideEdit").hide()
},updateDurations:function(){
my_widget_script.getDuration()
;var lastDuration=my_widget_script._duration-my_widget_script._stampTimes[my_widget_script._stampTimes.length-1]
;my_widget_script._allDurations[my_widget_script._allDurations.length-1]=lastDuration,
$(".stampRow").last().find(".duration").text(lastDuration.toFixed(2)),
my_widget_script.GoogleChartTimeLine(),
my_widget_script.resize()},
addEventListeners:function(){
$("#myfile").on("input",function(){
var file=document.getElementById("myfile").files[0],proceed=false
;if(!my_widget_script._fileName)proceed=true;else if(file.name==my_widget_script._fileName)proceed=true;else proceed=confirm("This is a different file than was previously analyzed in this widget. Do you want to proceed?")
;if(proceed){
$(".filePath").text(file.name),my_widget_script._fileName=file.name
;var fileURL=URL.createObjectURL(file)
;my_widget_script._vid.src=fileURL,my_widget_script._vid.playbackRate=$("#changeSpeed").val(),
$("#addStampButton").removeAttr("disabled"),
$("#removeStampButton").removeAttr("disabled")}
my_widget_script.resize()
}),$("#videoPlayer").on("durationchange",function(){
my_widget_script.updateDurations()
}),$("#getDur").on("input",function(){
my_widget_script.updateDurations()
}),$("#videoDur").on("input",function(){
my_widget_script.updateDurations()
}),$("#changeSpeed").on("input",function(){
my_widget_script._vid.playbackRate=$(this).val()
}),$("#startState").on("input",function(){
if(!my_widget_script._numEntries>0&&!my_widget_script._numExits>0)var proceed=true;else var proceed=confirm("Changing this will remove all stamps. Do you wish to proceed?")
;if(proceed){var startState=$(this).val()
;my_widget_script._startState=$(this).val(),
my_widget_script.resetStamps(startState)}
}),$("#addStampButton").on("click",function(){
var currentState=$(this).data("state")
;if(currentState)my_widget_script.addStampFuncs(currentState);else alert("Enter the starting state of the dam")
}).on("keydown",e=>{
var key=e.key,vidSpeed=5,changeSpeed=false
;switch(key){case"q":vidSpeed=3,changeSpeed=true
;break;case"w":vidSpeed=5,changeSpeed=true;break
;case"a":vidSpeed=10,changeSpeed=true;break
;case"s":vidSpeed=16,changeSpeed=true;break
;case"z":
var timeInSec=parseFloat(my_widget_script.getTimeStamp())
;timeInSec-=30,this._vid.currentTime=timeInSec,
$("#addStampButton").select();break;case"c":
var timeInSec=parseFloat(my_widget_script.getTimeStamp())
;timeInSec+=30,this._vid.currentTime=timeInSec
;break;case"x":
if(this._vid.paused)this._vid.play();else this._vid.pause()
;$("#addStampButton").select();break;default:break
}
if(changeSpeed)$("#changeSpeed").val(vidSpeed),this._vid.playbackRate=vidSpeed,
$("#addStampButton").select()
}),$("#removeStampButton").on("click",function(){
var currentState=$("#addStampButton").data("state")
;my_widget_script.removeStampFuncs(currentState)
}),$("#clearStamps").on("click",function(){
var proceed=confirm("Are you sure that you want to remove all time stamps?")
;if(proceed)my_widget_script.resetStamps(my_widget_script._startState)
}),$("#copyDursButton").on("click",function(){
var $errorMsg=$("#errorMsg"),$divForCopy=$("#forCopy")
;my_widget_script.copyDurationsFuncs($errorMsg,$divForCopy)
}),$("#copyTimesButton").on("click",function(){
var $errorMsg=$("#errorMsg"),$divForCopy=$("#forCopy")
;my_widget_script.copyTimeStampsFuncs($errorMsg,$divForCopy)
}),$("#toCSV").on("click",function(){
var fileName="damVideoMonitor",tableID="outTable",$errorMsg=$("#errorMsg")
;my_widget_script.toCSVFuncs(fileName,tableID,$errorMsg)
}),$("#copyDataButton").on("click",function(){
var $copyHead=$("#copyHead"),$tableToCopy=$("#outTable"),$tableDiv=$(".outTableDiv"),$errorMsg=$("#errorMsg"),$divForCopy=$("#forCopy")
;my_widget_script.copyDataFuncs($copyHead,$tableToCopy,$tableDiv,$errorMsg,$divForCopy)
}),$(".simpleCalc").on("input",function(){
var elementID=this.id,calcID="."+elementID+"_calc"
;my_widget_script.watchValue($(this),$(calcID))
}),$(document).on("click",".stampMin:not(.noPlay) a",function(){
var vid=document.getElementById("videoPlayer")
;if(vid.src)vid.currentTime=$(this).attr("rel"),
vid.play(),$("#videoPlayer").focus(),
$("#addStampButton").select();else alert("Select a Video File")
})},changeToState:function(state){
if("off"==state)$("#addStampButton").val("Dam Enters Nest").data("state","off");else if("on"==state)$("#addStampButton").val("Dam Exists Nest").data("state","on");else $("#addStampButton").val("[Enter Start State]").data("state","")
},toggleState:function(currentState){
if("off"==currentState)my_widget_script.changeToState("on");else if("on"==currentState)my_widget_script.changeToState("off")
},addStampFuncs:function(currentState){
if(my_widget_script._vid.src){
my_widget_script.getDuration()
;var $stampsDiv=$(".stampsDiv"),timeInSec=parseFloat(my_widget_script.getTimeStamp())
;if(timeInSec<my_widget_script._duration){
var $previousRow=$stampsDiv.find(".stampRow").last(),previousTime=my_widget_script._stampTimes[my_widget_script._stampTimes.length-1]
;if(timeInSec>previousTime){
var lastDuration=timeInSec-previousTime
;$previousRow.find(".duration").text(lastDuration.toFixed(2)),
my_widget_script._allDurations[my_widget_script._allDurations.length-1]=lastDuration,
my_widget_script._stampTimes[my_widget_script._stampTimes.length]=timeInSec
;var thisDuration=my_widget_script._duration-timeInSec
;if(my_widget_script._allDurations[my_widget_script._allDurations.length]=thisDuration,
"on"==currentState)var movementType="exit",newState="OFF";else if("off"==currentState)var movementType="entry",newState="ON"
;my_widget_script._stampStates[my_widget_script._stampStates.length]=movementType,
my_widget_script.makeStampRow($stampsDiv,movementType,newState,timeInSec,thisDuration),
my_widget_script.addOneToVar(movementType),
my_widget_script.calcValues(),my_widget_script.toggleState(currentState)
}else my_widget_script._vid.pause(),
alert("Must be after previous stamp")}
my_widget_script.resize()}},
makeStampRow:function($div,className,newState,timeInSec,thisDuration){
var timeStamp=my_widget_script.getTimeFromSec(timeInSec)
;$div.append($("<div></div>",{
class:"row stampRow "+className
}).append($("<div></div>",{class:"col state "+className
}).append(newState)).append($("<div></div>",{
class:"col stamp "+className,
"data-movement":className
}).append(timeInSec.toFixed(2))).append($("<div></div>",{
class:"col stampMin "+className
}).append("<a href='javascript:;' rel='"+timeInSec+"' class='bookmarkLink'>"+timeStamp+"</a>")).append($("<div></div>",{
class:"col duration "+className
}).append(thisDuration.toFixed(2))))},
removeStampFuncs:function(currentState){
if(my_widget_script._vid.src){
if("off"==currentState)var className="exit",currentNum=my_widget_script._numExits;else if("on"==currentState)var className="entry",currentNum=my_widget_script._numEntries
;if(currentNum>0){
my_widget_script.getDuration(),$(".stampRow").last().remove(),
my_widget_script._stampTimes.pop(),
my_widget_script._stampStates.pop(),my_widget_script._allDurations.pop()
;var lastDuration=my_widget_script._duration-my_widget_script._stampTimes[my_widget_script._stampTimes.length-1]
;my_widget_script._allDurations[my_widget_script._allDurations.length-1]=lastDuration,
$(".stampRow").last().find(".duration").text(lastDuration.toFixed(2)),
my_widget_script.toggleState(currentState),
my_widget_script.removeOneFromVar(className),
my_widget_script.calcValues(),my_widget_script._vid.pause()
}else alert("No stamps to remove")
;my_widget_script.resize()}},
resetStamps:function(startState){
if(my_widget_script.changeToState(startState),my_widget_script._numEntries=0,
my_widget_script._numExits=0,
my_widget_script._stampTimes=[],my_widget_script._stampStates=[],
my_widget_script._allDurations=[],
$(".stampRow").remove(),"off"==startState)var startState="exit",newState="OFF";else if("on"==startState)var startState="entry",newState="ON"
;my_widget_script.getDuration(),
my_widget_script.makeStampRow($(".stampsDiv"),startState,newState,0,my_widget_script._duration),
my_widget_script._stampTimes=[0],
my_widget_script._stampStates=[startState],my_widget_script._allDurations=[my_widget_script._duration],
my_widget_script.calcValues(),
my_widget_script.resize()},getDuration:function(){
if($("#getDur").is(":checked")&&my_widget_script._vid.src)var duration=my_widget_script._vid.duration;else{
var duration=$("#videoDur").val()
;if(duration)duration=parseFloat(duration);else duration=3600
}
$("#videoDur").val(duration),my_widget_script._duration=duration,$(".videoDur_calc").text(duration)
},getTimeStamp:function(){var timeStamp=""
;if(my_widget_script._vid.src)var timeStamp=my_widget_script._vid.currentTime
;return timeStamp},
getExistingText:function(txtarea){
var existingText=txtarea.value
;if(existingText)existingText+="\n"
;return existingText},
addOneToVar:function(exitOrEntry){
if("entry"==exitOrEntry)my_widget_script._numEntries++;else if("exit"==exitOrEntry)my_widget_script._numExits++
},removeOneFromVar:function(exitOrEntry){
if("entry"==exitOrEntry)my_widget_script._numEntries--;else if("exit"==exitOrEntry)my_widget_script._numExits--
},addOneToCounter:function($counter){
var val=$counter.val()
;if(val)var count=parseInt(val);else var count=0
;count+=1,$counter.val(count)},
removeOneFromCounter:function($counter){
var val=$counter.val();if(val>0){
var count=parseInt(val);count-=1}else var count=0
;$counter.val(count)},
getTimeFromSec:function(timeInSec){
var asDate=new Date
;asDate.setHours(0,0,timeInSec,0)
;var hours=("0"+asDate.getHours()).slice(-2),mins=("0"+asDate.getMinutes()).slice(-2),secs=("0"+asDate.getSeconds()).slice(-2),time=hours+":"+mins+":"+secs
;return time},getHoursMin:function(timeString){
timeString=timeString.split(":")
;var hours=parseInt(timeString[0],10),mins=parseInt(timeString[1],10)
;return split={hours:hours,mins:mins}},
addRequiredFieldIndicators:function(){
$(".needForTableLab").each(function(){
$(this).html("<span style='color:blue'>#</span>"+$(this).html())
}),$(".requiredLab").each(function(){
$(this).html("<span style='color:red'>*</span>"+$(this).html())
})},adjustTextareaHeight:function(txtarea){
txtarea.style.height="auto",txtarea.style.height=txtarea.scrollHeight+"px",
my_widget_script.resize()},
isValidTime:function(timeString){
var regEx="^(((([0-1][0-9])|(2[0-3])):[0-5][0-9]))$"
;if(!timeString.match(regEx))return false;else return true
},isTimeSupported:function(){
var input=document.createElement("input")
;input.setAttribute("type","time")
;var supported=true
;if("time"!==input.type)supported=false
;return my_widget_script.timeSupported=supported,
supported},timeSupported:true,
checkTimeFormat:function($timeInput){
if(!my_widget_script.timeSupported){
$timeInput.next(".timeWarning").remove()
;var time=$timeInput.val(),isValid=my_widget_script.isValidTime(time)
;if(!isValid)$timeInput.after('<div class="text-danger timeWarning">Enter time as "hh:mm" in 24-hr format</div>')
;my_widget_script.resize()}},
isValidDate:function(dateString){
var regEx=/^\d{4}-\d{2}-\d{2}$/
;if(!dateString.match(regEx))return false
;var d=new Date(dateString),dNum=d.getTime()
;if(!dNum&&0!==dNum)return false
;return d.toISOString().slice(0,10)===dateString},
isDateSupported:function(){
var input=document.createElement("input")
;input.setAttribute("type","date")
;var supported=true
;if("date"!==input.type)supported=false
;return my_widget_script.dateSupported=supported,
supported},dateSupported:true,
checkDateFormat:function($dateInput){
if(!my_widget_script.dateSupported){
$dateInput.next(".dateWarning").remove()
;var date=$dateInput.val(),isValid=my_widget_script.isValidDate(date)
;if(!isValid)$dateInput.after('<div class="text-danger dateWarning">Enter date as "YYYY-MM-DD"</div>')
;$dateInput.datepicker({dateFormat:"yy-mm-dd"
}),my_widget_script.resize()}},
setUpInitialState:function(){
my_widget_script.isDateSupported(),my_widget_script.isTimeSupported(),
$("input[type='date']").prop("placeholder","YYYY-MM-DD").on("change",function(){
my_widget_script.checkDateFormat($(this))
}).each(function(){
my_widget_script.checkDateFormat($(this))
}),$("input[type='time']").prop("placeholder","hh:mm").on("change",function(){
my_widget_script.checkTimeFormat($(this))
}).each(function(){
my_widget_script.checkTimeFormat($(this))
}),$(".myLeftCol").addClass("col-12 col-sm-6 col-md-4 col-lg-4 text-left text-sm-right"),
$("textarea.autoAdjust").each(function(){
this.setAttribute("style","height:"+this.scrollHeight+"px;overflow-y:hidden;")
}).on("input",function(){
my_widget_script.adjustTextareaHeight(this)
}),$(".simpleCalc").each(function(){
var elementID=this.id,calcID="."+elementID+"_calc"
;my_widget_script.watchValue($(this),$(calcID))
}),my_widget_script.calcValues(),
my_widget_script.resize()},resize:function(){
my_widget_script.parent_class.resize_container()},
getDynamicContent:function(){var dynamicContent={
fileName:my_widget_script._fileName,
startState:my_widget_script._startState,
duration:my_widget_script._duration,
numExits:my_widget_script._numExits,
numEntries:my_widget_script._numEntries,
stampTimes:my_widget_script._stampTimes,
stampStates:my_widget_script._stampStates,
allDurations:my_widget_script._allDurations}
;return dynamicContent},
data_valid_form:function(){var valid=true
;if($(".needForTable").each(function(){
if(!$(this).val())valid=false
}),!valid)$("#errorMsg").html("<span style='color:red; font-size:36px;'>Please fill out all elements marked by a</span><span style='color:blue; font-size:36px;'> blue #</span>");else $("#errorMsg").html("")
;return valid},
watchValue:function($elToWatch,$elToUpdate){
var value=$elToWatch.val()
;console.log($elToWatch,value),$elToUpdate.text(value)
},calcValues:function(){
for(my_widget_script.getDuration(),$(".numEntries_calc").text(my_widget_script._numEntries),
$(".numExits_calc").text(my_widget_script._numExits),
my_widget_script._entryStamps=[],
my_widget_script._entryDurs=[],my_widget_script._exitStamps=[],
my_widget_script._exitDurs=[],
my_widget_script._timeOnNest=0,my_widget_script._timeOffNest=0,
my_widget_script._avgDurOnNest=0,
my_widget_script._avgDurOffNest=0,i=0;i<my_widget_script._stampStates.length;i++)if("exit"==my_widget_script._stampStates[i])my_widget_script._exitStamps[my_widget_script._exitStamps.length]=my_widget_script._stampTimes[i],
my_widget_script._exitDurs[my_widget_script._exitDurs.length]=my_widget_script._allDurations[i];else if("entry"==my_widget_script._stampStates[i])my_widget_script._entryStamps[my_widget_script._entryStamps.length]=my_widget_script._stampTimes[i],
my_widget_script._entryDurs[my_widget_script._entryDurs.length]=my_widget_script._allDurations[i]
;my_widget_script._timeOffNest=my_widget_script._exitDurs.reduce(function(a,b){
return a+b
},0),my_widget_script._timeOnNest=my_widget_script._entryDurs.reduce(function(a,b){
return a+b
},0),$(".timeOffNest_calc").text(my_widget_script._timeOffNest.toFixed(2)),
$(".timeOnNest_calc").text(my_widget_script._timeOnNest.toFixed(2)),
my_widget_script._avgDurOffNest=my_widget_script._timeOffNest/my_widget_script._exitDurs.length,
my_widget_script._avgDurOnNest=my_widget_script._timeOnNest/my_widget_script._entryDurs.length,
$(".avgDurOffNest_calc").text(my_widget_script._avgDurOffNest.toFixed(2)),
$(".avgDurOnNest_calc").text(my_widget_script._avgDurOnNest.toFixed(2)),
my_widget_script._percOffNest=my_widget_script._timeOffNest/my_widget_script._duration*100,
my_widget_script._percOnNest=my_widget_script._timeOnNest/my_widget_script._duration*100,
$(".percOffNest_calc").text(my_widget_script._percOffNest.toFixed(2)),
$(".percOnNest_calc").text(my_widget_script._percOnNest.toFixed(2)),
$("#outTable tr").each(function(){
$("td",this).each(function(){
var value=$(this).text()
;if(""===value||"NaN"===value)$(this).text("NA")})
}),my_widget_script.GoogleChartTimeLine(),
my_widget_script.resize()},
downloadCSV:function(csv,filename){
var csvFile,downloadLink;csvFile=new Blob([csv],{
type:"text/csv"
}),downloadLink=document.createElement("a"),downloadLink.download=filename,
downloadLink.href=window.URL.createObjectURL(csvFile),
downloadLink.style.display="none",
document.body.appendChild(downloadLink),downloadLink.click()
},exportTableToCSV:function(filename,table){
for(var csv=[],datatable=document.getElementById(table),rows=datatable.querySelectorAll("tr"),i=0;i<rows.length;i++){
for(var row=[],cols=rows[i].querySelectorAll("td, th"),j=0;j<cols.length;j++){
var cellText='"'+cols[j].innerText+'"'
;row.push(cellText)}csv.push(row.join(","))}
var exitStamps=my_widget_script._exitStamps,entryStamps=my_widget_script._entryStamps,row=[]
;for(row.push("OnTimes"),
row.push("OffTimes"),csv.push(row.join(",")),i=0;i<exitStamps.length||i<entryStamps.length;i++){
if(exitStamps[i])var exitTime=exitStamps[i];else var exitTime="NA"
;if(entryStamps[i])var entryTime=entryStamps[i];else var entryTime="NA"
;var row=[]
;row.push(entryTime),row.push(exitTime),csv.push(row.join(","))
}
var exitDurs=my_widget_script._exitDurs,entryDurs=my_widget_script._entryDurs,row=[]
;for(row.push("OnDurations"),
row.push("OffDurations"),csv.push(row.join(",")),i=0;i<exitDurs.length||i<entryDurs.length;i++){
if(exitDurs[i])var exitDur=exitDurs[i];else var exitDur="NA"
;if(entryDurs[i])var entryDur=entryDurs[i];else var entryDur="NA"
;var row=[]
;row.push(entryDur),row.push(exitDur),csv.push(row.join(","))
}this.downloadCSV(csv.join("\n"),filename)},
copyTable:function($table,copyHead,$divForCopy){
var $temp=$("<text"+"area style='opacity:0;'></text"+"area>"),addLine=""
;if(copyHead)$table.find("thead").children("tr").each(function(){
var addTab="";$(this).children().each(function(){
$temp.text($temp.text()+addTab+$(this).text()),
addTab="\t"})}),addLine="\n"
;$table.find("tbody").children("tr").each(function(){
$temp.text($temp.text()+addLine);var addTab=""
;$(this).find("td").each(function(){
if($(this).text())var addText=$(this).text();else var addText="NA"
;$temp.text($temp.text()+addTab+addText),
addTab="\t",addLine="\n"})
}),$temp.appendTo($divForCopy).focus().select(),document.execCommand("copy"),
$temp.remove()},
copyDurations:function($divForCopy){
var $temp=$("<text"+"area style='opacity:0;'></text"+"area>"),addLine=""
;$temp.text("OnDurations\tOffDurations")
;var exitDurs=my_widget_script._exitDurs,entryDurs=my_widget_script._entryDurs
;for(i=0;i<exitDurs.length||i<entryDurs.length;i++){
if(exitDurs[i])var exitDur=exitDurs[i];else var exitDur="NA"
;if(entryDurs[i])var entryDur=entryDurs[i];else var entryDur="NA"
;$temp.text($temp.text()+"\n"+entryDur+"\t"+exitDur)
}
$temp.appendTo($divForCopy).focus().select(),document.execCommand("copy"),$temp.remove()
},copyTimeStamps:function($divForCopy){
var $temp=$("<text"+"area style='opacity:0;'></text"+"area>"),addLine=""
;$temp.text("OnTimes\tOffTimes")
;var exitStamps=my_widget_script._exitStamps,entryStamps=my_widget_script._entryStamps
;for(i=0;i<exitStamps.length||i<entryStamps.length;i++){
if(exitStamps[i])var exitTime=exitStamps[i];else var exitTime="NA"
;if(entryStamps[i])var entryTime=entryStamps[i];else var entryTime="NA"
;$temp.text($temp.text()+"\n"+entryTime+"\t"+exitTime)
}
$temp.appendTo($divForCopy).focus().select(),document.execCommand("copy"),$temp.remove()
},calcTableFuncs:function(){
my_widget_script.data_valid_form(),my_widget_script.calcValues()
},toCSVFuncs:function(fileName,tableID,$errorMsg){
var data_valid=my_widget_script.data_valid_form()
;if(data_valid)my_widget_script.calcValues(),
my_widget_script.exportTableToCSV(fileName,tableID),
$errorMsg.html("<span style='color:grey; font-size:24px;'>Saved successfully</span>");else $errorMsg.append("<br/><span style='color:grey; font-size:24px;'>Did not export</span>")
},
copyDataFuncs:function($copyHead,$tableToCopy,$tableDiv,$errorMsg,$divForCopy){
var data_valid=my_widget_script.data_valid_form(),copyHead
;if($copyHead.is(":checked"))copyHead=true;else copyHead=false
;if(my_widget_script.calcValues(),
data_valid)$tableDiv.show(),my_widget_script.resize(),
my_widget_script.copyTable($tableToCopy,copyHead,$divForCopy),
$errorMsg.html("<span style='color:grey; font-size:24px;'>Copied successfully</span>");else $errorMsg.append("<br/><span style='color:grey; font-size:24px;'>Nothing was copied</span>")
},
copyDurationsFuncs:function($errorMsg,$divForCopy){
var data_valid=my_widget_script.data_valid_form()
;if(my_widget_script.calcValues(),
data_valid)my_widget_script.copyDurations($divForCopy),
$errorMsg.html("<span style='color:grey; font-size:24px;'>Copied successfully</span>");else $errorMsg.append("<br/><span style='color:grey; font-size:24px;'>Nothing was copied</span>")
},
copyTimeStampsFuncs:function($errorMsg,$divForCopy){
var data_valid=my_widget_script.data_valid_form()
;if(my_widget_script.calcValues(),
data_valid)my_widget_script.copyTimeStamps($divForCopy),
$errorMsg.html("<span style='color:grey; font-size:24px;'>Copied successfully</span>");else $errorMsg.append("<br/><span style='color:grey; font-size:24px;'>Nothing was copied</span>")
},GoogleChartTimeLine:function(){
function drawChart(){
var container=document.getElementById("example3.1"),dataTable=new google.visualization.DataTable
;dataTable.addColumn({type:"string",id:"Position"
}),dataTable.addColumn({type:"date",id:"Start"
}),dataTable.addColumn({type:"date",id:"End"})
;var startTime=$("#recTime").val()
;if(startTime)var splitTime=my_widget_script.getHoursMin(startTime),startHour=splitTime.hours;else startHour=0
;for(i=0;i<my_widget_script._stampStates.length;i++){
var movement="",time=NaN,duration=NaN
;movement=my_widget_script._stampStates[i],
time=my_widget_script._stampTimes[i],
duration=my_widget_script._allDurations[i]
;var state=""
;if("exit"==movement)state="OFF Nest";else if("entry"==movement)state="ON Nest"
;dataTable.addRows([[state,new Date(0,0,0,startHour,0,time),new Date(0,0,0,startHour,0,time+duration)]])
}
if("off"==my_widget_script._startState)colors=["#f4c8ce","#ccdbf6"];else if("on"==my_widget_script._startState)colors=["#ccdbf6","#f4c8ce"]
;var options={hAxis:{title:"Time"},colors:colors,
avoidOverlappingGridLines:false
},container=document.getElementById("chart_div"),chart=new google.visualization.Timeline(container)
;chart.draw(dataTable,options)}
google.charts.load("current",{
packages:["timeline"]
}),google.charts.setOnLoadCallback(drawChart)}};
//**************************************************************************
//End of your code
//**************************************************************************
//**************************************************************************
      //the parent class functionality is added to your class below.
      form_script.parent_class = parent_form_script;
      //**************************************************************************
      //**************************************************************************
      //call to the init function in your script.  Note that you can change the mode in the call here.
      //your choices are view,view_dev,edit,edit_dev,  see the parent class source for details
      form_script.init("edit", function() {return form_script.test_data()});


    }
)

}
catch (e) {

}

parent_form_script.wiget_version_info ={"version":20,"created":"2020-12-29T22:00:23-05:00","last_modified_at":"2021-01-03T18:51:34-05:00","last_modified_by":"Amanda Gibson","owned_by":"unknown"};

</script>
<form id="the_form" style="display:table">
<!------------------------------------------------------------------------------------------>
<!--the html for your tool goes here.  Paste it into the LA dev tool when you have it the way you want it-->
<!------------------------------------------------------------------------------------------>
<!-- #region HTML -->
<!-- Google Charts --><script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script><!-- Bootstrap CSS -->
<link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" rel="stylesheet" /><!-- Load jQuery for Bootstrap --><script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><!-- Load bootstrap java --><script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script><!-- Call no conflict to reassign this newer jQuery off of $ and jquery--><script>
    var $jq351 = jQuery.noConflict(true);
</script>
<style type="text/css">/* TO DO Place css styling code here */

    /* responsive table doesn't work with xs screen sizes for some reason, so apply a specific width for these */
    @media (max-width: 576px) {
        .xsTableDiv {
            width: 300px !important;
            overflow-x: scroll;
        }
    }

    table {
        border: 2px solid black;
    }

    th {
        padding: 5px;
        border: 2px solid black;
    }

    td {
        padding: 5px;
        border: 1px solid black;
    }

    .fullWidth {
        width: 90%
    }

    .noPlay>a {
        color: black;
        text-decoration: none;
        cursor:inherit;
    }

    .stampRow.entry {
        background-color:#ccdbf6
    }

    .stampRow.exit{
        background-color: #f4c8ce;
    }
</style>
<!-- TO DO Begin typing your HTML code here -->
<div class="container">
<p>Elements that are required to save this page are marked with a red asterisk <span style="color:red">*</span><br />
Elements that are required to copy the table or save to CSV are marked with a blue pound sign <span style="color:blue">#</span></p>
</div>

<div class="container">
<div class="row">
<h3 class="col">Dam Information</h3>
</div>

<div class="row mt-2">
<div class="myLeftCol">Dam ID:</div>

<div class="col"><input class="fullWidth simpleCalc" id="damID" name="damid" type="text" /></div>
</div>

<div class="row mt-2">
<div class="myLeftCol">PND:</div>

<div class="col"><input class="fullWidth simpleCalc" id="pnd" name="pnd" type="number" /></div>
</div>

<div class="row mt-2">
<div class="myLeftCol">Zeitgeber Time:</div>

<div class="col"><input class="fullWidth simpleCalc" id="zt" max="24" min="0" name="zt" type="number" /></div>
</div>

<div class="row mt-2">
<div class="myLeftCol">Recording Date:</div>

<div class="col"><input class="fullWidth" id="recDate" name="recdate" type="date" /></div>
</div>

<div class="row mt-2">
<div class="myLeftCol">Recording Time:</div>

<div class="col"><input class="fullWidth" id="recTime" name="rectime" type="time" /></div>
</div>
</div>

<div class="container">
<h3>File Information</h3>

<div class="row align-items-end hideView">
<div class="myLeftCol">Select video file:</div>

<div class="col"><input id="myfile" name="myfile" type="file" />&nbsp;</div>
</div>

<div class="row mt-2 align-items-end">
<div class="myLeftCol">File Name:</div>

<div class="col"><span class="filePath">[Select a file]</span></div>
</div>

<div class="row mt-2 align-items-end hideView">
<div class="myLeftCol">Playback speed:</div>

<div class="col"><input id="changeSpeed" name="changespeed" type="number" value="5" /></div>
</div>

<div class="row mt-2">
<div class="myLeftCol">Duration (in sec):</div>

<div class="col"><input class="simpleCalc" id="videoDur" name="videodur" step="any" type="number" value="3600" /> <span class="hideView">Get duration automatically: </span><input checked="checked" class="hideView" id="getDur" name="getdur" type="checkbox" /></div>
</div>
</div>

<div class="container mt-2 hideView">
<div class="row">
<h3 class="col">Add Time Stamps</h3>
</div>

<div class="row mt-2">
<div class="myLeftCol requiredLab">Starting State of Dam:</div>

<div class="col"><select class="fullWidth" id="startState" name="startstate" required=""><option value="">[Select]</option><option value="off">Off nest</option><option value="on">On nest</option> </select></div>
</div>

<div class="row mt-2">
<div class="myLeftCol">Clear all stamps:</div>

<div class="col"><input class="disableOnView fullWidth" id="clearStamps" name="clearstamps" type="button" value="Clear all stamps" /></div>
</div>

<div class="row mt-2">
<div class="myLeftCol">Undo last stamp:</div>

<div class="col"><input class="disableOnView fullWidth" disabled="disabled" id="removeStampButton" name="removestampbutton" type="button" value="Undo last stamp" /></div>
</div>

<div class="row mt-2">
<div class="myLeftCol">Keys to change video</div>

<div class="col"><code>q</code> = 3x; <code>w</code> = 5x; <code>a</code> = 10x; <code>s</code> = 16x<br />
<code>z</code> = back 30 sec; <code>x</code> = play/pause; <code>c</code> = forward 30 sec<br />
<em>work when focus is on add entry/exit button</em></div>
</div>

<div class="row mt-2">
<div class="myLeftCol">Press to add stamp:</div>

<div class="col"><input class="disableOnView fullWidth" disabled="disabled" id="addStampButton" name="addstampbutton" type="button" value="[Enter Start State]" /></div>
</div>
</div>

<div class="container mt-2 videoDiv hideView">
<h3>Video Playback:</h3>

<video controls="" id="videoPlayer" name="videoplayer">&nbsp;</video>
</div>

<div class="container mt-2 stampsDiv">
<div class="row">
<div class="col">
<h4>State</h4>
</div>

<div class="col">
<h4>At time: (sec)</h4>
</div>

<div class="col">
<h4>Time Stamp:</h4>
</div>

<div class="col">
<h4>Duration: (sec)</h4>
</div>
</div>
</div>

<div class="container mt-4">
<div class="row mt-2">
<div class="col-12 col-sm-6 col-md-3"><input class="fullWidth" id="copyDataButton" name="copydatabutton" type="button" value="Copy Output Data" /><br />
Copy Table Head? <input id="copyHead" name="copyhead" type="checkbox" /></div>

<div class="col-12 col-sm-6 col-md-3"><input class="fullWidth" id="toCSV" name="tocsv" type="button" value="Save CSV" /></div>

<div class="col-12 col-sm-6 col-md-3"><input class="fullWidth" id="copyDursButton" name="copydursbutton" type="button" value="Copy Durations" /></div>

<div class="col-12 col-sm-6 col-md-3"><input class="fullWidth" id="copyTimesButton" name="copytimesbutton" type="button" value="Copy Times" /></div>
</div>
</div>

<div id="forCopy">&nbsp;</div>
<!-- Error Message Div -->

<div class="container" id="errorMsg">&nbsp;</div>
<!-- Example Table Container that is responsive to window width, including for xs -->

<div class="container mt-2">
<div class="table-responsive xsTableDiv outTableDiv">
<table class="table" id="outTable">
	<thead>
		<tr>
			<th>damID</th>
			<th>PND</th>
			<th>ZT</th>
			<th>Duration</th>
			<th>Num_exits</th>
			<th>Num_entries</th>
			<th>Time_off_nest</th>
			<th>Time_on_nest</th>
			<th>Perc_off_nest</th>
			<th>Perc_on_nest</th>
			<th>Avg_dur_off_nest</th>
			<th>Avg_dur_on_nest</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td class="damID_calc">&nbsp;</td>
			<td class="pnd_calc">&nbsp;</td>
			<td class="zt_calc">&nbsp;</td>
			<td class="videoDur_calc">&nbsp;</td>
			<td class="numExits_calc">&nbsp;</td>
			<td class="numEntries_calc">&nbsp;</td>
			<td class="timeOffNest_calc">&nbsp;</td>
			<td class="timeOnNest_calc">&nbsp;</td>
			<td class="percOffNest_calc">&nbsp;</td>
			<td class="percOnNest_calc">&nbsp;</td>
			<td class="avgDurOffNest_calc">&nbsp;</td>
			<td class="avgDurOnNest_calc">&nbsp;</td>
		</tr>
	</tbody>
</table>

<p>&nbsp;</p>
</div>
</div>

<div class="container mt-2">
<div class="row">
<h3 class="col">Timeline</h3>
</div>

<div class="row">
<div class="col" id="chart_div" style="height: 150px;">&nbsp;</div>
</div>
</div>




<!-- #endregion -->
<!------------------------------------------------------------------------------------------>
<!--end of your code-->
<!------------------------------------------------------------------------------------------>

</form>
</body>
</html>