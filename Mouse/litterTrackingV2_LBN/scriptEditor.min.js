my_widget_script={possibleMassDays:[],treatStart:NaN,treatEnd:NaN,init:function(mode,json_data){this.include("https://code.jquery.com/jquery-3.5.1.min.js","sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=","anonymous",()=>{$(document).ready(()=>{
this.include("https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js","sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl","anonymous",()=>{$(document).ready(()=>{
this.include("https://cdn.jsdelivr.net/npm/luxon@1.26.0/build/global/luxon.min.js","sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0=","anonymous",()=>{$(document).ready(()=>{
this.include("https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.min.js","sha512-RdSPYh1WA6BF0RhpisYJVYkOyTzK4HwofJ3Q7ivt/jkpW6Vc8AurL1R+4AUcvn9IwEKAPm/fk7qFZW3OuiUDeg==","anonymous",()=>{$(document).ready(()=>{$jq351=jQuery.noConflict(true),this.myInit(mode,json_data)})})})})})})})})},
include:function(src,integrity,crossorigin,onload){var head=document.getElementsByTagName("head")[0],script=document.createElement("script");script.setAttribute("integrity",integrity),script.setAttribute("crossorigin",crossorigin),script.src=src,script.type="text/javascript",
script.onload=script.onreadystatechange=function(){if(script.readyState){if("complete"===script.readyState||"loaded"===script.readyState)script.onreadystatechange=null,onload()}else onload()},head.appendChild(script)},myInit:function(mode,json_data){my_widget_script.createMassDivs()
;var parsedJson=this.parseInitJson(json_data);this.initDynamicContent(parsedJson),window.onresize=this.resize,this.addEventListeners(),this.parent_class.init(mode,()=>JSON.stringify(parsedJson.widgetData)),this.setUpInitialState(parsedJson),this.adjustForMode(mode)},to_json:function(){
var widgetJsonString=this.parent_class.to_json(),dynamicContent=this.getDynamicContent(),output={widgetData:JSON.parse(widgetJsonString),numPupsStart:dynamicContent.numPupsStart,numPupsEnd:dynamicContent.numPupsEnd,tailMarksEnd:dynamicContent.tailMarksEnd,selectedDays:dynamicContent.selectedDays}
;return JSON.stringify(output)},from_json:function(json_data){var parsedJson=JSON.parse(json_data);this.parent_class.from_json(JSON.stringify(parsedJson.widgetData))},test_data:function(){var testData=JSON.parse(this.parent_class.test_data()),tailMarksEnd=[]
;tailMarksEnd[0]="<span style='color:blue'>Test</span>",tailMarksEnd[1]="<span style='color:red'>Test2</span>";var tailMarksP9=[];tailMarksP9[0]="<span style='color:blue'>P9 Test</span>",tailMarksP9[1]="<span style='color:red'>P9 Test2</span>",
tailMarksP9[2]="<span style='color:blue'>P9 Test3</span>";var output={widgetData:testData,numPupsStart:3,numPupsEnd:2,tailMarksEnd:tailMarksEnd,selectedDays:[14,15]};return JSON.stringify(output)},is_valid:function(b_suppress_message){var fail=false,fail_log="",name
;if($("#the_form").find("select, textarea, input").each(function(){if(!$(this).prop("required"));else if(!$(this).val())fail=true,name=$(this).attr("id"),fail_log+=name+" is required \n"}),$("input[type='date']").each(function(){var date=$(this).val();if(date){
var validDate=my_widget_script.isValidDate(date);if(!validDate)fail=true,fail_log+="Please enter valid date in form 'YYYY-MM-DD'"}}),$("input[type='time']").each(function(){var time=$(this).val();if(time){var validtime=my_widget_script.isValidTime(time);if(!validtime)fail=true,
fail_log+="Please enter valid time in form 'hh:mm' - 24 hr time"}}),fail)return bootbox.alert (fail_log);else{var noErrors=[];return noErrors}},is_edited:function(){return this.parent_class.is_edited()},reset_edited:function(){return this.parent_class.reset_edited()},
parseInitJson:function(json_data){var jsonString;if("string"===typeof json_data)jsonString=json_data;else jsonString=json_data();var parsedJson=JSON.parse(jsonString);return parsedJson},initDynamicContent:function(parsedJson){for(var i=0;i<parsedJson.numPupsStart;i++){var $avgMass=$(".avgMassStart")
;my_widget_script.createRow_startPara($avgMass)}for(var i=0;i<parsedJson.numPupsEnd;i++){my_widget_script.createRow_offDemo();var mouseNum=i+1,dataSearch=my_widget_script.dataSearch("mouse",mouseNum),$tailMark=$(".tailMark"+dataSearch);$tailMark.html(parsedJson.tailMarksEnd[i]),
my_widget_script.createRows_allMassDivs()}$(".numPupsStart").text(parsedJson.numPupsStart),$(".numPupsEnd").text(parsedJson.numPupsEnd)},adjustForMode:function(mode){if("edit"!==mode&&"edit_dev"!==mode){if($(".hideView").hide(),$(".massDiv.demo").show(),$(".offspringDemoEnd").hide(),
$("#treatmentPeriod").val())$("#offspringMassOutDiv").show(),$("#damOutDiv").show();$("input[type='date']").removeClass(".hasDatePicker")}else $("input[type='date']").each(function(){my_widget_script.checkDateFormat($(this))}),$("input[type='time']").each(function(){
my_widget_script.checkTimeFormat($(this))})},addEventListeners:function(){$("#damID").on("input",function(){for(var i=0;i<my_widget_script.countPups($(".offspringDemoEnd"));i++){var mouseNum=i+1,earTag=$(".offID"+my_widget_script.dataSearch("mouse",mouseNum)).val()
;my_widget_script.updateOffspringID(mouseNum,earTag)}}),$("#changeSelMassDays").on("change",function(){my_widget_script.showWithCheck($(this),$("#selectMassDays"))}),$("#selectMassDays").on("input",function(){my_widget_script.updateSelectedMassDays()}),$("#toggleTable").on("click",function(){
my_widget_script.data_valid_form(),$("#offspringMassOutDiv").toggle(),my_widget_script.resize()}),$("#toggleTableDemo").on("click",function(){my_widget_script.data_valid_form(),$("#offspringDemoOutDiv").toggle(),my_widget_script.resize()}),$("#toggleTableDam").on("click",function(){
my_widget_script.data_valid_form(),$("#damOutDiv").toggle(),my_widget_script.resize()}),$("#toCSV").on("click",function(){my_widget_script.runCSV_buttonFunc("offspring")}),$("#toCSVDemo").on("click",function(){my_widget_script.runCSV_buttonFunc("demo")}),$("#toCSVDam").on("click",function(){
my_widget_script.runCSV_buttonFunc("dam")}),$("#copyDataButton").on("click",function(){my_widget_script.copyData_buttonFunc("offspring",$("#copyHead"))}),$("#copyDataButtonDemo").on("click",function(){my_widget_script.copyData_buttonFunc("demo",$("#copyHeadDemo"))}),
$("#copyDataButtonDam").on("click",function(){my_widget_script.copyData_buttonFunc("dam",$("#copyHeadDam"))}),$("#DOB").on("input",function(){my_widget_script.printPND_days();var pndToday=my_widget_script.getPND_today();if(my_widget_script.switchMassDiv(pndToday),
-1!==$.inArray(pndToday,my_widget_script.possibleMassDays))$("#massDay").val(pndToday);else $("#massDay").val("0");my_widget_script.resize()}),$("#treatmentPeriod").on("change",function(){my_widget_script.switchTreatmentPeriod($(this).val()),my_widget_script.resize()}),
$("#showDates").on("change",function(){if($(this).is(":checked"))$("#datesList").show();else $("#datesList").hide();my_widget_script.resize()}),$("#addPupStart").on("click",function(){var $table=$("#offspringMassStart"),$numPups=$(".numPupsStart"),$avgMass=$(".avgMassStart")
;my_widget_script.addPupStartFuncs($table,$numPups,$avgMass)}),$("#removePupStart").on("click",e=>{var $div=$("#offspringMassStart"),$avgMass=$(".avgMassStart"),$numPups=$(".numPupsStart");this.removePupStartFuncs($div,$numPups,$avgMass,e.currentTarget)}),$("#addPupEnd").on("click",function(){
var $div=$(".offspringDemoEnd"),$numPups=$(".numPupsEnd");my_widget_script.addPupEndFuncs($div,$numPups)}),$("#removePupEnd").on("click",e=>{var $div=$(".offspringDemoEnd"),$numPups=$(".numPupsEnd");this.removePupEndFuncs($div,$numPups,e.currentTarget)}),$("#massDay").on("change",function(){
var day=parseInt($(this).val());my_widget_script.switchMassDiv(day),my_widget_script.resize()})},isValidTime:function(timeString){var regEx="^(((([0-1][0-9])|(2[0-3])):[0-5][0-9]))$";if(!timeString.match(regEx))return false;else return true},isTimeSupported:function(){
var input=document.createElement("input");input.setAttribute("type","time");var supported=true;if("time"!==input.type)supported=false;return my_widget_script.timeSupported=supported,input.remove(),supported},timeSupported:true,checkTimeFormat:function($timeInput){if(!my_widget_script.timeSupported){
$timeInput.next(".timeWarning").remove();var time=$timeInput.val(),isValid=my_widget_script.isValidTime(time);if(!isValid)$timeInput.after('<div class="text-danger timeWarning">Enter time as "hh:mm" in 24-hr format</div>');my_widget_script.resize()}},isValidDate:function(dateString){
var regEx=/^\d{4}-\d{2}-\d{2}$/;if(!dateString.match(regEx))return false;var d=new Date(dateString),dNum=d.getTime();if(!dNum&&0!==dNum)return false;return d.toISOString().slice(0,10)===dateString},isDateSupported:function(){var input=document.createElement("input");input.setAttribute("type","date")
;var supported=true;if("date"!==input.type)supported=false;return my_widget_script.dateSupported=supported,input.remove(),supported},dateSupported:true,checkDateFormat:function($dateInput){if(!my_widget_script.dateSupported){$dateInput.next(".dateWarning").remove()
;var date=$dateInput.val(),isValid=my_widget_script.isValidDate(date);if(!isValid)$dateInput.after('<div class="text-danger dateWarning">Enter date as "YYYY-MM-DD"</div>');$dateInput.datepicker({dateFormat:"yy-mm-dd"}),my_widget_script.resize()}},setUpInitialState:function(parsedJson){
if($(".myLeftCol").addClass("col-12 col-sm-6 col-md-4 col-lg-3 col-xl-2 text-left text-sm-right"),$(".myLeftCol2").addClass("col-6 col-md-4 col-lg-3 col-xl-2 text-right"),my_widget_script.isDateSupported(),my_widget_script.isTimeSupported(),
$("input[type='date']").prop("placeholder","YYYY-MM-DD").on("change",function(){my_widget_script.checkDateFormat($(this))}),$("input[type='time']").prop("placeholder","hh:mm").on("change",function(){my_widget_script.checkTimeFormat($(this))}),$("#DOB").val())my_widget_script.printPND_days()
;if(my_widget_script.showWithCheck($("#changeSelMassDays"),$("#selectMassDays")),my_widget_script.switchTreatmentPeriod($("#treatmentPeriod").val()),$(".totalMass").each(function(){var $totalMass=$(this);my_widget_script.getIndividualMass($totalMass)}),
my_widget_script.offspringCalculations($("#offspringMassStart"),$(".numPupsStart"),$(".avgMassStart")),my_widget_script.showWithCheck($("#showDates"),$("#datesList")),parsedJson.selectedDays)$("#selectMassDays").val(parsedJson.selectedDays);my_widget_script.updateSelectedMassDays()
;for(var numPupsEnd=my_widget_script.countPups($(".offspringDemoEnd")),i=0;i<numPupsEnd;i++){var mouseNum=i+1,mouseSearch=my_widget_script.dataSearch("mouse",mouseNum),earTag=$(".offID"+mouseSearch).val();my_widget_script.updateOffspringID(mouseNum,earTag);var sex=$(".sex"+mouseSearch).val()
;my_widget_script.updateOffspringSex(mouseNum,sex),my_widget_script.updateTailMark(mouseNum,"");for(var massDays=[9,10,11,12,13,14,15,16,17,18,19,20,21],j=0;j<massDays.length;j++)my_widget_script.updateOffspringMass(massDays[j],mouseNum)}$(".simpleCalc").each(function(){
var elementID=this.id,calcID="."+elementID+"_calc";my_widget_script.watchValue($(this),$(calcID))}).on("input",function(){var elementID=this.id,calcID="."+elementID+"_calc";my_widget_script.watchValue($(this),$(calcID))}),$(".start.damMass").on("input",function(){
var massPrint="NA",mass=$(this).val();if(mass)massPrint=parseFloat(mass).toFixed(1);if(2==my_widget_script.treatStart)$(".damMassCalc"+my_widget_script.dataSearch("pnd",2)).text(massPrint),
$(".damMassCalc"+my_widget_script.dataSearch("pnd",4)).text("NA");else if(4==my_widget_script.treatStart)$(".damMassCalc"+my_widget_script.dataSearch("pnd",4)).text(massPrint),$(".damMassCalc"+my_widget_script.dataSearch("pnd",2)).text("NA")}).each(function(){var massPrint="NA",mass=$(this).val()
;if(mass)massPrint=parseFloat(mass).toFixed(1);if(2==my_widget_script.treatStart)$(".damMassCalc"+my_widget_script.dataSearch("pnd",2)).text(massPrint),
$(".damMassCalc"+my_widget_script.dataSearch("pnd",4)).text("NA");else if(4==my_widget_script.treatStart)$(".damMassCalc"+my_widget_script.dataSearch("pnd",4)).text(massPrint),$(".damMassCalc"+my_widget_script.dataSearch("pnd",2)).text("NA")}),$(".end.damMass").on("input",function(){
var massPrint="NA",mass=$(this).val();if(mass)massPrint=parseFloat(mass).toFixed(1);if(9==my_widget_script.treatEnd)$(".damMassCalc"+my_widget_script.dataSearch("pnd",9)).text(massPrint),
$(".damMassCalc"+my_widget_script.dataSearch("pnd",11)).text("NA");else if(11==my_widget_script.treatEnd)$(".damMassCalc"+my_widget_script.dataSearch("pnd",11)).text(massPrint),$(".damMassCalc"+my_widget_script.dataSearch("pnd",9)).text("NA")}).each(function(){var massPrint="NA",mass=$(this).val()
;if(mass)massPrint=parseFloat(mass).toFixed(1);if(9==my_widget_script.treatEnd)$(".damMassCalc"+my_widget_script.dataSearch("pnd",9)).text(massPrint),
$(".damMassCalc"+my_widget_script.dataSearch("pnd",11)).text("NA");else if(11==my_widget_script.treatEnd)$(".damMassCalc"+my_widget_script.dataSearch("pnd",11)).text(massPrint),$(".damMassCalc"+my_widget_script.dataSearch("pnd",9)).text("NA")}),my_widget_script.resize()},resize:function(){
my_widget_script.parent_class.resize_container()},getDynamicContent:function(){for(var numPupsStart=my_widget_script.countPups($("#offspringMassStart")),numPupsEnd=my_widget_script.countPups($(".offspringDemoEnd")),tailMarksEnd=[],i=0;i<numPupsEnd;i++){
var mouseNum=i+1,tailMarkText=my_widget_script.updateTailMark(mouseNum,"");tailMarksEnd[i]=tailMarkText}$("#selectMassDays").prop("disabled",false),$("#selectMassDays").find("option").prop("disabled",false);var dynamicContent={numPupsStart:numPupsStart,numPupsEnd:numPupsEnd,
tailMarksEnd:tailMarksEnd,selectedDays:$("#selectMassDays").val()};return dynamicContent},data_valid_form:function(){var valid=true;if($(".needForTable").each(function(){if(!$(this).val())valid=false}),
!valid)$("#errorMsg").html("<span style='color:red; font-size:36px;'>Please fill out all elements marked by a</span><span style='color:blue; font-size:36px;'> blue #</span>");else $("#errorMsg").html("");return valid},showWithCheck:function($chbx,$toToggle){
if($chbx.is(":checked"))$toToggle.show();else $toToggle.hide();my_widget_script.resize()},hideWithCheck:function($chbx,$toToggle){if($chbx.is(":checked"))$toToggle.hide();else $toToggle.show();my_widget_script.resize()},dataSearch:function(dataName,dataValue){
var dataSearch="[data-"+dataName+"='"+dataValue+"']";return dataSearch},getLocalDateString:function(){var dateTodayString=luxon.DateTime.now().toISODate();return dateTodayString},switchTreatmentPeriod:function(selectionVal){var start,end,possibleDays=[];switch(selectedDays=[],selectionVal){case"":
start="",end="",possibleDays=[],selectedDays=[],$(".selectPara").hide();break;case"p2_9":start=2,end=9,possibleDays=[10,11,12,13,14,15,16,17,18,19,20],selectedDays=[true,true,true,true,false,true,false,true,false,true,false],$(".selectPara").show();break;case"p4_11":start=4,end=11,
possibleDays=[12,13,14,15,16,17,18,19,20],selectedDays=[true,true,true,true,true,true,true,true,true],$(".selectPara").show();break}if($(".start").attr("data-pnd",start),$(".end").attr("data-pnd",end),my_widget_script.treatStart=start,my_widget_script.treatEnd=end,$(".paraTypeCalc").text(start),
$(".start.pndNum").text(start),$(".end.pndNum").text(end),end)$(".end.massSelectOption").text("PND "+end).val(end);else $(".end.massSelectOption").text("[Select Paradigm Days]").val("");var damPNDs=[2,9,4,11];for(i=0;i<damPNDs.length;i++){var pnd=damPNDs[i];my_widget_script.updateDamMass(pnd)}
var $selectDays=$("#selectMassDays");for($selectDays.html(""),i=0;i<possibleDays.length;i++){var pnd=possibleDays[i],daySelected=selectedDays[i];$selectDays.append($("<option/>",{value:pnd,selected:daySelected}).append("P"+pnd))}my_widget_script.updateSelectedMassDays()},
updateSelectedMassDays:function(){var massDays=$("#selectMassDays").val(),$select=$("#massDay"),$datesList=$("#datesList");$select.find(".added").remove(),$datesList.find(".added").remove();var divClass="col-12 col-sm-6 col-md-4 added";if(massDays)for(i=0;i<massDays.length;i++){var pnd=massDays[i]
;$select.find(".last").before($("<option/>",{value:pnd,"data-pnd":pnd,class:"added"}).append("PND "+pnd)),$datesList.find(".last").before($("<div/>",{class:divClass}).append("<strong class='pndNum' data-pnd='"+pnd+"'>PND "+pnd+": </strong>").append($("<span/>",{class:"pndDateShort","data-pnd":pnd
})))}var possibleMassDays=[];$("#massDay option").each(function(){possibleMassDays[possibleMassDays.length]=parseInt($(this).val())}),my_widget_script.possibleMassDays=possibleMassDays;var pndToday=my_widget_script.getPND_today();if(my_widget_script.switchMassDiv(pndToday),
pndToday&&-1!==$.inArray(pndToday,possibleMassDays))$("#massDay").val(pndToday);else $("#massDay").val("0");my_widget_script.updateMassOutput(),my_widget_script.printPND_days()},switchMassDiv:function(selectionVal){if(selectionVal&&-1!==$.inArray(selectionVal,my_widget_script.possibleMassDays)){
var dataSearch=my_widget_script.dataSearch("pnd",selectionVal);$(".massDiv"+dataSearch).show(),$(".massDiv").not(dataSearch).hide()}else $(".massDiv").hide(),$(".massDiv.demo").show()},addDays:function($startDateVal,$newDateClass,numDays){var newDate=luxon.DateTime.fromISO($startDateVal).plus({
days:numDays}).toLocaleString({weekday:"long",month:"long",day:"numeric",year:"numeric"});$newDateClass.text(newDate)},addDaysShort:function($startDateVal,$newDateClass,numDays){var newDate=luxon.DateTime.fromISO($startDateVal).plus({days:numDays}).toLocaleString({weekday:"long",month:"short",
day:"numeric"});$newDateClass.text(newDate)},printPND_days:function(){var $DOBVal=$("#DOB").val();if($DOBVal){var pnds=[2,4,9,10,11,12,13,14,15,16,17,18,19,20,21];for(i=0;i<pnds.length;i++){var pnd=pnds[i],dataSearch=my_widget_script.dataSearch("pnd",pnd)
;my_widget_script.addDays($("#DOB").val(),$(".pndDate"+dataSearch),pnd),my_widget_script.addDaysShort($("#DOB").val(),$(".pndDateShort"+dataSearch),pnd)}}my_widget_script.resize()},getPND_today:function(){var $DOBVal=$("#DOB").val();if($DOBVal){
var startDate=luxon.DateTime.fromISO($DOBVal).startOf("day"),todayDate=luxon.DateTime.now().startOf("day"),dateDiff_days=todayDate.diff(startDate,"days").as("day"),dataSearch=my_widget_script.dataSearch("pnd",dateDiff_days);return $(".pndDateShort"+dataSearch).css("color","red"),
$(".pndDateShort").not(dataSearch).css("color","black"),$(".pndToday").text(dateDiff_days),my_widget_script.updateToDoStatus(dateDiff_days),dateDiff_days}},updateToDoStatus:function(PND_today){var $toDoStatus=$(".toDoStatus")
;if(PND_today==my_widget_script.treatStart)$toDoStatus.html("<span style='color:red'>Start the paradigm today and take masses</span>");else if(my_widget_script.treatStart>0&&PND_today==my_widget_script.treatStart+1)$toDoStatus.html("<span style='color:black'>Begin video monitoring today</span>");else if(my_widget_script.treatStart>0&&PND_today==my_widget_script.treatStart+2)$toDoStatus.html("<span style='color:black'>End video monitoring today</span>");else if(my_widget_script.treatEnd>0&&PND_today==my_widget_script.treatEnd)$toDoStatus.html("<span style='color:red'>Stop the paradigm today, ear tag, and take masses</span>");else if(21==PND_today)$toDoStatus.html("<span style='color:red'>Wean and take masses</span>");else if(-1!==$.inArray(PND_today,my_widget_script.possibleMassDays))$toDoStatus.html("<span style='color:blue'>Take mass today</span>");else $toDoStatus.html("<em>No mass today</em>")
},createMassDivs:function(){var massDays=[9,10,11,12,13,14,15,16,17,18,19,20];for(i=0;i<massDays.length;i++){var massDay=massDays[i],$div=$(".addedMassDivs"),outerDivClasses="massDiv added",row1DivClasses="row align-items-end mt-2 blackBackground original";$div.append($("<div/>",{
class:outerDivClasses,"data-pnd":massDay}).append($("<div/>",{class:row1DivClasses}).append('<div class="myLeftCol2">PND '+massDay+": </div>").append('<div class="col pndDate" data-pnd="'+massDay+'"></div>')).append($("<div/>",{class:"row original"}).append($("<div/>",{class:"col"
}).append("<strong>Tail</strong>")).append($("<div/>",{class:"col"}).append("<strong>Ear Tag</strong>")).append($("<div/>",{class:"col"}).append("<strong>Sex</strong>")).append($("<div/>",{class:"col"}).append("<strong>Mass</strong>"))))}},createRow_startPara:function($avgMass){
var $div=$("#offspringMassStart"),rowCount=$div.find(".totalMass").last().data("mouse");if(rowCount)rowCount+=1;else rowCount=1;$div.append($("<div/>",{class:"row mt-1","data-mouse":rowCount}).append($("<div/>",{class:"col text-center"}).append($("<input/>",{id:"total_mass_"+rowCount,
name:"total_mass_"+rowCount,type:"number",class:"totalMass fullWidth",step:.1,"data-mouse":rowCount}).on("input",function(){$(".totalMass").each(function(){my_widget_script.getIndividualMass($(this))});var avgMass=my_widget_script.getAvgMass();$avgMass.text(avgMass)}))).append($("<div/>",{
class:"col justify-content-center individualMass text-center","data-mouse":rowCount}))),my_widget_script.resize()},updateOffspringID:function(mouseNum,earTag){var damID=$("#damID").val(),offID=damID+"_"+earTag,dataSearch=my_widget_script.dataSearch("mouse",mouseNum)
;$(".idCalc"+dataSearch).text(offID),$(".earTagCalc"+dataSearch).text(earTag)},updateOffspringSex:function(mouseNum,sex){var dataSearch=my_widget_script.dataSearch("mouse",mouseNum);$(".sexCalc"+dataSearch).text(sex)},updateTailMark:function(mouseNum,action){
var dataSearch=my_widget_script.dataSearch("mouse",mouseNum),$tailMark=$(".tailMark"+dataSearch),redMark="<span style='color:red'>|</span>",blackMark="<span style='color:black'>|</span>"
;if("red"==action)$tailMark.append(redMark);else if("black"==action)$tailMark.append(blackMark);else if("clear"==action)$tailMark.text("");return $tailMark.html()},updateOffspringMass:function(pnd,mouse){
var pndSearch=my_widget_script.dataSearch("pnd",pnd),mouseSearch=my_widget_script.dataSearch("mouse",mouse),massPrint="NA";if(-1!==$.inArray(pnd,my_widget_script.possibleMassDays)){var mass=$(".offMass"+mouseSearch+pndSearch).val();if(mass)mass=parseFloat(mass),massPrint=mass.toFixed(1)}
$(".massCalc"+mouseSearch+pndSearch).text(massPrint)},updateMassOutput:function(){
for(var numPupsEnd=my_widget_script.countPups($(".offspringDemoEnd")),i=0;i<numPupsEnd;i++)for(var mouseNum=i+1,massDays=[9,10,11,12,13,14,15,16,17,18,19,20,21],j=0;j<massDays.length;j++)my_widget_script.updateOffspringMass(massDays[j],mouseNum)},updateDamMass:function(pnd){
var pndSearch=my_widget_script.dataSearch("pnd",pnd),$damMass=$(".damMass"+pndSearch),massPrint="NA";if($damMass){var mass=$damMass.val();if(mass)massPrint=parseFloat(mass).toFixed(1)}$(".damMassCalc"+pndSearch).text(massPrint)},createRow_offDemo:function(){
var $div=$(".offspringDemoEnd"),lastMouseNum=$div.find(".row").last().data("mouse"),mouseNum;if(lastMouseNum)mouseNum=lastMouseNum+1;else mouseNum=1
;var rowClass="added demoEnd row mt-1 align-items-center",redButtonID="redbutton_"+mouseNum,blackButtonID="blackbutton_"+mouseNum,clearButtonID="clearbutton_"+mouseNum,idID="id_"+mouseNum;idClass="offID";var sexID="sex_"+mouseNum;sexClass="sex",$div.append($("<div/>",{class:rowClass,
"data-mouse":mouseNum}).append($('<div class="col"/>').append($("<input/>",{id:redButtonID,name:redButtonID,type:"button",class:"redButton",value:"Red |","data-mouse":mouseNum}).on("click",function(){var mouseNum=$(this).data("mouse");my_widget_script.updateTailMark(mouseNum,"red")
})).append($("<input/>",{id:blackButtonID,name:blackButtonID,type:"button",class:"blackButton",value:"Black |","data-mouse":mouseNum}).on("click",function(){var mouseNum=$(this).data("mouse");my_widget_script.updateTailMark(mouseNum,"black")})).append($("<input/>",{id:clearButtonID,
name:clearButtonID,type:"button",class:"clearButton",value:"Clear","data-mouse":mouseNum}).on("click",function(){var mouseNum=$(this).data("mouse");my_widget_script.updateTailMark(mouseNum,"clear")})).append($("<span></span>",{class:"tailMark","data-mouse":mouseNum
}))).append($('<div class="col"/>').append($("<select></select>",{id:idID,name:idID,class:idClass,"data-mouse":mouseNum
}).append("<option value=''>[Select]</option>","<option value='04'>04</option>","<option value='06'>06</option>","<option value='40'>40</option>","<option value='60'>60</option>","<option value='44'>44</option>","<option value='66'>66</option>","<option value='46'>46</option>","<option value='64'>64</option>").on("input",function(){
var mouseNum=$(this).data("mouse"),earTag=$(this).val();my_widget_script.updateOffspringID(mouseNum,earTag)}))).append($('<div class="col"/>').append($("<select></select>",{id:sexID,name:sexID,class:sexClass,"data-mouse":mouseNum
}).append("<option value=''>[Select]</option>","<option value='F'>Female</option>","<option value='M'>Male</option>").on("input",function(){var mouseNum=$(this).data("mouse"),sex=$(this).val();my_widget_script.updateOffspringSex(mouseNum,sex)})))),my_widget_script.resize()},
createRow_massDiv:function(whichDay){var $outerDiv=$(".addedMassDivs"),dataSearchDay=my_widget_script.dataSearch("pnd",whichDay),$div=$(".massDiv"+dataSearchDay),$demoDiv=$(".offspringDemoEnd"),lastMouseNum=$div.find(".row").last().data("mouse"),mouseNum
;if(lastMouseNum)mouseNum=lastMouseNum+1;else mouseNum=1;var rowClass="row added mt-1 align-items-center",idClass="idCalc",sexClass="sexCalc",tailClass="tailMark",massID="mass_"+whichDay+"_"+mouseNum,massClass="offMass",dropMassCol=false
;if(3===$div.find(".original").find(".col").length)dropMassCol=true;var dataSearchMouse=my_widget_script.dataSearch("mouse",mouseNum);if($div.append($("<div/>",{class:rowClass,"data-pnd":whichDay,"data-mouse":mouseNum}).append($("<div/>",{class:"col "+tailClass,"data-pnd":whichDay,
"data-mouse":mouseNum}).append($(".tailMark"+dataSearchMouse).html())).append($("<div/>",{class:"col "+idClass,"data-pnd":whichDay,"data-mouse":mouseNum}).append($(".offID"+dataSearchMouse).val())).append($("<div/>",{class:"col "+sexClass,"data-pnd":whichDay,"data-mouse":mouseNum
}).append($(".sex"+dataSearchMouse).val())).append($("<div/>",{class:"col massCol","data-pnd":whichDay,"data-mouse":mouseNum}).append($("<input/>",{id:massID,name:massID,type:"number","data-pnd":whichDay,"data-mouse":mouseNum,class:massClass+" fullWidth"}).on("input",function(){
var pnd=$(this).data("pnd"),mouse=$(this).data("mouse");my_widget_script.updateOffspringMass(pnd,mouse)})))),dropMassCol)$div.find(".massCol").remove();my_widget_script.resize()},createRow_summaryMassTable:function(){
var $table=$("#offspringMassOutTable"),$demoTable=$("#offspringDemoOutTable"),lastMouseNum=$table.find(".myRow").last().data("mouse"),mouseNum;if(lastMouseNum)mouseNum=lastMouseNum+1;else mouseNum=1;$table.find("tbody").append($("<tr></tr>",{class:"myRow added","data-mouse":mouseNum
}).append($("<td></td>",{class:"idCalc","data-mouse":mouseNum})).append($("<td></td>",{class:"paraTypeCalc"}).append(my_widget_script.treatStart))),$demoTable.find("tbody").append($("<tr></tr>",{class:"myRow added","data-mouse":mouseNum}).append($("<td></td>",{class:"idCalc","data-mouse":mouseNum
})).append($("<td></td>",{class:"earTagCalc","data-mouse":mouseNum})).append($("<td></td>",{class:"sexCalc","data-mouse":mouseNum})).append($("<td></td>",{class:"damID_calc","data-mouse":mouseNum})));var massDays=[9,10,11,12,13,14,15,16,17,18,19,20,21];for(i=0;i<massDays.length;i++){
var pnd=massDays[i];$table.find("tbody tr").last().append($("<td/>",{class:"massCalc","data-mouse":mouseNum,"data-pnd":pnd}))}my_widget_script.updateMassOutput(),my_widget_script.resize()},createRows_allMassDivs:function(){var massDays=[0,9,10,11,12,13,14,15,16,17,18,19,20,21]
;if(massDays)for(var i=0;i<massDays.length;i++){var whichDay=massDays[i];my_widget_script.createRow_massDiv(whichDay)}my_widget_script.createRow_summaryMassTable()},deleteRow:function($div){$div.find(".row:not(.original)").last().remove(),my_widget_script.resize()},deleteRows_allmassDivs:function(){
var massDays=[0,9,10,11,12,13,14,15,16,17,18,19,20,21];if(massDays)for(var i=0;i<massDays.length;i++){var whichDay=massDays[i],pndSearch=my_widget_script.dataSearch("pnd",whichDay),$div=$(".massDiv"+pndSearch);my_widget_script.deleteRow($div)}
$("#offspringMassOutTable").find(".myRow").last().remove()},getIndividualMass:function($totalMass){
var thisMouse=$totalMass.data("mouse"),prevMouse=thisMouse-1,dataSearchPrev=my_widget_script.dataSearch("mouse",prevMouse),dataSearchThis=my_widget_script.dataSearch("mouse",thisMouse),prevTotal=parseFloat($(".totalMass"+dataSearchPrev).val()),currentTotal=parseFloat($totalMass.val())
;if(!prevTotal)$(".individualMass"+dataSearchThis).text(currentTotal.toFixed(1));else{var massDiff=currentTotal-prevTotal;$(".individualMass"+dataSearchThis).text(massDiff.toFixed(1))}},getAvgMass:function(){
var totalMass,numberPups=my_widget_script.countPups($("#offspringMassStart")),$lastTotalMass=$("#offspringMassStart").find(".totalMass").last();if($lastTotalMass.val())totalMass=parseFloat($lastTotalMass.val());else totalmass="NaN";var avgMass=totalMass/numberPups
;if(avgMass)return avgMass.toFixed(2);else return"NA"},countPups:function($div){var numberPups;if(numberPups=$div.find(".row").last().data("mouse"),!numberPups)numberPups=0;return numberPups},offspringCalculations:function($div,$numPups,$avgMass){var numberPups=my_widget_script.countPups($div)
;$numPups.text(numberPups);var avgMass=my_widget_script.getAvgMass();$avgMass.text(avgMass)},watchValue:function($elToWatch,$elToUpdate){var value=$elToWatch.val();$elToUpdate.text(value),my_widget_script.resize()},updateCalculation:function($elToWatch,$elToUpdate){var value=$elToWatch.val()
;$elToUpdate.text(value)},addPupStartFuncs:function($table,$numPups,$avgMass){my_widget_script.createRow_startPara($avgMass),my_widget_script.offspringCalculations($table,$numPups,$avgMass),my_widget_script.resize()},removePupStartFuncs:function($div,$numPups,$avgMass,elForHeight=null){
this.runIfConfirmed("Are you sure that you want to remove the last pup?",()=>{this.deleteRow($div),this.offspringCalculations($div,$numPups,$avgMass),this.resize()},elForHeight)},addPupEndFuncs:function($tableDemo,$numPups){my_widget_script.createRow_offDemo(),
my_widget_script.createRows_allMassDivs();var numberPups=my_widget_script.countPups($tableDemo);$numPups.text(numberPups),my_widget_script.resize()},removePupEndFuncs:function($div,$numPups,elForHeight=null){this.runIfConfirmed("Are you sure that you want to remove the last pup?",()=>{
this.deleteRow($div),this.deleteRows_allmassDivs();var numberPups=this.countPups($div);$numPups.text(numberPups),this.resize()},elForHeight)},runCSV_buttonFunc:function(whichGeneration){var fileName,outTable;if("dam"===whichGeneration)fileName="damData",
outTable="damOutTable";else if("offspring"===whichGeneration)fileName="massOffspring",outTable="offspringMassOutTable";else if("demo"===whichGeneration)fileName="offspringDemo",outTable="offspringDemoOutTable";var data_valid=my_widget_script.data_valid_form()
;if(data_valid)my_widget_script.exportTableToCSV(fileName,outTable),$("#errorMsg").html("<span style='color:grey; font-size:24px;'>Saved successfully</span>");else $("#errorMsg").append("<br/><span style='color:grey; font-size:24px;'>Did not export</span><br/>")},downloadCSV:function(csv,filename){
var csvFile,downloadLink;csvFile=new Blob([csv],{type:"text/csv"}),downloadLink=document.createElement("a"),downloadLink.download=filename,downloadLink.href=window.URL.createObjectURL(csvFile),downloadLink.style.display="none",document.body.appendChild(downloadLink),downloadLink.click()},
exportTableToCSV:function(filename,table){for(var csv=[],datatable=document.getElementById(table),rows=datatable.querySelectorAll("tr"),i=0;i<rows.length;i++){for(var row=[],cols=rows[i].querySelectorAll("td, th"),j=0;j<cols.length;j++){var cellText='"'+cols[j].innerText+'"';row.push(cellText)}
csv.push(row.join(","))}this.downloadCSV(csv.join("\n"),filename)},copyData_buttonFunc:function(whichGeneration,$copyHead){var copyHead,$outDiv,$outTable;if($copyHead.is(":checked"))copyHead=true;else copyHead=false;if("dam"===whichGeneration)$outDiv=$("#damOutDiv"),
$outTable=$("#damOutTable");else if("offspring"===whichGeneration)$outDiv=$("#offspringMassOutDiv"),$outTable=$("#offspringMassOutTable");else if("demo"===whichGeneration)$outDiv=$("#offspringDemoOutDiv"),$outTable=$("#offspringDemoOutTable");var data_valid=my_widget_script.data_valid_form()
;if(data_valid)$outDiv.show(),my_widget_script.resize(),my_widget_script.copyTable($outTable,copyHead),
$("#errorMsg").html("<span style='color:grey; font-size:24px;'>Copied successfully</span>");else $("#errorMsg").append("<br/><span style='color:grey; font-size:24px;'>Nothing was copied</span><br/>")},copyTable:function($table,copyHead){
var $temp=$("<text"+"area style='opacity:0;'></text"+"area>"),addLine="";if(copyHead)$table.find("thead").children("tr").each(function(){var addTab="";$(this).children().each(function(){$temp.text($temp.text()+addTab+$(this).text()),addTab="\t"})}),addLine="\n"
;$table.find("tbody").children("tr").each(function(){$temp.text($temp.text()+addLine);var addTab="";$(this).find("td").each(function(){if($(this).text())var addText=$(this).text();else var addText="NA";$temp.text($temp.text()+addTab+addText),addTab="\t",addLine="\n"})}),
$temp.appendTo($("#forCopy")).focus().select(),document.execCommand("copy"),$temp.remove()},getOffsetTop:function(element){var offsetTop=0,lastElement=0;while(element&&!lastElement){var formChild=$(element).children("#the_form");if(formChild.length>0)lastElement=1;offsetTop+=element.offsetTop,
element=element.offsetParent}return offsetTop},runIfConfirmed:function(text,functionToCall,elForHeight=null){var thisMessage="Are you sure?";if(text)thisMessage=text;var top="auto";if(elForHeight)top=this.getOffsetTop(elForHeight)+"px";bootbox.confirm ({message:thisMessage,callback:proceed=>{
if(proceed)functionToCall()}}),$(".modal-dialog").css("top",top)},dialogConfirmx:function(text,functionToCall,elForHeight=null){var thisMessage="Do you want to proceed?";if(text)thisMessage=text;var top="auto";if(elForHeight)top=this.getOffsetTop(elForHeight)+"px";bootbox.confirm ({
message:thisMessage,callback:result=>{functionToCall(result)}}),$(".modal-dialog").css("top",top)},runBasedOnInput:function(prompt,functionToCall,elForHeight=null,defValue=null){var thisTitle="Enter value:";if(prompt)thisTitle=prompt;var top="auto"
;if(elForHeight)top=this.getOffsetTop(elForHeight)+"px";bootbox.prompt({title:thisTitle,callback:result=>{functionToCall(result)},value:defValue}),$(".modal-dialog").css("top",top)}};