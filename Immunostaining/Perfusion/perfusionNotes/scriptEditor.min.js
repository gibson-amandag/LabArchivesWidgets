my_widget_script={init:function(mode,json_data){this.include("https://code.jquery.com/jquery-3.5.1.min.js","sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=","anonymous",()=>{$(document).ready(()=>{
this.include("https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js","sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl","anonymous",()=>{$(document).ready(()=>{
this.include("https://cdn.jsdelivr.net/npm/luxon@1.26.0/build/global/luxon.min.js","sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0=","anonymous",()=>{$(document).ready(()=>{
this.include("https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.min.js","sha512-RdSPYh1WA6BF0RhpisYJVYkOyTzK4HwofJ3Q7ivt/jkpW6Vc8AurL1R+4AUcvn9IwEKAPm/fk7qFZW3OuiUDeg==","anonymous",()=>{$(document).ready(()=>{$jq351=jQuery.noConflict(true),this.myInit(mode,json_data)})})})})})})})})},
include:function(src,integrity,crossorigin,onload){var head=document.getElementsByTagName("head")[0],script=document.createElement("script");script.setAttribute("integrity",integrity),script.setAttribute("crossorigin",crossorigin),script.src=src,script.type="text/javascript",
script.onload=script.onreadystatechange=function(){if(script.readyState){if("complete"===script.readyState||"loaded"===script.readyState)script.onreadystatechange=null,onload()}else onload()},head.appendChild(script)},myInit:function(mode,json_data){var parsedJson=this.parseInitJson(json_data)
;this.initDynamicContent(parsedJson),window.onresize=this.resize,this.addEventListeners(),this.parent_class.init(mode,()=>JSON.stringify(parsedJson.widgetData)),this.addRequiredFieldIndicators(),this.setUpInitialState(),this.adjustForMode(mode)},to_json:function(){
var widgetJsonString=this.parent_class.to_json(),dynamicContent=this.getDynamicContent(),output={widgetData:JSON.parse(widgetJsonString),mouseNums:my_widget_script.mouseNums,mice:my_widget_script.mice};return JSON.stringify(output)},from_json:function(json_data){var parsedJson=JSON.parse(json_data)
;this.parent_class.from_json(JSON.stringify(parsedJson.widgetData))},test_data:function(){var testData=JSON.parse(this.parent_class.test_data()),output={widgetData:testData,mouseNums:[1,2,3,4,5,6,7],mice:{1:{id:"CRH-01",cycleNum:"1"},2:{id:"CRH-02",cycleNum:"2"},3:{id:"CRH-03",cycleNum:"3"},4:{
id:"CRH-04",cycleNum:"4"},5:{id:"CRH-05",cycleNum:"5"},6:{id:"CRH-06",cycleNum:"6"},7:{id:"CRH-07",cycleNum:"7"}}};return JSON.stringify(output)},is_valid:function(b_suppress_message){var fail=false,fail_log="",name;if($("#the_form").find("select, textarea, input").each(function(){
if(!$(this).prop("required"));else if(!$(this).val())fail=true,name=$(this).attr("id"),fail_log+=name+" is required \n"}),$("input[type='date']").each(function(){var date=$(this).val();if(date){var validDate=my_widget_script.isValidDate(date);if(!validDate)fail=true,
fail_log+="Please enter valid date in form 'YYYY-MM-DD'"}}),$("input[type='time']").each(function(){var time=$(this).val();if(time){var validtime=my_widget_script.isValidTime(time);if(!validtime)fail=true,fail_log+="Please enter valid time in form 'hh:mm' - 24 hr time"}}),
fail)return bootbox.alert (fail_log);else{var noErrors=[];return noErrors}},is_edited:function(){return this.parent_class.is_edited()},reset_edited:function(){return this.parent_class.reset_edited()},parseInitJson:function(json_data){var jsonString
;if("string"===typeof json_data)jsonString=json_data;else jsonString=json_data();var parsedJson=JSON.parse(jsonString);return parsedJson},initDynamicContent:function(parsedJson){if(parsedJson.mice)my_widget_script.mice=parsedJson.mice;else my_widget_script.mice={}
;if(parsedJson.mouseNums)for(var i=0;i<parsedJson.mouseNums.length;i++)mouse=parsedJson.mouseNums[i],my_widget_script.mouseNums.push(mouse),my_widget_script.makeMouseCard(mouse);else my_widget_script.mouseNums=[]},adjustForMode:function(mode){
if("edit"!==mode&&"edit_dev"!==mode)$(".disableOnView").prop("disabled",true),$(".hideView").hide(),$("input[type='date']").removeClass(".hasDatePicker");else $("input[type='date']").each(function(){my_widget_script.checkDateFormat($(this))}),$("input[type='time']").each(function(){
my_widget_script.checkTimeFormat($(this))})},addEventListeners:function(){},addRequiredFieldIndicators:function(){$(".needForTableLab").each(function(){$(this).html("<span style='color:blue'>#</span>"+$(this).html())}),$(".requiredLab").each(function(){
$(this).html("<span style='color:red'>*</span>"+$(this).html())})},isValidTime:function(timeString){var regEx="^(((([0-1][0-9])|(2[0-3])):[0-5][0-9]))$";if(!timeString.match(regEx))return false;else return true},isTimeSupported:function(){var input=document.createElement("input")
;input.setAttribute("type","time");var supported=true;if("time"!==input.type)supported=false;return my_widget_script.timeSupported=supported,supported},timeSupported:true,checkTimeFormat:function($timeInput){if(!my_widget_script.timeSupported){$timeInput.next(".timeWarning").remove()
;var time=$timeInput.val(),isValid=my_widget_script.isValidTime(time);if(!isValid)$timeInput.after('<div class="text-danger timeWarning">Enter time as "hh:mm" in 24-hr format</div>')}},isValidDate:function(dateString){var regEx=/^\d{4}-\d{2}-\d{2}$/;if(!dateString.match(regEx))return false
;var d=new Date(dateString),dNum=d.getTime();if(!dNum&&0!==dNum)return false;return d.toISOString().slice(0,10)===dateString},isDateSupported:function(){var input=document.createElement("input");input.setAttribute("type","date");var supported=true;if("date"!==input.type)supported=false
;return my_widget_script.dateSupported=supported,supported},dateSupported:true,checkDateFormat:function($dateInput){if(!my_widget_script.dateSupported){$dateInput.next(".dateWarning").remove();var date=$dateInput.val(),isValid=my_widget_script.isValidDate(date)
;if(!isValid)$dateInput.after('<div class="text-danger dateWarning">Enter date as "YYYY-MM-DD"</div>');$dateInput.datepicker({dateFormat:"yy-mm-dd"}),console.log($dateInput.val())}},setUpInitialState:function(){my_widget_script.isDateSupported(),my_widget_script.isTimeSupported(),
$("input[type='date']").prop("placeholder","YYYY-MM-DD").on("change",function(){my_widget_script.checkDateFormat($(this))}).each(function(){my_widget_script.checkDateFormat($(this))}),$("input[type='time']").prop("placeholder","hh:mm").on("change",function(){my_widget_script.checkTimeFormat($(this))
}).each(function(){my_widget_script.checkTimeFormat($(this))}),$(".myLeftCol").addClass("col-12 col-sm-6 col-md-4 col-lg-3 text-left text-sm-right"),$("textarea.autoAdjust").each(function(){this.setAttribute("style","height:"+this.scrollHeight+"px;overflow-y:hidden;")}).on("input",function(){
this.style.height="auto",this.style.height=this.scrollHeight+"px",my_widget_script.resize()}),$(".watchTime").each(function(){my_widget_script.watchTimeNextEl($(this))}).on("input",function(){my_widget_script.watchTimeNextEl($(this))}),$("#addMouse").on("click",function(){
if(my_widget_script.mouseNums.length>0)var lastMouse=my_widget_script.mouseNums[my_widget_script.mouseNums.length-1],mouseNum=lastMouse+1;else var mouseNum=1;var inArray=my_widget_script.checkInArray(mouseNum,my_widget_script.mouseNums);if(!inArray)my_widget_script.mouseNums.push(mouseNum),
my_widget_script.mice[mouseNum]={},my_widget_script.makeMouseCard(mouseNum)}),$(".watch").each(function(){my_widget_script.watchValue($(this))}),$("input.extractedTime").each(function(){my_widget_script.watchTimeNextEl($(this))}),$(".mouseHeader").each(function(){my_widget_script.toggleCard($(this))
}),my_widget_script.resize()},mouseNums:[],mice:{},watchTimeNextEl:function($elToWatch){var $elToFill=$elToWatch.next($(".fillTime"));my_widget_script.watchTime($elToWatch,$elToFill)},resize:function(){my_widget_script.parent_class.resize_container()},getDynamicContent:function(){
var dynamicContent={};return dynamicContent},data_valid_form:function(){var valid=true;if($(".needForTable").each(function(){if(!$(this).val())valid=false}),
!valid)$("#errorMsg").html("<span style='color:red; font-size:36px;'>Please fill out all elements marked by a</span><span style='color:blue; font-size:36px;'> blue #</span>");else $("#errorMsg").html("");return valid},getHoursMin:function(timeString){timeString=timeString.split(":")
;var hours=parseInt(timeString[0],10),mins=parseInt(timeString[1],10);return split={hours:hours,mins:mins}},watchTime:function($elToWatch,$elToFill){var addTime=$elToFill.data("time"),startTime=$elToWatch.val();if(startTime){var time=new Date;startTimeSplit=my_widget_script.getHoursMin(startTime),
addTimeSplit=my_widget_script.getHoursMin(addTime),time.setHours(startTimeSplit.hours,startTimeSplit.mins,0,0),time.setHours(time.getHours()+addTimeSplit.hours),time.setMinutes(time.getMinutes()+addTimeSplit.mins),$elToFill.text(time.toLocaleTimeString())}else $elToFill.text("{Enter Start Time}")
;my_widget_script.resize()},toggleCard:function($cardHead){$cardHead.next().toggleClass("collapse"),$cardHead.next().find("textarea.autoAdjust").each(function(){if(!$(this).is(":hidden"))this.setAttribute("style","height:"+this.scrollHeight+"px;overflow-y:hidden;")}),my_widget_script.resize()},
makeCard:function($div,cardHeadContent,cardBodyContent){$div.append($("<div/>",{class:"card"}).append($("<button></button>",{type:"button",class:"card-header"}).on("click",function(){my_widget_script.toggleCard($(this))}).append(cardHeadContent)).append($("<div/>",{class:"card-body collapse"
}).append(cardBodyContent))),my_widget_script.resize()},dataSearch:function(dataName,dataValue){var dataSearch="[data-"+dataName+"='"+dataValue+"']";return dataSearch},calcSearch:function(calc){var calcSearch=my_widget_script.dataSearch("calc",calc);return calcSearch},mouseSearch:function(mouse){
var mouseSearch=my_widget_script.dataSearch("mouse",mouse);return mouseSearch},tableSearch:function(table){var tableSearch=my_widget_script.dataSearch("table",table);return tableSearch},watchValue:function($el){
var watch=$el.data("watch"),calcSearch=my_widget_script.calcSearch(watch),dayNum=$el.data("day"),mouseNum=$el.data("mouse"),val=$el.val();if(dayNum)calcSearch+=my_widget_script.daySearch(dayNum);if(mouseNum)calcSearch+=my_widget_script.mouseSearch(mouseNum)
;if("mouse"==watch)if(!val)val="Mouse "+mouseNum;$(calcSearch).html(val),my_widget_script.resize()},checkInArray:function(searchVal,array){var inArray=-1!==$.inArray(searchVal,array);return inArray},checkDateKeyPress:function($el){if($el.off("change blur"),$el.on("blur",function(){
my_widget_script.checkDateFormat($el),$el.off("blur"),$el.on("change",function(){my_widget_script.checkDateFormat($el)})}),13===event.keyCode)my_widget_script.checkDateFormat($el)},checkTimeKeyPress:function($el){if($el.off("change blur"),$el.on("blur",function(){
my_widget_script.checkTimeFormat($el),$el.off("blur"),$el.on("change",function(){my_widget_script.checkTimeFormat($el)})}),13===event.keyCode)my_widget_script.checkTimeFormat($el)},makeMouseCard:function(mouseNum){var $div=$(".mouseInfo");if(!$div.find(".card").length)$div.html("")
;var row="row mt-2",col="col-12 col-lg-6",sacDateRow=this.makeDateRow(row,col,"Date of Sacrifice:","sac",mouseNum),sectionDateRow=this.makeDateRow(row,col,"Date of Sectioning:","section",mouseNum),immunoDateRow=this.makeDateRow(row,col,"Date Immuno Finished:","immuno",mouseNum),imageDateRow=this.makeDateRow(row,col,"Date Imaging Finished:","image",mouseNum),quantDateRow=this.makeDateRow(row,col,"Date Quantified:","quant",mouseNum),transportTimeRow=this.makeTimeRow(row,col,"Time of transport:","transport",mouseNum),sacTimeRow=this.makeTimeRow(row,col,"Time of sacrifice:","sac",mouseNum),perfusionTimeRow=this.makeTimeRow(row,col,"Time of perfusion:","perfusion",mouseNum),extractedTimeRow=this.makeTimeRow(row,col,"Time of brain extraction:","extracted",mouseNum),changedSucroseTimeRow=this.makeTimeRow(row,col,"Time vial changed to sucrose:","changedSucrose",mouseNum)
;extractedTimeRow.find("div.col").append("Change to sucrose at <span class='fillTime purple' data-time='01:30'>{Enter Time}</span>"),extractedTimeRow.find(".extractedTime").on("input",function(){my_widget_script.watchTimeNextEl($(this))}).each(function(){my_widget_script.watchTimeNextEl($(this))}),
$div.append($("<div/>",{class:"col col-md-6 mt-2 mouseCard","data-mouse":mouseNum}).append($("<div/>",{class:"card"}).append($("<button></button>",{class:"card-header mouseHeader",type:"button","data-calc":"mouse","data-mouse":mouseNum}).on("click",function(){my_widget_script.toggleCard($(this))
}).append("Mouse "+mouseNum)).append($("<div/>",{class:"card-body"}).append($("<div/>",{class:row}).append($("<div/>",{class:col}).append("<h4>Mouse ID:</h4>")).append($("<div/>",{class:"col"}).append($("<input/>",{type:"text","data-mouse":mouseNum,id:"mouseID"+mouseNum,name:"mouseid"+mouseNum,
class:"mouseID fullWidth watch","data-watch":"mouse"}).on("change",function(){my_widget_script.mice[mouseNum]["id"]=$(this).val()})))).append($("<div/>",{class:row}).append($("<div/>",{class:col}).append("<h5>Cycle ID #:</h5>")).append($("<div/>",{class:"col"}).append($("<input/>",{type:"number",
"data-mouse":mouseNum,id:"cycleNum"+mouseNum,name:"cyclenum"+mouseNum,class:"cycleNum fullWidth watch","data-watch":"cycleNum"}).on("change",function(){my_widget_script.mice[mouseNum]["cycleNum"]=$(this).val()})))).append($("<div/>",{class:row+" hideView"}).append($("<div/>",{class:col
}).append("Delete:")).append($("<div/>",{class:"col"}).append($("<input/>",{type:"button",value:"Delete Mouse","data-mouse":mouseNum,id:"deleteMouse"+mouseNum,name:"deletemouse"+mouseNum,class:"deleteMouse fullWidth"}).on("click",e=>{
this.deleteMouseFuncs($(e.currentTarget).data("mouse"),elForHeight=e.currentTarget)
})))).append(sacDateRow).append(transportTimeRow).append(sacTimeRow).append(perfusionTimeRow).append(extractedTimeRow).append(changedSucroseTimeRow).append(sectionDateRow).append(immunoDateRow).append(imageDateRow).append(quantDateRow).append($("<div/>",{class:row}).append($("<div/>",{class:"col"
}).append($("<text"+"area></text"+"area>",{"data-mouse":mouseNum,id:"notes"+mouseNum,name:"notes"+mouseNum,rows:1,class:"notes fullWidth autoAdjust"}).on("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px",my_widget_script.resize()})))))))
;var $mouseTable=$("#mouseTable"),$mouseTableBody=$mouseTable.find("tbody");$mouseTableBody.append($("<tr/>",{"data-mouse":mouseNum}))
;var $thisRow=$mouseTableBody.find(this.mouseSearch(mouseNum)),cells=["mouse","sacDate","transportTime","sacTime","perfusionTime","extractedTime","changedSucroseTime","sectionDate","immunoDate","imageDate","quantDate"];for(i in cells){
var cell=cells[i],$el=my_widget_script.makeDataCell(cell,mouseNum);$thisRow.append($el)}$(".watch").on("input",function(){my_widget_script.watchValue($(this))}),$("input[type='date']").each(function(){my_widget_script.checkDateFormat($(this))}).on("input",function(){
my_widget_script.checkDateFormat($(this))}),$("input[type='time']").each(function(){my_widget_script.checkTimeFormat($(this))}).on("input",function(){my_widget_script.checkTimeFormat($(this))}),my_widget_script.resize()},makeDateRow:function(row,col,label,className,mouseNum){
var lowerCaseName=className.toLowerCase(),$row=$("<div/>",{class:row}).append($("<div/>",{class:col}).append(label)).append($("<div/>",{class:"col"}).append($("<input/>",{type:"date","data-mouse":mouseNum,id:className+"Date"+mouseNum,name:lowerCaseName+"date"+mouseNum,
class:className+"Date fullWidth watch","data-watch":className+"Date"})));return $row},makeTimeRow:function(row,col,label,className,mouseNum){var lowerCaseName=className.toLowerCase(),$row=$("<div/>",{class:row}).append($("<div/>",{class:col}).append(label)).append($("<div/>",{class:"col"
}).append($("<input/>",{type:"time","data-mouse":mouseNum,id:className+"Time"+mouseNum,name:lowerCaseName+"time"+mouseNum,class:className+"Time fullWidth watch","data-watch":className+"Time"})));return $row},makeDataCell:function(className,mouseNum){var $cell=$("<td/>",{"data-calc":className,
"data-mouse":mouseNum,class:className});return $cell},deleteMouseFuncs:function(mouseNum,elForHeight=null){this.runIfConfirmed("Are you sure that you wish to delete this mouse?",()=>{var index=this.mouseNums.indexOf(mouseNum);if(index>-1)this.mouseNums.splice(index,1);delete this.mice[mouseNum]
;var mouseSearch=this.mouseSearch(mouseNum);$(mouseSearch).remove(),this.resize()},elForHeight=elForHeight)},getOffsetTop:function(element){var offsetTop=0,lastElement=0;while(element&&!lastElement){var formChild=$(element).children("#the_form");if(formChild.length>0)lastElement=1
;offsetTop+=element.offsetTop,element=element.offsetParent}return offsetTop},runIfConfirmed:function(text,functionToCall,elForHeight=null){var thisMessage="Are you sure?";if(text)thisMessage=text;var top="auto";if(elForHeight)top=this.getOffsetTop(elForHeight)+"px";bootbox.confirm ({
message:thisMessage,callback:proceed=>{if(proceed)functionToCall()}}),$(".modal-dialog").css("top",top)},dialogConfirmx:function(text,functionToCall,elForHeight=null){var thisMessage="Do you want to proceed?";if(text)thisMessage=text;var top="auto"
;if(elForHeight)top=this.getOffsetTop(elForHeight)+"px";bootbox.confirm ({message:thisMessage,callback:result=>{functionToCall(result)}}),$(".modal-dialog").css("top",top)},runBasedOnInput:function(prompt,functionToCall,elForHeight=null){var thisTitle="Enter value:";if(prompt)thisTitle=prompt
;var top="auto";if(elForHeight)top=this.getOffsetTop(elForHeight)+"px";bootbox.prompt({title:thisTitle,callback:result=>{functionToCall(result)}}),$(".modal-dialog").css("top",top)}};