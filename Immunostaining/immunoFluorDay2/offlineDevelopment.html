
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<!-- START:stylesheet
-->

    <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/stylesheets/labarchive.css">
    <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/chosen/chosen.min.css">
    <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/datatables.net/dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/datatables.net/jquery.dataTables_themeroller.css">
    <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/jquery.calculator/jquery.calculator.css">
    <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/freezerbox/jquery.freezerbox.css">
    <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/freezerbox/jquery.colorselect.css">
    <link rel="stylesheet" type="text/css" href="https://mynotebook.labarchives.com/javascripts/themes/base/ui.all.css">
    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/jquery-ui-1.9.1.custom.js"></script>
    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/jquery-populate/jquery.populate.js" defer="defer"></script>
    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/numeric/jquery.numeric.js" defer="defer"></script>
    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/jquery.calculator/jquery.plugin.js" defer="defer"></script>
    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/jquery.calculator/jquery.calculator.js" defer="defer"></script>
    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/daepark-postmessage/postmessage.js" ></script>
    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/forms/widget_proxy.js" ></script>
    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/forms/parent_form_script.js" ></script>
    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/forms/database_form_script.js" ></script>
    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/datatables.net/dataTables.min.js" ></script>
    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/datatables.net/ColReorderWithResize/ColReorderWithResize.js" ></script>
    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/chosen/chosen.jquery.min.js" ></script>
    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/autoresize/jquery.autoresize.min.js" ></script>
    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/freezerbox/jquery.freezerbox.js" ></script>
    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/freezerbox/jquery.colorselect.js" ></script>
    <script type="text/javascript" src="https://mynotebook.labarchives.com/javascripts/freezerbox/freezerbox_form_script.js" ></script>
    
<title></title>
</head>
<body>
<script>
    // #region
var form_script = null;
try {
$(document).ready(function () {
      
      
      // Create window var to store the locale for the datepicker
      window.datepicker_locale = '';
//***************************************************************************
//***************************************************************************
//***************************************************************************
//place your javascript code below and when you have it the way you want it
//just paste it into the LA Dev tool
//***************************************************************************
//***************************************************************************
//***************************************************************************
// #endregion
    form_script = 
    my_widget_script =
{
    numWashes1: 0,
    numWashes2: 0,

    init: function (mode, json_data) {
        // jQuery for bootstrap
        this.include(
            "https://code.jquery.com/jquery-3.5.1.min.js",
            "sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=",
            "anonymous",
            ()=>{
                $(document).ready(
                    ()=>{
                        // console.log("After load", $.fn.jquery);
                        
                        // Load bootstrap
                        this.include(
                            "https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js",
                            "sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl",
                            "anonymous",
                            ()=>{
                                $(document).ready(
                                    ()=>{
                                        // Load Luxon
                                        this.include(
                                            "https://cdn.jsdelivr.net/npm/luxon@1.26.0/build/global/luxon.min.js",
                                            "sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0=",
                                            "anonymous",
                                            ()=>{
                                                $(document).ready(
                                                    ()=>{
                                                        // Load bootbox - need the bootstrap JS to be here first, with appropriate jQuery
                                                        this.include(
                                                            "https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.min.js",
                                                            "sha512-RdSPYh1WA6BF0RhpisYJVYkOyTzK4HwofJ3Q7ivt/jkpW6Vc8AurL1R+4AUcvn9IwEKAPm/fk7qFZW3OuiUDeg==",
                                                            "anonymous",
                                                            // referrerpolicy="no-referrer"
                                                            ()=>{
                                                                $(document).ready(
                                                                    ()=>{
                                                                        $jq351 = jQuery.noConflict(true);
                                                                        // console.log("After no conflict", $.fn.jquery);
                                                                        // console.log("bootstrap jquery", $jq351.fn.jquery);
                                                                        this.myInit(mode, json_data);
                                                                    }
                                                                )
                                                            }
                                                        );
                                                    }
                                                )
                                            }
                                        );
                                    }
                                )
                            }
                        )
                    }
                )
            }
        )
    },

    //https://stackoverflow.com/questions/8139794/load-jquery-in-another-js-file
    include: function(src, integrity, crossorigin, onload) {
        var head = document.getElementsByTagName('head')[0];
        var script = document.createElement('script');
        script.setAttribute("integrity", integrity);
        script.setAttribute("crossorigin", crossorigin);
        script.src = src;
        script.type = 'text/javascript';
        script.onload = script.onreadystatechange = function() {
            if (script.readyState) {
                if (script.readyState === 'complete' || script.readyState === 'loaded') {
                    script.onreadystatechange = null;                                                  
                    onload();
                }
            } 
            else {
                onload();          
            }
        };
        head.appendChild(script);
    },

    myInit: function (mode, json_data) {
        //this method is called when the form is being constructed
        // parameters
        // mode = if it equals 'view' than it should not be editable
        //        if it equals 'edit' then it will be used for entry
        //        if it equals 'view_dev' same as view,  does some additional checks that may slow things down in production
        //        if it equals 'edit_dev' same as edit,   does some additional checks that may slow things down in production

        // json_data will contain the data to populate the form with, it will be in the form of the data
        // returned from a call to to_json or empty if this is a new form.
        //By default it calls the parent_class's init.

        //uncomment to inspect and view code while developing
        //debugger;

        //Get the parsed JSON data
        var parsedJson = this.parseInitJson(json_data);

        //Uncomment to print parsedJson to console
        //console.log("init", parsedJson);

        //check parsedJson for info not contained in form inputs and reinitialize
        this.initDynamicContent(parsedJson);

        //resize the content box when the window size changes
        window.onresize = ()=> this.resize(); // need the arrow func, or "this" within resize becomes associated with event

        //Define behavior when buttons are clicked or checkboxes/selctions change
        this.addEventListeners();

        // Initialize the form with the stored widgetData using the parent_class.init() function
        this.parent_class.init(mode, () => JSON.stringify(parsedJson.widgetData));

        // Default to 5
        var numWashes1 = 5
        if(parsedJson.numWashes1){
            numWashes1 = parsedJson.numWashes1;
        }

        $("#numWashes1").val(numWashes1);

        // Default to 5
        var numWashes2 = 5
        if(parsedJson.numWashes2){
            numWashes2 = parsedJson.numWashes2;
        }

        $("#numWashes2").val(numWashes2);

        // Add * and # to mark required field indicators
        this.addRequiredFieldIndicators();

        // Set up the form based on previously entered form input
        this.setUpInitialState();

        //adjust form design and buttons based on mode
        this.adjustForMode(mode);

        // Print to console log if any elements don't have a required name attribute
        this.checkForNames();
    },
    
    to_json: function () {
        //should return a json string containing the data entered into the form by the user
        //whatever is return from the method is persisted in LabArchives.  must not be binary data.
        //called when the user hits the save button, when adding or editing an entry

        //Acquire input data from the form using the parent_class.to_json() function
        var widgetJsonString = this.parent_class.to_json();

        //Get information about any dynamic content that may have been created
        var dynamicContent = this.getDynamicContent();

        // Add widgetData and any additional dynamic content to an output object
        // Will be accessed within the init and from_json methods
        var output = { 
            widgetData: JSON.parse(widgetJsonString),
            abNums: this.abNums,
            numWashes1: this.numWashes1,
            numWashes2: this.numWashes2
        };

        //uncomment to check stringified output
        //console.log("to JSON", JSON.stringify(output));

        // return stringified output
        return JSON.stringify(output);
    },

    from_json: function (json_data) {
        //populates the form with json_data

        // all data in string format within json_data is parsed into an object parsedJson
        var parsedJson = JSON.parse(json_data);

        //use parsedJson to get widgetData and turn into a string
        //parent class uses the widget data to fill in inputs
        this.parent_class.from_json(JSON.stringify(parsedJson.widgetData));
    },

    /**
     * In preview, the form is populated with test data when the
     * parent_class.test_data() function is called. This randomly selects options for 
     * dropdown select menus, radio buttons, and checkboxes.
     */
    test_data: function () {
        //during development this method is called to populate your form while in preview mode

        // ORIGINAL LABARCHIVES RETURN FOR TEST DATA
        //return this.parent_class.test_data();

        // CUSTOM TEST DATA

        //store the outcome of the the test data within the testData variable
        var testData = JSON.parse(this.parent_class.test_data());

        //If no additional dynamic content 
        var output = { widgetData: testData };

        //Add additional content to match the objects in to_json
        //var output = { widgetData: testData, addedRows: 2 }; //When in development, initialize with 2 addedRows

        //return the stringified output for use by the init function
        return JSON.stringify(output);
    },

    /**
     * This function determines whether or not the user is allowed to save the widget to the page
     * 
     * The original LabArchives function checks for fields that have _mandatory appended to the name attribute
     * 
     * The custom function checks for fields with the required attribute. If any of these fields are blank, 
     * an alert is returns that provides a fail log with the ids of the elements that are missing. If there are
     * no blank required fields, an empty array is returned.
     * 
     * source: https://stackoverflow.com/questions/18495310/checking-if-an-input-field-is-required-using-jquery
     */
     is_valid: function (b_suppress_message) {
        //called when the user hits the save button, to allow for form validation.
        //returns an array of dom elements that are not valid - default is those elements marked as mandatory
        // that have no data in them.
        //You can modify this method, to highlight bad form elements etc...
        //LA calls this method with b_suppress_message and relies on your code to communicate issues to the user
        //Returning an empty array [] or NULL equals no error
        //TO DO write code specific to your form

        //ORIGINAL LABARCHIVES IS_VALID FUNCTION
        //return this.parent_class.is_valid(b_suppress_message);

        //CUSTOM FUNCTION TO CHECK REQUIRED ITEMS
        var fail = false; //begin with a fail variable that is false
        var fail_log = ''; //begin with an empty fail log
        var name; //create a name variable

        //search the_form for all elements that are of type select, textarea, or input
        $('#the_form').find('select, textarea, input').each((i, e)=> {
            if (!$(e).prop('required')) { //if this element does not have a required attribute
                //don't change anything (fail remains false)
            } else { //if there is a required attribute
                if (!$(e).val()) { //if there is not a value for this input
                    fail = true; //change fail to true
                    name = $(e).attr('id'); //replace the name variable with the name attribute of this element
                    fail_log += name + " is required \n"; //add to the fail log that this name is required
                }

            }
        });

        $("input[type='date']").each((i, e)=> {
            var date = $(e).val();
            if(date){
                var validDate = this.isValidDate(date);
                if(!validDate){
                    fail = true;
                    fail_log += "Please enter valid date in form 'YYYY-MM-DD'";
                }
            }
        });

        $("input[type='time']").each((i, e)=> {
            var time = $(e).val();
            if(time){
                var validtime = this.isValidTime(time);
                if(!validtime){
                    fail = true;
                    fail_log += "Please enter valid time in form 'hh:mm' - 24 hr time";
                }
            }
        });

        if (fail) { //if fail is true (meaning a required element didn't have a value)
            return bootbox.alert(fail_log); //return the fail log as an alert
        } else {
            var noErrors = [];
            return noErrors;
        } //otherwise, return empty array
    },

    is_edited: function () {
        //should return true if the form has been edited since it was loaded or since reset_edited was called
        return this.parent_class.is_edited();
    },

    reset_edited: function () {
        //typically called have a save
        //TO DO write code specific to your form
        return this.parent_class.reset_edited();
    },

    // ********************** CUSTOM METHODS USED BY INIT METHOD **********************
    parseInitJson: function (json_data) {
        var jsonString;
        //check if string or function because preview test is function and page is string
        if (typeof json_data === "string") {
            jsonString = json_data;
        } else {
            jsonString = json_data();
        }
        //Take input string into js object to be able to use elsewhere
        var parsedJson = JSON.parse(jsonString);
        return (parsedJson);
    },

    /**
     * TO DO: edit this function to reinitialize any dynamic content that is not explicity
     * defined within the HTML code. 
     * 
     * This function requires the parsedJson object.
     */
    initDynamicContent: function (parsedJson) {
        if(parsedJson.abNums){
            // console.log("initDynamic: abNums", parsedJson.abNums);
            for(var i = 0; i < parsedJson.abNums.length; i++){
                var abNum = parsedJson.abNums[i];
                this.addAntibodies(abNum);
            }
        }

        // Default to 5
        var numWashes1 = 5
        if(parsedJson.numWashes1){
            numWashes1 = parsedJson.numWashes1;
        }

        this.updateWashTracking(numWashes1, 1);

        // Default to 5
        var numWashes2 = 5
        if(parsedJson.numWashes2){
            numWashes2 = parsedJson.numWashes2;
        }
        this.updateWashTracking(numWashes2, 2);
    },

    /**
     * TO DO: edit this function to define how the HTML elements should be adjusted
     * based on the current mode.
     * 
     * Here, a subset of buttons are disabled when the widget is not being edited.
     * There may be other elements that should be shown/hidden based on the mode
     */
    adjustForMode: function (mode) {
        if (mode !== "edit" && mode !== "edit_dev") {
            //disable when not editing
            $(".disableOnView").prop("disabled", true);
            $("input[type='date']").removeClass(".hasDatePicker");
            $(".hideView").hide();
        } else {
            $("input[type='date']").each((i, e)=> {
                this.checkDateFormat($(e));
            });
            
            $("input[type='time']").each((i, e)=> {
                this.checkTimeFormat($(e));
            });
        }
    },

    /**
     * TO DO: edit this function to define behavior when the user interacts with the form.
     * This could include when buttons are clicked or when inputs change.
     */
    addEventListeners: function () {
        
    },

    /**
     * TO DO: edit this function to define the symbols that should be added to the HTML
     * page based on whether or not a field is required to save the widget to the page
     * 
     * Here, the function adds a blue # before fields of the class "needForFormLab" and a 
     * red * before fields with the "requiredLab" property
     */
    addRequiredFieldIndicators: function () {
        $('.needForTableLab').each((i, e)=> { //find element with class "needForFormLab"
            //alert($(e).val());
            $(e).html("<span class='hideView' style='color:blue'>#</span>" + $(e).html()); //add # before
        });

        $('.requiredLab').each((i, e)=> { //find element with class "requiredLab"
            //alert($(e).val());
            $(e).html("<span class='hideView' style='color:red'>*</span>" + $(e).html()); //add # before
        });
    },

    isValidTime: function (timeString) {
        var regEx = "^(((([0-1][0-9])|(2[0-3])):[0-5][0-9]))$";
        if(!timeString.match(regEx)){
            return false;
        } else {
            return true;
        }
    },

    isTimeSupported: function () {
        // Check if browser has support for input type=time
        var input = document.createElement('input');
        input.setAttribute('type', 'time');
        var supported = true;
        if(input.type !== "time"){
            supported = false;
        }
        this.timeSupported = supported;
        input.remove();
        return (supported);
    },

    timeSupported: true,

    checkTimeFormat: function ($timeInput) {
        if(!this.timeSupported){ // if not supported
            $timeInput.next(".timeWarning").remove();
            var time = $timeInput.val();
            var isValid = this.isValidTime(time);
            if(!isValid){
                $timeInput.after('<div class="text-danger timeWarning">Enter time as "hh:mm" in 24-hr format</div>');
            }
            this.resize();
        }
    },

    isValidDate: function (dateString) {
        // https://stackoverflow.com/questions/18758772/how-do-i-validate-a-date-in-this-format-yyyy-mm-dd-using-jquery/18759013
        var regEx = /^\d{4}-\d{2}-\d{2}$/;
        if(!dateString.match(regEx)) return false;  // Invalid format
        var d = new Date(dateString);
        var dNum = d.getTime();
        if(!dNum && dNum !== 0) return false; // NaN value, Invalid date
        return d.toISOString().slice(0,10) === dateString;
    },

    isDateSupported: function () {
        // https://gomakethings.com/how-to-check-if-a-browser-supports-native-input-date-pickers/
        // Check if browser has support for input type=date
        var input = document.createElement('input');
        // var value = 'a';
        input.setAttribute('type', 'date');
        var supported = true;
        if(input.type !== "date"){
            supported = false;
        }
        this.dateSupported = supported;
        input.remove();
        return (supported);
    },

    dateSupported: true,

    checkDateFormat: function ($dateInput) {
        if(!this.dateSupported){ // if not supported
            $dateInput.next(".dateWarning").remove();
            var date = $dateInput.val();
            var isValid = this.isValidDate(date);
            if(!isValid){
                $dateInput.after('<div class="text-danger dateWarning">Enter date as "YYYY-MM-DD"</div>');
            }
            $dateInput.datepicker({dateFormat: "yy-mm-dd"})
            this.resize();
        }
    },

    /**
     * TO DO: edit this function to define how the form should be initilized based 
     * on the existing form values. This is particularly important for when the 
     * widget already has data entered, such as when saved to a page.
     */
    setUpInitialState: function () {
        this.isDateSupported();
        this.isTimeSupported();
        
        $("input[type='date']").prop("placeholder", "YYYY-MM-DD").on("change", (e)=> {
            this.checkDateFormat($(e.currentTarget));
        });
        
        $("input[type='time']").prop("placeholder", "hh:mm").on("change", (e)=> {
            this.checkTimeFormat($(e.target));
        });
        
        //Add classes to add bootstrap styles for left column in form
        $('.myLeftCol4').addClass("col-6 col-md-4 col-lg-3 text-right");
        // $('.myLeftCol5').addClass("col-6 col-md-4 col-lg-3 text-right");
        $('.myLeftCol').addClass("col-4 col-sm-5 col-md-4 col-lg-5 text-right");
        $('.myLeftCol2').addClass("col-6 col-sm-5 col-md-4 col-lg-5 text-right");
        $('.myLeftCol3').addClass("col-2 col-lg-1 text-right");

        $('textarea.autoAdjust').each((i,e)=> { // i is the index for each match, textArea is the object
            e.setAttribute('style', 'height:' + (e.scrollHeight) + 'px;overflow-y:hidden;');
        }).on('input', (e)=> {
            e.target.style.height = 'auto';
            e.target.style.height = (e.target.scrollHeight) + 'px';
            this.resize();
        });

        $(".watchTime").on("input", (e)=> {
            var $elToWatch = $(e.currentTarget);
            var $elToFill = $(e.currentTarget).parent().next().find($(".fillTime"));
            // console.log($elToFill);

            my_widget_script.watchTime($elToWatch, $elToFill);
        });

        // Toggle card when clicked
        $(".card-header").on("click", (e)=>{
            this.toggleCard($(e.currentTarget));
        });

        // When an amount of 1x PBS is changed, update the volume of 10x PBS to use
        $("#desiredPBSVol").on("change", (e)=>{
            var desiredFinalVol = $(e.currentTarget).val();
            var startVol = this.PBS10xTo1xCalc(desiredFinalVol);
            $("#vol10xPBS").text(startVol);
        }).each((i,e)=>{
            var desiredFinalVol = $(e).val();
            var startVol = this.PBS10xTo1xCalc(desiredFinalVol);
            $("#vol10xPBS").text(startVol);
        });

        // When an amount of PBST1 solution is changed, update the volumes of components
        $(".updatePBST1").on("change", (e)=>{
            var solns = this.PBST1Calc(); // updating within function now
        });

        // When an amount of PBST1 solution is changed, update the volumes of components
        $(".updatePBST2").on("change", (e)=>{
            var solns = this.PBST2Calc(); // updating within function now
        });

        $("#addAntibody").on("click", ()=>{
            this.addAntibodyClick();
        });

        $("#addCRHcFosABs").on("click", ()=>{
            this.addCRHcFosABsClick();
        });

        $("#desiredSecondaryVol").on("input", ()=>{
            this.secondaryAbSolnCalc();
        });

        $(".calcVol").on("change", (e)=>{
            this.calcVolByPlate($(e.currentTarget));
        }).each((i,e)=>{
            this.calcVolByPlate($(e));
        });

        // Simple watch update
        $(".watch").each((i,e)=>{
            this.watchValue($(e));
        }).on("input", (e)=>{
            this.watchValue($(e.currentTarget));
        });

        $(".numWashes").on("change", (e)=>{
            var whichWash = $(e.currentTarget).data("whichwash");
            // console.log("change number of washes", whichWash);
            this.updateWashTracking($(e.currentTarget).val(), whichWash);
        });

        $(".washDur").on("change", (e)=>{
            this.updateWashDataTimes($(e.currentTarget));
        }).each((i,e)=>{
            this.updateWashDataTimes($(e));
        });

        $("#secondaryDur").on("change", (e)=>{
            var secondaryDur = $(e.currentTarget).val();
            var timeText = this.getTimeText(secondaryDur);

            $(".updateSecondaryDur").attr("data-time", timeText);
            $(".updateSecondaryDur").data("time", timeText);

            this.updateAllWatchTimes();
        });

        this.updateAllWatchTimes();
        this.PBST1Calc();
        this.PBST2Calc();
        this.secondaryAbSolnCalc();
        this.resize();
    },

    updateWashDataTimes: function($el){
        var washDur = $el.val();
        var timeText = this.getTimeText(washDur);
        var whichWash = $el.data("whichwash");
        // console.log("whichwash", whichWash);
        $(".updateWashDur"+whichWash).attr("data-time", timeText); // change it on the page
        $(".updateWashDur"+whichWash).data('time', timeText); // change what jquery works with

        this.updateAllWatchTimes();
    },

    updateAllWatchTimes: function(){
        $(".watchTime").each((i,e)=> {
            var $elToWatch = $(e);
            var $elToFill = $(e).parent().next().find($(".fillTime"));
            // console.log($elToFill);

            this.watchTime($elToWatch, $elToFill);
        });
    },

    /**
     * TO DO: edit this function to define which <div>s or other elements
     * should be adjusted based on the current width of the window
     */
    resize: function () {
        //resize the container
        this.parent_class.resize_container();
    },

    checkForNames: function() {
        $("input, select, textarea").each((i,e)=>{
            var hasName = $(e).attr("name");
            if(!hasName){
                console.log("There is no name attribute for: ", e.id);
            }
        })
    },
    // ********************** END CUSTOM INIT METHODS **********************


    // ********************** START CUSTOM TO_JSON METHODS **********************
    getDynamicContent: function () {
        var dynamicContent = {};
        return dynamicContent;
    },
    // ********************** END CUSTOM TO_JSON METHODS **********************

    /** -----------------------------------------------------------------------------
     * VALIDATE FORM ENTRY BEFORE COPYING OR SAVING TABLE TO CSV
     *
     * This function will check that elements with a class "needForTable"
     * are not blank. If there are blank elements, it will return false
     * and will post an error message "Please fill out all elements marked by a blue #"
     *
     * source: https://stackoverflow.com/questions/18495310/checking-if-an-input-field-is-required-using-jquery
     * -----------------------------------------------------------------------------
     */
     data_valid_form: function () {
        var valid = true; //begin with a valid value of true
        //var fail_log = ''; //begin with an empty fail log
        //var name; //create a name variable

        //search the_form for all elements that are of class "needForForm"
        $('.needForTable').each((i, e)=> {
            if (!$(e).val()) { //if there is not a value for this input
                valid = false; //change valid to false
                //name = $(e).attr('id'); //replace the name variable with the id attribute of this element
                //fail_log += name + " is required \n"; //add to the fail log that this name is required
            }
        });

        if (!valid) {
            $("#errorMsg").html("<span style='color:red; font-size:36px;'>Please fill out all elements marked by a</span><span style='color:blue; font-size:36px;'> blue #</span>");
        } else {
            $("#errorMsg").html("");
        }

        return valid;
    },

    //#region dialog boxes
    // Need this because there is positioning for some elements within the form, and it gives the offset relative to that
    // parent element with positioning, rather than to the top of the form
    getOffsetTop: function(element){
        var offsetTop = 0;
        var lastElement = 0;
        while(element && !lastElement){
            // console.log("the element", element);
            var formChild = $(element).children("#the_form");
            if(formChild.length>0){
                // console.log("found the child");
                lastElement = 1;
            }
            offsetTop += element.offsetTop;
            element = element.offsetParent;
            // console.log("offsetTop", offsetTop)
        }
        return offsetTop
    },

    /**
     * Run the supplied function if user presses OK
     * 
     * @param text The message to be displayed to the user. 
     * @param functionToCall Function to run if user pressed OK
     * @param elForHeight Element to based the height of the dialog box on
     * 
     * If no text is provided, "Are you sure?" is used
     * Can supply a function with no parameters and no () after the name,
     * or an anonymous function using function(){} or ()=>{}
     * 
     * Nothing happens if cancel or "X" is pressed
     * 
     * If elForHeight is left blank, height is auto
     * 
     * Example:
     * this.runIfConfirmed(
            "Do you want to run the function?", 
            ()=>{
                console.log("pretend delete function");
            }
        );
    */
    runIfConfirmed: function(text, functionToCall, elForHeight = null){
        var thisMessage = "Are you sure?";
        if(text){
            thisMessage = text;
        }
        var top = "auto";
        if(elForHeight){
            // Used to change the position of the modal dialog box
            top = this.getOffsetTop(elForHeight) + "px";
        }
        bootbox.confirm ({
            message: thisMessage,
            callback: (proceed)=>{
                if(proceed){
                    functionToCall()
                }
            }
        });
        $(".modal-dialog").css("top", top);
    },

    /**
     * Confirm with user
     * 
     * @param text The message to display to user
     * @param functionToCall Function to run, with the result (true/false) as a parameter
     * @param elForHeight Element to based the height of the dialog box on
     * 
     * If no text is provided, "Do you wish to proceed?" is the default
     * Use an anonymous function, function(result){} or (result)=>{}. Then the function can use the result to decide what to do
     * 
     * If elForHeight is left blank, height is auto
     * 
     * Example:
     * this.dialogConfirmx(
            "Make a choice:", 
            (result)=>{ // arrow function, "this" still in context of button
                if(result){
                    console.log("You chose OK");
                } else {
                    console.log("You canceled or closed the dialog");
                }
            }
        );
        */
    dialogConfirmx: function(text, functionToCall, elForHeight = null){
        var thisMessage = "Do you want to proceed?";
        if(text){
            thisMessage = text;
        }
        var top = "auto";
        if(elForHeight){
            // Used to change the position of the modal dialog box
            top = this.getOffsetTop(elForHeight) + "px";
        }
        bootbox.confirm ({
            message: thisMessage,
            callback: (result)=>{
                functionToCall(result);
            }
        });
        $(".modal-dialog").css("top", top);
    },

    /**
     * Get user input for a function
     * 
     * @param prompt Text to provide to the user
     * @param functionToCall Function to run, with the user input as a parameter
     * @param elForHeight Element to based the height of the dialog box on
     * 
     * If no text is provided, "Enter value:" is used as default
     * Use an anonymous function, function(result){} or (result)=>{}. Then the function can use the result to decide what to do
     * 
     * If elForHeight is left blank, height is auto
     *  
     * Example:
     * this.runBasedOnInput(
            "Enter a number from 0-10", (result)=>{
                if(result <= 10 && result >= 0){
                    console.log("You entered: " + result);
                } else {
                    console.log("You did not enter an appropriate value");
                }
            }
        );
        */ 
    runBasedOnInput: function(prompt, functionToCall, elForHeight = null){
        var thisTitle = "Enter value:"
        if(prompt){
            thisTitle = prompt;
        }
        var top = "auto";
        if(elForHeight){
            // Used to change the position of the modal dialog box
            top = this.getOffsetTop(elForHeight) + "px";
        }
        bootbox.prompt({
            title: thisTitle,
            callback: (result)=>{
                functionToCall(result);
            }
        });
        $(".modal-dialog").css("top", top);
    },
    //#endregion dialog boxes

    toggleCard: function ($cardHead) {
        // console.log($cardHead.next());
        $cardHead.next().toggleClass("collapse");
        $cardHead.next().find("textarea.autoAdjust").each((i,e)=> {
            if(! $(e).is(":hidden")) {
                e.setAttribute('style', 'height:' + (e.scrollHeight) + 'px;overflow-y:hidden;'); //add "display:inline-block"; if not working for ifOther textboxes in cards
            } 
        });
        my_widget_script.resize();
    },

    // ******************
    // Widget-specific 
    // ******************
    abNums: [],

    checkInArray: function (searchVal, array){
        var inArray = $.inArray(searchVal, array) !== -1;
        return inArray
    },

    dataSearch: function (dataName, dataValue) {
        var dataSearch = "[data-" + dataName + "='" + dataValue + "']";
        return dataSearch
    },

    abNumSearch: function (abNum) {
        var abSearch = this.dataSearch("abnum", abNum);
        return abSearch;
    },

    calcSearch: function (calc) {
        var calcSearch = this.dataSearch("calc", calc);
        return calcSearch;
    },

    watchSearch: function (watch) {
        var watchSearch = this.dataSearch("watch", watch);
        return watchSearch;
    },

    watchValue: function ($el) {
        var watch = $el.data("watch");
        var calcSearch = this.calcSearch(watch);
        var abNum = $el.data("abnum");
        
        var val = $el.val();

        // console.log("watch: " + watch + "; val: " + val);
        
        if(abNum){
            calcSearch += this.abNumSearch(abNum);
        }

        $(calcSearch).html(val);

        this.resize();
    },

    getHoursMin: function (timeString) {
        timeString = timeString.split(":");
        var hours = parseInt(timeString[0], 10), mins = parseInt(timeString[1], 10);
        return( 
            split = {
                hours: hours,
                mins: mins
            }
        )
    },

    watchTime: function ($elToWatch, $elToFill) {
        // console.log($elToFill);
        var addTime = $elToFill.data("time");
        // console.log(addTime);
        // console.log(length);

        var startTime = $elToWatch.val();
        if(startTime){
            var time = new Date();
            startTimeSplit = my_widget_script.getHoursMin(startTime);
            addTimeSplit = my_widget_script.getHoursMin(addTime);
            // set start time
            time.setHours(startTimeSplit.hours, startTimeSplit.mins, 0, 0);
            time.setHours(time.getHours() + addTimeSplit.hours);
            time.setMinutes(time.getMinutes() + addTimeSplit.mins);
            // console.log(time);
            $elToFill.text(time.toLocaleTimeString());
        } else{
            $elToFill.text("{Enter Start Time}")
        }

        my_widget_script.resize();
    },

    /**
     * @param dilFraction Dilution fraction for the item you're adding
     * @param desiredFinalVol Final volume of solution
     * 
     * returns the volume of the concentrated substance to be added
     * 
     * For example, for making 500 mL of 1x PBS using 10x PBS,
     * you would enter this.startVolOfDilutionCalc(0.1, 500)
     */
    startVolOfDilutionCalc: function(dilFraction, desiredFinalVol){
        var startVol = desiredFinalVol * dilFraction
        // console.log("startVol", startVol);
        // console.log("startVol rounded", +startVol.toFixed(2)); // the + gets rid of extra zeros
        return(startVol); // round when using (+startVol.toFixed(2))
    },

    // Return the amount of 10x PBS to use for making 1x PBS
    PBS10xTo1xCalc: function(desiredFinalVol){
        if(desiredFinalVol > 0){
            var dilFraction = 1/10;
            var startVol = +this.startVolOfDilutionCalc(dilFraction, desiredFinalVol).toFixed(2);
        } else {
            var startVol = "[Enter desired amount]"
        }
        return(startVol)
    },

    calcVolByPlate: function($el){
        var plateSize = $el.val();
        var type = $el.data("volwatch");
        var typeSearch = this.dataSearch("volcalc", type);

        var amnt;
        if(plateSize == 24){
            amnt = "500&micro;"
        }else if(plateSize == 12){
            amnt = "1.5m"
        } else if(plateSize == 6){
            amnt = "3m"
        } else {
            amnt = "specify appropriate plate size"
        }
        $(".printVol"+typeSearch).html(amnt)
    },

    // Return the amount of triton, and PBS for first PBST solution
    // Default is 0.1% triton
    PBST1Calc: function(version){
        var desiredFinalVol = $("#desiredPBST2Vol").val();
        var percTriton = $("#percTriton2").val();
        if(!(percTriton>0) || percTriton > 100){
            percTriton = 0.1;
            $("#percTriton2").val(0.1);
            this.watchValue($("#percTriton2"));
        }
        var dilFractionTriton = percTriton/100;
        if(desiredFinalVol > 0){
            // var dilFractionTriton = 0.004; // 0.4% triton
            var startVolTritonx100 = this.startVolOfDilutionCalc(dilFractionTriton, desiredFinalVol);
            // console.log(startVolTritonx100);
            var startVolTriton20percmL = startVolTritonx100 * 5;
            var startVolTriton20percuL = +(startVolTriton20percmL * 1000).toFixed(2);
            var startVolPBS = +(desiredFinalVol - startVolTriton20percmL).toFixed(2);
        } else {
            var startVolTriton20percuL = "[Enter desired amount]"
            var startVolPBS = "[Enter desired amount]"
        }
        solns = {
            triton2: startVolTriton20percuL,
            PBS2: startVolPBS
        }
        $("#volTriton2").text(solns.triton2);
        $("#volPBS2").text(solns.PBS2);
        $(".PBST1_option").text(percTriton + "% PBS-T");
        return(
            solns
        )
    },

    // Return the amount of triton, and PBS for first PBST solution
    // Default is 0.1% triton
    PBST2Calc: function(version){
        var desiredFinalVol = $("#desiredPBST3Vol").val();
        var percTriton = $("#percTriton3").val();
        if(!(percTriton>0) || percTriton > 100){
            percTriton = 0.4;
            $("#percTriton3").val(0.4);
            this.watchValue($("#percTriton3"));
        }
        var dilFractionTriton = percTriton/100;
        if(desiredFinalVol > 0){
            // var dilFractionTriton = 0.004; // 0.4% triton
            var startVolTritonx100 = this.startVolOfDilutionCalc(dilFractionTriton, desiredFinalVol);
            // console.log(startVolTritonx100);
            var startVolTriton20percmL = startVolTritonx100 * 5;
            var startVolTriton20percuL = +(startVolTriton20percmL * 1000).toFixed(2);
            var startVolPBS = +(desiredFinalVol - startVolTriton20percmL).toFixed(2);
        } else {
            var startVolTriton20percuL = "[Enter desired amount]"
            var startVolPBS = "[Enter desired amount]"
        }
        solns = {
            triton3: startVolTriton20percuL,
            PBS3: startVolPBS
        }
        $("#volTriton3").text(solns.triton3);
        $("#volPBS3").text(solns.PBS3);
        $(".PBST2_option").text(percTriton + "% PBS-T");
        return(
            solns
        )
    },

    secondaryAbSolnCalc: function(){
        var $secondaryVol = $("#desiredSecondaryVol");
        var secondaryVol = $secondaryVol.val();

        if(secondaryVol > 0){
            // For each dilution factor entry
            $(".abDilution").each((i,e)=>{
                var abNum = $(e).data("abnum");
                var abSearch = this.abNumSearch(abNum);
                var dilutionFactor = $(e).val();
                // If there's a value entered that's greater than 0
                if(dilutionFactor > 0){
                    // Convert to a proportion
                    var dilutionVal = 1/dilutionFactor;
                    // Get the volume in mL
                    var amountAb_mL = this.startVolOfDilutionCalc(dilutionVal, secondaryVol);
                    // Convert to uL
                    var amountAb_uL = +(amountAb_mL * 1000).toFixed(2);
                    var stockDilution = $(".abStock"+abSearch).val();
                    if(stockDilution>0){
                        var amountAbStock_uL = +(amountAb_uL*stockDilution).toFixed(2);
                    } else{
                        var amountAbStock_uL = "[Enter stock dilution]"
                    }
                } else{
                    var amountAb_uL = "[Enter dilution factor]"
                    var amountAbStock_uL = "[Enter dilution factor]"
                }
                // Fill in the amount for the abnum matches
                $(".abAmount"+abSearch).text(amountAbStock_uL);
            });
        } else{
            secondaryVol = "[Enter desired volume]";
            $(".abDilution").each((i,e)=>{
                var abNum = $(e).data("abnum");
                var abSearch = this.abNumSearch(abNum);
                $(".abAmount"+abSearch).text("[Enter desired volume]");
            });
        }
        $("#volBlockingForSecondary").text(secondaryVol);
    },

    addAntibodyClick: function (){
        var abNum = 1;
        if(this.abNums.length > 0){
            var lastAb = this.abNums[this.abNums.length - 1];
            // console.log("lastAb: " + lastAb);
            abNum = lastAb + 1;
        }

        var inArray = this.checkInArray(abNum, this.abNums);
        if(! inArray){
            this.addAntibodies(abNum);
        }
    },

    addCRHcFosABsClick: function (){
        var abNum = 1;
        if(this.abNums.length > 0){
            var lastAb = this.abNums[this.abNums.length - 1];
            // console.log("lastAb: " + lastAb);
            abNum = lastAb + 1;
        }

        // Make an antibody for the rabbit anti-cFos
        var inArray = this.checkInArray(abNum, this.abNums);
        if(! inArray){
            this.addAntibodies(abNum);
        }
        
        // Fill in the information
        var abSearch = this.abNumSearch(abNum);
        $(".abName"+abSearch).val("goat anti-rabbit");
        var calcSearch = this.calcSearch("abName");
        $(calcSearch + abSearch).text("goat anti-rabbit");
        $(".abDilution"+abSearch).val("500");

        // Go to the next antibody number
        abNum++;

        // Make it
        var inArray = this.checkInArray(abNum, this.abNums);
        if(! inArray){
            this.addAntibodies(abNum);
        }
        
        // Fill in the info
        var abSearch = this.abNumSearch(abNum);
        $(".abName"+abSearch).val("goat anti-chicken");
        var calcSearch = this.calcSearch("abName");
        $(calcSearch + abSearch).text("goat anti-chicken");
        $(".abDilution"+abSearch).val("500");

        // Update the calculation
        this.secondaryAbSolnCalc();
    },

    addAntibodies: function(abNum){
        this.abNums.push(abNum);

        var myLeftCol = "col-4 col-sm-5 col-md-4 col-lg-5 text-right"

        $("#abInfo").append(
            $("<div></div>", {
                "class": "row mt-2", 
                "data-abnum": abNum
            }).append(
                $("<h4></h4>", {
                    "class": "col",
                    "data-abnum": abNum,
                    "data-calc": "abName"
                }).append("Antibody " + abNum)
            ).append(
                $("<div></div>", {
                    "class": "col"
                }).append(
                    $("<input></input>", {
                        "type": "button",
                        "data-abnum": abNum,
                        "value": "Delete antibody",
                        name: "deleteab"+abNum,
                        id: "deleteAb"+abNum,
                        "class": "col fullWidth deleteAb hideView"
                    }).on("click", (e)=>{
                        this.deleteAb(abNum, elForHeight = e.currentTarget)
                    })
                )
            )
        ).append(
            $("<div></div>", {
                "class": "row",
                "data-abnum": abNum
            }).append(
                "<div class='"+myLeftCol+"'>Antibody name</div>"
            ).append(
                $("<div></div>", {
                    "class": "col"
                }).append(
                    $("<input></input>", {
                        "class": "fullWidth abName watch", 
                        type: "text",
                        "name": "abname"+abNum,
                        "id": "abName"+abNum,
                        "data-abnum": abNum,
                        "data-watch": "abName",
                        "value": "Ab " + abNum
                    })
                )
            )
        ).append(
            $("<div></div>", {
                "class": "row",
                "data-abnum": abNum
            }).append(
                "<div class='"+myLeftCol+"'>Final ab dilution (1:x)</div>"
            ).append(
                $("<div></div>", {
                    "class": "col"
                }).append(
                    $("<input></input>", {
                        "class": "fullWidth abDilution", 
                        type: "number",
                        "name": "abdilution"+abNum,
                        "id": "abDilution"+abNum,
                        "data-abnum": abNum
                    })
                ).on("input", (e)=>{
                    this.secondaryAbSolnCalc();
                })
            )
        ).append(
            $("<div></div>", {
                "class": "row",
                "data-abnum": abNum
            }).append(
                "<div class='"+myLeftCol+"'>Current ab stock dilution(1:x)</div>"
            ).append(
                $("<div></div>", {
                    "class": "col"
                }).append(
                    $("<input></input>", {
                        "class": "fullWidth abStock", 
                        type: "number",
                        "name": "abstock"+abNum,
                        "id": "abStock"+abNum,
                        "value": 1,
                        "data-abnum": abNum
                    })
                ).on("input", (e)=>{
                    this.secondaryAbSolnCalc();
                })
            )
        );

        $("#abAmountInfo").append(
            $("<div></div>", {
                "class": "row",
                "data-abnum": abNum
            }).append(
                $("<div></div>", {
                    "class": "green " + myLeftCol,
                }).append(
                    $("<span></span>", {
                        "class": "abAmount",
                        "data-abnum": abNum
                    })
                ).append(" &micro;L")
            ).append(
                $("<div></div>", {
                    "class": "col",
                    "data-abnum": abNum,
                    "data-calc": "abName"
                })
            )
        );

        $("#abInfo").find(".watch").each((i,e)=> { 
            this.watchValue($(e));
        }).on("input", (e)=>{
            this.watchValue($(e.target)); // or currentTarget
        });
    },

    deleteAb: function (abNum, elForHeight = null){
        this.runIfConfirmed(
            "Are you sure that you wish to delete this antibody?",
            ()=>{
                var search = this.abNumSearch(abNum);
                $(search).remove(); 
                
                var index = this.abNums.indexOf(abNum);
                if(index > -1){
                    this.abNums.splice(index, 1);
                }
            },
            elForHeight = elForHeight
        )
    },

    updateWashTracking: function(numWashes, whichWash){
        var currentNumWashes;
        currentNumWashes = parseInt(this["numWashes"+whichWash]);
        // console.log("current number of washes", currentNumWashes);
        if( currentNumWashes < numWashes){
            for(i = currentNumWashes; i < numWashes; i++){
                this.makeWashRow(i, whichWash);
            }
            this["numWashes"+whichWash] = numWashes;
        } else if(currentNumWashes > numWashes){
            this.dialogConfirm(
                "Are you sure you want to remove a wash?", 
                (result)=>{
                    if(result){
                        for(i = currentNumWashes; i >= numWashes; i--){
                            var washSearch = this.dataSearch("wash", i) + this.dataSearch("whichwash", whichWash);
                            $(washSearch).remove();
                        }
                        this["numWashes"+whichWash] = numWashes;
                    } else {
                        $("#numWashes"+whichWash).val(currentNumWashes); // reset
                    }
                    this.resize();
                }
            )
        }
        this.resize();
    },

    getTimeText: function(timeInMin){
        var hours = 0, min = 0; timeText = "00:00"
        if(timeInMin){
            hours = Math.floor(timeInMin/60);
            min = Math.round(timeInMin % 60);
            timeText = ("00" + hours).slice(-2) + ":" + ("00"+min).slice(-2);
        }
        return timeText
    },

    makeWashRow: function(washIndex, whichWash){
        var myLeftCol4 = "col-6 col-md-4 col-lg-3 text-right"
        var timeText = this.getTimeText($("#washDur"+whichWash).val());
        var printNum = washIndex + 1;
        $("#washTimeDiv"+whichWash).append(
            $("<div></div>", {
                "class": "row mt-1",
                "data-wash": washIndex,
                "data-whichwash": whichWash
            }).append(
                $("<div></div>", {
                    "class": myLeftCol4
                }).append(
                    $("<input></input>", {
                        "type": "time",
                        "name": "rinsetime" + washIndex + "w" + whichWash,
                        "id": "rinseTime" + washIndex + "w" + whichWash,
                        "class": "watchTime fullWidth"
                    }).on("input", (e)=>{
                        var $elToWatch = $(e.currentTarget);
                        var $elToFill = $(e.currentTarget).parent().next().find($(".fillTime"));
                        // console.log($elToFill);
                        this.watchTime($elToWatch, $elToFill);
                    })
                )
            ).append(
                $("<div></div>", {
                    "class": "col"
                }).append(
                    "Wash " + printNum + " complete at <span class='fillTime purple updateWashDur"+whichWash+"' data-time='" + timeText + "'>{Enter Start Time}</span>"
                )
            )
        )
    }
};

//**************************************************************************
//End of your code
//**************************************************************************
//**************************************************************************
      //the parent class functionality is added to your class below.
      form_script.parent_class = parent_form_script;
      //**************************************************************************
      //**************************************************************************
      //call to the init function in your script.  Note that you can change the mode in the call here.
      //your choices are view,view_dev,edit,edit_dev,  see the parent class source for details
      form_script.init("edit", function() {return form_script.test_data()});


    }
)

}
catch (e) {

}

parent_form_script.wiget_version_info ={"version":20,"created":"2020-12-29T22:00:23-05:00","last_modified_at":"2021-01-03T18:51:34-05:00","last_modified_by":"Amanda Gibson","owned_by":"unknown"};

</script>
<form id="the_form" style="display:table">
<!------------------------------------------------------------------------------------------>
<!--the html for your tool goes here.  Paste it into the LA dev tool when you have it the way you want it-->
<!------------------------------------------------------------------------------------------>
<!-- #region HTML -->
<!-- Bootstrap CSS -->
<link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" rel="stylesheet" />
<style type="text/css">
    /* TO DO Place css styling code here */

    /* responsive table doesn't work with xs screen sizes for some reason, so apply a specific width for these */
    @media (max-width: 576px) {
        .xsTableDiv {
            width: 300px !important;
            overflow-x: scroll;
        }
    }

    table {
        border: 2px solid black;
    }

    th {
        padding: 5px;
        border: 2px solid black;
    }

    td {
        padding: 5px;
        border: 1px solid black;
    }

    .fullWidth {
        width: 90%
    }

    .halfWidth {
        width: 50%
    }

    .green{
        color: green;
    }

    .bottomLine{
        border-bottom: 2px solid black;
    }

    .blue{
        color: blue;
    }

    .orange{
        color: orange;
    }

    .lightBlue{
        color: rgb(77, 167, 246);
    }

    .red{
        color: red;
    }

    .purple{
        color: purple;
    }

    ul {
        margin-left: 0;
        padding-left: 20px;
    }
</style>

<!-- TO DO Begin typing your HTML code here -->
<div class="container hideView">
    <p>Elements that are required to save this page are marked with a red asterisk <span
            style="color:red">*</span></p>
</div>

<div class="container">
    <div class="row">
        <!-- PBS Card -->
        <div class="col-12 col-lg-6">
            <div class="card">
                <button class="card-header" type="button">
                    1x PBS
                </button>
                <div class="card-body container collapse">
                    <div class="row mt-2 align-items-start">
                        <div class="myLeftCol green">50 mL</div>
                        <div class="col">10x PBS</div>
                    </div>
                    <div class="row mt-2 align-items-start">
                        <div class="myLeftCol bottomLine">
                            <div class="row">
                                <div class="col-2 text-left">
                                    +
                                </div>
                                <div class="col green">450 mL</div>
                            </div>
                        </div>
                        <div class="col">H<sub>2</sub>O <em>use milliQ water and fill to 500 mL </em></div>
                    </div>
                    <div class="row mt-2 align-items-start">
                        <div class="myLeftCol">500 mL</div>
                        <div class="col"><strong>total</strong></div>
                    </div>
                    <div class="row mt-2 align-items-end">
                        <div class="myLeftCol2">
                            <input type="date" name="pbs1xdate" id="pbs1xDate">
                        </div>
                        <div class="col">Date</div>
                    </div>
                    <div class="row mt-2">
                        <div class="col">
                            <strong>Alternate Amount:</strong><br/>
                        </div>
                    </div>
                    <div class="row mt-2 align-items-start">
                        <div class="myLeftCol">
                            <input type="number" name="desiredpbsvol" id="desiredPBSVol" class="fullWidth">
                        </div>
                        <div class="col">Desired 1x PBS final volume (mL)</div>
                    </div>
                    <div class="row mt-2 align-items-start">
                        <div class="myLeftCol green"><span id="vol10xPBS">[Enter desired amount]</span> mL</div>
                        <div class="col">Amount of 10x PBS to add</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- PBS-T Solution 1 -->
        <div class="col-12 col-lg-6">
            <div class="card">
                <button class="card-header" type="button">
                    PBS + <span data-calc="percTriton2">0.1</span>% Triton
                </button>
                <div class="card-body container collapse">
                    <div class="row font-italic">
                        Prepare a solution of TritonX100 at 20% dilution 1:5 (8mL Triton + 32mL PBS 1X). You can keep it for a very long time at 4&deg;C.
                        Diluted triton is easier to use as it is a sticky detergent
                    </div>
                    <div class="row mt-2 align-items-end">
                        <div class="myLeftCol2">
                            <input type="date" name="pbst1date" id="pbst1Date">
                        </div>
                        <div class="col">Date</div>
                    </div>
                    <div class="row mt-2">
                        <div class="col">
                            <strong>Percentages:</strong>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="myLeftCol">
                            <input type="number" name="perctriton2" id="percTriton2" class="fullWidth updatePBST1 watch" data-watch="percTriton2" value="0.1" min="0" max="100" step="0.1"/>
                        </div>
                        <div class="col">
                            % triton
                        </div>
                    </div>

                    <div class="row mt-2">
                        <div class="col">
                            <strong>Desired Amount:</strong><br/>
                        </div>
                    </div>
                    <div class="row mt-2 align-items-start">
                        <div class="myLeftCol">
                            <input type="number" name="desiredpbst2vol" id="desiredPBST2Vol" class="fullWidth updatePBST1 watch" data-watch="vol2" value="30">
                        </div>
                        <div class="col">Desired solution volume (mL)</div>
                    </div>
                    <div class="row mt-2 align-items-start">
                        <div class="myLeftCol green"><span id="volTriton2">[Enter desired amount]</span> &micro;L</div>
                        <div class="col">20% triton</div>
                    </div>
                    <div class="row mt-2 align-items-start">
                        <div class="myLeftCol bottomLine">
                            <div class="row">
                                <div class="col-2 text-left">
                                    +
                                </div>
                                <div class="col green"><span id="volPBS2">[Enter desired amount]</span> mL</div>
                            </div>
                        </div>
                        <div class="col">PBS 1x</div>
                    </div>

                    <div class="row mt-2 align-items-start">
                        <div class="myLeftCol"><span data-calc="vol2">[Enter desired amount]</span> mL</div>
                        <div class="col"><strong>total</strong></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- PBS-T Solution 2 -->
        <div class="col-12 col-lg-6">
            <div class="card">
                <button class="card-header" type="button">
                    PBS + <span data-calc="percTriton3">0.4</span>% Triton
                </button>
                <div class="card-body container collapse">
                    <div class="row font-italic">
                        Prepare a solution of TritonX100 at 20% dilution 1:5 (8mL Triton + 32mL PBS 1X). You can keep it for a very long time at 4&deg;C.
                        Diluted triton is easier to use as it is a sticky detergent
                    </div>
                    <div class="row mt-2 align-items-end">
                        <div class="myLeftCol2">
                            <input type="date" name="pbst2date" id="pbst2Date">
                        </div>
                        <div class="col">Date</div>
                    </div>
                    <div class="row mt-2">
                        <div class="col">
                            <strong>Percentages:</strong>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="myLeftCol">
                            <input type="number" name="perctriton3" id="percTriton3" class="fullWidth updatePBST2 watch" data-watch="percTriton3" value="0.4" min="0" max="100" step="0.1"/>
                        </div>
                        <div class="col">
                            % triton
                        </div>
                    </div>

                    <div class="row mt-2">
                        <div class="col">
                            <strong>Desired Amount:</strong><br/>
                        </div>
                    </div>
                    <div class="row mt-2 align-items-start">
                        <div class="myLeftCol">
                            <input type="number" name="desiredpbst3vol" id="desiredPBST3Vol" class="fullWidth updatePBST2 watch" data-watch="vol3" value="30">
                        </div>
                        <div class="col">Desired solution volume (mL)</div>
                    </div>
                    <div class="row mt-2 align-items-start">
                        <div class="myLeftCol green"><span id="volTriton3">[Enter desired amount]</span> &micro;L</div>
                        <div class="col">20% triton</div>
                    </div>
                    <div class="row mt-2 align-items-start">
                        <div class="myLeftCol bottomLine">
                            <div class="row">
                                <div class="col-2 text-left">
                                    +
                                </div>
                                <div class="col green"><span id="volPBS3">[Enter desired amount]</span> mL</div>
                            </div>
                        </div>
                        <div class="col">PBS 1x</div>
                    </div>

                    <div class="row mt-2 align-items-start">
                        <div class="myLeftCol"><span data-calc="vol3">[Enter desired amount]</span> mL</div>
                        <div class="col"><strong>total</strong></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secondary -->
        <div class="col-12 col-lg-6">
            <div class="card">
                <button class="card-header" type="button">
                    Secondary Antibody Solution
                </button>
                <div class="card-body container collapse">
                    <div class="row">
                        <div class="col">
                            <strong>Prepare in  
                                <select name="secondarystartsoln" id="secondaryStartSoln" class="lightBlue">
                                    <option value="PBS1x">1x PBS</option>
                                    <option value="PBST1" class="PBST1_option">PBS + 0.1% Triton</option>
                                    <option value="PBST2" class="PBST2_option" selected="true">PBS + 0.4% Triton</option>
                                </select>
                            </strong>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="myLeftCol2">
                            <input type="date" name="secondarydate" id="secondaryDate">
                        </div>
                        <div class="col">Date</div>
                    </div>
                    <div class="row mt-2">
                        <div class="col">
                            <strong>Amounts:</strong><br/>
                        </div>
                    </div>
                    <div class="row mt-2 align-items-start">
                        <div class="myLeftCol">
                            <input type="number" name="desiredsecondaryvol" id="desiredSecondaryVol" class="fullWidth">
                        </div>
                        <div class="col">Desired secondary antibody solution volume (mL)</div>
                    </div>
                    <div class="row mt-2 align-items-start">
                        <div class="myLeftCol green"><span id="volBlockingForSecondary">[Enter desired amount]</span> mL</div>
                        <div class="col">Amount of solution to use</div>
                    </div>
                    <div id="abAmountInfo">&nbsp;</div>
                    <div class="row mt-2 hideView">
                        <div class="col"><input type="button" value="Add Antibody" id="addAntibody" name="addantibody" class="fullWidth disableOnView"></div>
                    </div>
                    <div class="row mt-2 hideView">
                        <div class="col"><input type="button" value="Add CRH cFos Study ABs" id="addCRHcFosABs" name="addcrhcfosabs" class="fullWidth disableOnView"></div>
                    </div>
                    <div id="abInfo">&nbsp;</div>
                    <div class="row mt-2 font-italic">
                        <div class="col">
                            To find where your AB is stored (4&deg;C, -20&deg;C, -80&deg;C), look at the IHC folder in the IHC drawer<br/>
                        </div>
                    </div>  
                    <div class="row mt-2">
                        <div class="col font-italic">
                            Tips: To prepare less secondary AB, you can transer the slices from basket to the well (3 mL of AB in a well of 6well plate is enough,
                            vs 7mL minimum when you use the basket)
                            or, use a 24-well plate with 500&micro;L per well<br/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container mt-2">
    <div class="row">
        <h3 class="col">Experiment Information:</h3>
    </div>
    <div class="row mt-2">
        <div class="myLeftCol4">
            Experiment:
        </div>
        <div class="col">
            <input type="text" id="experiment" name="experiment" class="fullWidth"></input>
        </div>
    </div>
    <div class="row mt-2">
        <div class="myLeftCol4">
            Date:
        </div>
        <div class="col">
            <input type="date" name="expdate" id="expDate" class="fullWidth"></input>
        </div>
    </div>
    <div class="row mt-2">
        <div class="myLeftCol4">
            Purpose:
        </div>
        <div class="col">
            <textarea name="purpose" id="purpose" class="fullWidth autoAdjust"></textarea>
        </div>
    </div>
    <div class="row mt-2">
        <div class="myLeftCol4">
            Samples:
        </div>
        <div class="col">
            <textarea name="samples" id="samples" class="fullWidth autoAdjust"></textarea>
        </div>
    </div>
</div>

<div class="container mt-2">
    <div class="row">
        <h3 class="col">Day 2:</h3>
    </div>
    <div class="row mt-2">
        <div class="myLeftCol3">1. <input type="checkbox" name="step1" id="step1"/></div>
        <div class="col">
            Remove slices from primary incubation and transfer them into a basket (cell strainer), inside a 6-well plate, filled with 
            <select name="initialsoln" id="initialSoln" class="lightBlue">
                <option value="PBS1x">1x PBS</option>
                <option value="PBST1" class="PBST1_option">PBS + 0.1% Triton</option>
                <option value="PBST2" class="PBST2_option">PBS + 0.4% Triton</option>
            </select><br/>
            Label baskets and plate cover
        </div>
    </div>
    <div class="row mt-2">
        <div class="myLeftCol3">2. <input type="checkbox" name="step2" id="step2"/></div>
        <div class="col">
            Wash sections <span class="blue">
            <input type="number" id="numWashes1" name="numwashes1" value="5" step="1" style="width: 3em;" class="blue numWashes" data-whichwash="1"></input>
            times for 
            <input type="number" id="washDur1" name="washdur1" value="10" step="1" style="width: 3em;" class="blue washDur" data-whichwash="1"></input>
            min</span> on shaker <em>(describe below)</em> with 
            <select name="washsoln1" id="washSoln1" class="lightBlue">
                <option value="PBS1x">1x PBS</option>
                <option value="PBST1" class="PBST1_option">PBS + 0.1% Triton</option>
                <option value="PBST2" class="PBST2_option">PBS + 0.4% Triton</option>
            </select><br/>
        </div>
    </div>
    <div class="row mt-1">
        <div class="myLeftCol3">&nbsp;</div>
        <div class="col">
            <textarea name="shakerinfo" id="shakerInfo" class="autoAdjust halfWidth" placeholder="shaker info"></textarea>
        </div>
    </div>
    <div class="mt-2" id="washTimeDiv1">
        &nbsp;
    </div>
    <div class="row mt-2">
        <div class="myLeftCol3">3. <input type="checkbox" name="step3" id="step3"/></div>
        <div class="col">
            Incubate the slices in 
            <select name="platesecondary" id="plateBlocking" class="calcVol" data-volwatch="secondary">
                <option value="24">24</option>
                <option value="12">12</option>
                <option value="6">6</option>
            </select>
            -well plate with <span class="green"><span class="printVol" data-volcalc="secondary">500&micro;</span>L</span> of 
            <span class="lightBlue">secondary solution</span> <em>(see secondary antibodies above)</em>
            for <span class="blue">
                <input type="number" name="secondarydur" id="secondaryDur" value="90" style="width:4em;" class="blue"></input> min
            </span> at RT<br/>
            <em>From this step until the end, sections should be protected from light. Fluorescent antibodies are light sensitive</em>
        </div>
    </div>
    <div class="row mt-2">
        <div class="myLeftCol4"><input type="time" name="secondarytime" id="secondarytime" class="watchTime fullWidth"></div>
        <div class="col">
            Secondary incubation complete at <span class="fillTime purple updateSecondaryDur" data-time="01:30">{Enter Start Time}</span>
        </div>
    </div>
    <div class="row mt-2">
        <div class="myLeftCol3">4. <input type="checkbox" name="step4" id="step4"/></div>
        <div class="col">
            Wash sections <span class="blue">
            <input type="number" id="numWashes2" name="numwashes2" value="5" step="1" style="width: 3em;" class="blue numWashes" data-whichwash="2"></input>
            times for 
            <input type="number" id="washDur2" name="washdur2" value="10" step="1" style="width: 3em;" class="blue washDur" data-whichwash="2"></input>
            min</span> on shaker with 
            <select name="washsoln2" id="washSoln2" class="lightBlue">
                <option value="PBS1x">1x PBS</option>
                <option value="PBST1" class="PBST1_option">PBS + 0.1% Triton</option>
                <option value="PBST2" class="PBST2_option">PBS + 0.4% Triton</option>
            </select><br/>
        </div>
    </div>
    <div class="mt-2" id="washTimeDiv2">
        &nbsp;
    </div>
    <div class="row mt-2">
        <div class="myLeftCol3">5. <input type="checkbox" name="step5" id="step5"/></div>
        <div class="col">
            Transfer the sections into PBS 1X in the lid of a 10cm Petri dish
        </div>
    </div>
    <div class="row mt-2">
        <div class="myLeftCol3">6. <input type="checkbox" name="step6" id="step6"/></div>
        <div class="col">
            Order the sections from rostral to caudal to allow for seamless imaging
        </div>
    </div>
    <div class="row mt-2">
        <div class="myLeftCol3">7. <input type="checkbox" name="step7" id="step7"/></div>
        <div class="col">
            Fill the Petri dish with PBS 1X. Place the sections on charged glass slides in the established order. <em>Charged slides limit the floating of the sections</em>
            <ol type="a">
                <li>
                    Nearly submerge the slide in the PBS in the Petri dish, 
                    resting one edge on the bottom of the dish and holding 
                    the labeled end with thumb and index finger
                </li>
                <li>
                    Use a paintbrush to move the sections from the lid of 
                    the Petri dish to the proper place on the slide in the Petri dish
                </li>
                <li>
                    Begin with the sections that will be placed closest to your hand 
                    and finish with the sections closest to the resting end of the slide 
                    to ensure that the previously placed sections with not slip off the slide
                </li>
                <li>
                    Place the sections so they are in the same orientation and parallel
                    with the edge of the slide to prevent discrepancies while imaging
                </li>
            </ol>
        </div>
    </div>
    <div class="row mt-2">
        <div class="myLeftCol3">8. <input type="checkbox" name="step8" id="step8"/></div>
        <div class="col">
            Allow to air dry at room temp for 45-60 min in dark conditions to avoid photobleaching. Label.
        </div>
    </div>
    <div class="row mt-1">
        <div class="myLeftCol4"><input type="time" name="drytime" id="drytime" class="watchTime fullWidth"></div>
        <div class="col">
            Drying should be complete at <span class="fillTime purple" data-time="01:00">{Enter Start Time}</span>
        </div>
    </div>
    <div class="row mt-2">
        <div class="myLeftCol3">9. <input type="checkbox" name="step9" id="step9"/></div>
        <div class="col">
            Using a cut P1000 tip to avoid making bubbles, add 170 μL of ProLong Gold antifade reagent 
            with DAPI (mounting media) to the slide. 
            Apply in a “T” shape with the top of the “T” on the side opposite of label.
            <em>DAPI stains cell DNA marking the nuclei of the cells. This provides a structural overview
                of the section when imaging and viewing. ProLong Gold physically and chemically stabilizes
                the section on the slide to prevent moving of the sections and photobleaching
            </em>
        </div>
    </div>
    <div class="row mt-2">
        <div class="myLeftCol3">10. <input type="checkbox" name="step10" id="step10"/></div>
        <div class="col">
            Slowly lower the coverslip over the sections, beginning from the top of the "T" and
            lowering towards the slide label. Ensure that the media covers all of the sections.
            Gently use a KimWipe and your fingers to push off any resulting bubbles
            <em>Try to avoid leaking from beneath the cover slip</em><br/>
        </div>
    </div>
    <div class="row mt-2">
        <div class="myLeftCol3">11. <input type="checkbox" name="step11" id="step11"/></div>
        <div class="col">
            Let mounting media cure for 24hr at room temperature
        </div>
    </div>
    <div class="row">
        <h3 class="col">Day 3:</h3>
    </div>
    <div class="row mt-2">
        <div class="myLeftCol3">12. <input type="checkbox" name="step12" id="step12"/></div>
        <div class="col">
            Add clear nail polish along the edge of the slide to seal the coverslip and prevent slipping
        </div>
    </div>
    <div class="row mt-2">
        <div class="myLeftCol3">13. <input type="checkbox" name="step13" id="step13"/></div>
        <div class="col">
            Clean up excess mounting media on the top of the coverslip and the bottom of the slide
            using ethanol and KimWipes
        </div>
    </div>
</div>
<!-- #endregion -->
<!------------------------------------------------------------------------------------------>
<!--end of your code-->
<!------------------------------------------------------------------------------------------>

</form>
</body>
</html>