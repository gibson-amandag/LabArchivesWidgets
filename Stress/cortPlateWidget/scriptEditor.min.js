my_widget_script={init:function(mode,json_data){this.include("https://code.jquery.com/jquery-3.5.1.min.js","sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=","anonymous",()=>{$(document).ready(()=>{
this.include("https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js","sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl","anonymous",()=>{$(document).ready(()=>{
this.include("https://cdn.jsdelivr.net/npm/luxon@1.26.0/build/global/luxon.min.js","sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0=","anonymous",()=>{$(document).ready(()=>{
this.include("https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.min.js","sha512-RdSPYh1WA6BF0RhpisYJVYkOyTzK4HwofJ3Q7ivt/jkpW6Vc8AurL1R+4AUcvn9IwEKAPm/fk7qFZW3OuiUDeg==","anonymous",()=>{$(document).ready(()=>{
this.include("https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.15.0/js/selectize.js","sha512-1HjnkKhHSDunRgIHRK4gXORl/T0WxhVkiQ5gjwvrH4yQK9RqPqYnPPwJfh+6gYTc/U9Cg8n4MGRZV1CzsP0UIA==","anonymous",()=>{
this.include("https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js","sha512-SGWgwwRA8xZgEoKiex3UubkSkV1zSE1BS6O4pXcaxcNtUlQsOmOmhVnDwIvqGRfEmuz83tIGL13cXMZn6upPyg==","anonymous",()=>{$jq351=jQuery.noConflict(true),this.myInit(mode,json_data)})})})})})})})})})})},
include:function(src,integrity,crossorigin,onload){var head=document.getElementsByTagName("head")[0],script=document.createElement("script");script.setAttribute("integrity",integrity),script.setAttribute("crossorigin",crossorigin),script.src=src,script.type="text/javascript",
script.onload=script.onreadystatechange=function(){if(script.readyState){if("complete"===script.readyState||"loaded"===script.readyState)script.onreadystatechange=null,onload()}else onload()},head.appendChild(script)},myInit:function(mode,json_data){this.makePlates(),this.makeWellEntries()
;var parsedJson=this.parseInitJson(json_data);this.initDynamicContent(parsedJson),window.onresize=(()=>this.resize()),this.addEventListeners(),this.parent_class.init(mode,()=>JSON.stringify(parsedJson.widgetData)),this.addRequiredFieldIndicators(),this.setUpInitialState(),this.adjustForMode(mode),
this.checkForNames()},to_json:function(){var widgetJsonString=this.parent_class.to_json(),dynamicContent=this.getDynamicContent(),output={widgetData:JSON.parse(widgetJsonString),netODvals:this.netODvals};return JSON.stringify(output)},from_json:function(json_data){
var parsedJson=JSON.parse(json_data);this.parent_class.from_json(JSON.stringify(parsedJson.widgetData))},test_data:function(){var testData=JSON.parse(this.parent_class.test_data()),output={widgetData:testData,netODvals:{"1A":"0","1B":5}};return JSON.stringify(output)},
is_valid:function(b_suppress_message){var fail=false,fail_log="",name;if($("#the_form").find("select, textarea, input").each((i,e)=>{if(!$(e).prop("required"));else if(!$(e).val())fail=true,name=$(e).attr("id"),fail_log+=name+" is required \n"}),$("input[type='date']").each((i,e)=>{
var date=$(e).val();if(date){var validDate=this.isValidDate(date);if(!validDate)fail=true,fail_log+="Please enter valid date in form 'YYYY-MM-DD'"}}),$("input[type='time']").each((i,e)=>{var time=$(e).val();if(time){var validtime=this.isValidTime(time);if(!validtime)fail=true,
fail_log+="Please enter valid time in form 'hh:mm' - 24 hr time"}}),fail)return bootbox.alert(fail_log);else{var noErrors=[];return noErrors}},is_edited:function(){return this.parent_class.is_edited()},reset_edited:function(){return this.parent_class.reset_edited()},
parseInitJson:function(json_data){var jsonString;if("string"===typeof json_data)jsonString=json_data;else jsonString=json_data();var parsedJson=JSON.parse(jsonString);return parsedJson},initDynamicContent:function(parsedJson){if(parsedJson.netODvals)this.netODvals=parsedJson.netODvals,
this.fillNetODVals()},adjustForMode:function(mode){if("edit"!==mode&&"edit_dev"!==mode)$(".disableOnView").prop("disabled",true),$("input[type='date']").removeClass(".hasDatePicker"),$(".hideView").hide(),$("#entryContainer").insertAfter($("#platesWrapper")),
this.toggleCard($(".plateCard[data-plate='plateID']").find(".card-header"));else $("input[type='date']").each((i,e)=>{this.checkDateFormat($(e))}),$("input[type='time']").each((i,e)=>{this.checkTimeFormat($(e))})},addEventListeners:function(){},addRequiredFieldIndicators:function(){
$(".needForTableLab").each((i,e)=>{$(e).html("<span class='hideView' style='color:blue'>#</span>"+$(e).html())}),$(".requiredLab").each((i,e)=>{$(e).html("<span class='hideView' style='color:red'>*</span>"+$(e).html())})},isValidTime:function(timeString){
var regEx="^(((([0-1][0-9])|(2[0-3])):[0-5][0-9]))$";if(!timeString.match(regEx))return false;else return true},isTimeSupported:function(){var input=document.createElement("input");input.setAttribute("type","time");var supported=true;if("time"!==input.type)supported=false
;return this.timeSupported=supported,input.remove(),supported},timeSupported:true,checkTimeFormat:function($timeInput){if(!this.timeSupported){$timeInput.next(".timeWarning").remove();var time=$timeInput.val(),isValid=this.isValidTime(time)
;if(!isValid)$timeInput.after('<div class="text-danger timeWarning">Enter time as "hh:mm" in 24-hr format</div>');this.resize()}},isValidDate:function(dateString){var regEx=/^\d{4}-\d{2}-\d{2}$/;if(!dateString.match(regEx))return false;var d=new Date(dateString),dNum=d.getTime()
;if(!dNum&&0!==dNum)return false;return d.toISOString().slice(0,10)===dateString},isDateSupported:function(){var input=document.createElement("input");input.setAttribute("type","date");var supported=true;if("date"!==input.type)supported=false;return this.dateSupported=supported,input.remove(),
supported},dateSupported:true,checkDateFormat:function($dateInput){if(!this.dateSupported){$dateInput.next(".dateWarning").remove();var date=$dateInput.val(),isValid=this.isValidDate(date);if(!isValid)$dateInput.after('<div class="text-danger dateWarning">Enter date as "YYYY-MM-DD"</div>')
;$dateInput.datepicker({dateFormat:"yy-mm-dd"}),this.resize()}},setUpInitialState:function(){$(".myLeftCol").addClass("col-12 col-sm-6 col-md-4 col-lg-3 text-left text-sm-right"),this.isDateSupported(),this.isTimeSupported(),$("input[type='date']").prop("placeholder","YYYY-MM-DD").on("change",e=>{
this.checkDateFormat($(e.currentTarget))}),$("input[type='time']").prop("placeholder","hh:mm").on("change",e=>{this.checkTimeFormat($(e.target))}),$("textarea.autoAdjust").each((i,e)=>{e.setAttribute("style","height:"+e.scrollHeight+"px;overflow-y:hidden;")}).on("input",e=>{
e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px",this.resize()}),$(".toggleTable").on("click",e=>{var tableID=$(e.currentTarget).data("table"),$table=$("#"+tableID);this.toggleTableFuncs($table)}),$(".toCSV").on("click",e=>{
var tableID=$(e.currentTarget).data("table"),dateToday=luxon.DateTime.now().toISODate(),fileName="table_"+tableID+"_"+dateToday,$errorMsg=$("#errorMsg");this.toCSVFuncs(fileName,tableID,$errorMsg)}),$(".copyPlate").on("click",e=>{
var copyHead=true,plateType=$(e.target).data("plate"),plateSearch=this.plateSearch(plateType),$tableToCopy=$(".plateImg"+plateSearch),$tableDiv=$(".plateDiv"+plateSearch),$errorMsg=$(".errorMsg"+plateSearch),$divForCopy=$(".forCopy"+plateSearch)
;this.copyDataFuncs(copyHead,$tableToCopy,$tableDiv,$errorMsg,$divForCopy)}),$("#downloadCSV").on("click",e=>{var fileName="cortPlate_"+this.buildFileName();this.exportAllTablesToCSV(fileName)}),$("#downloadMetaCSV").on("click",e=>{this.exportMetaDataCSV()}),$(".copyMouseIDs").on("click",e=>{
var $divForCopy=$("#forCopy"),listName=$(e.currentTarget).data("list"),numSamples=$(e.currentTarget).data("samples");if(!numSamples)if(numSamples=$("#samplesPerMouse").val(),!numSamples)numSamples=2;this.copyMouseIDs(listName,$divForCopy,numSamples)}),$("#idEntry2").each((i,e)=>{}).on("change",e=>{
this.fillSampleIDsFromList($(e.currentTarget))}),$(".calcTotal").on("change",e=>{this.calcNumAssignedWells()}),$("#9ptCurve").on("click",()=>{$("#numSTD").val(9),$("#largestSTD").val(500),this.checkAndUpdateWells()}),$("#7ptCurve").on("click",()=>{$("#numSTD").val(7),$("#largestSTD").val(250),
this.checkAndUpdateWells()}),$("#updateEntries").on("click",()=>{this.checkAndUpdateWells()}),$(".type").each((i,e)=>{this.adjustViewByType($(e))}).on("change",e=>{this.fillByType($(e.currentTarget))}),$("#the_form").on("input",e=>{
if($(e.target).data("watch"))this.watchValue($(e.target));else this.updateCalcFromEl(e.target)}),$("input, select, textarea").each((i,e)=>{if("button"!=$(e).attr("type"))if($(e).data("watch"))this.watchValue($(e));else this.updateCalcFromEl(e)}),$("#upload").on("click",e=>{this.upload()}),
$(".addNetODdiv").insertBefore($(".plateDiv"+this.plateSearch("netOD"))),this.resize()},resize:function(){this.parent_class.resize_container()},checkForNames:function(){$("input, select, textarea").each((i,e)=>{var thisName=$(e).attr("name")
;if(!thisName)console.log("There is no name attribute for: ",e.id);else{var hasUpper=/[A-Z]/.test(thisName);if(hasUpper)console.log("The name contains an uppercase letter for: ",e.id)}})},getDynamicContent:function(){var dynamicContent={};return dynamicContent},data_valid_form:function($errorMsg){
var valid=true,fail_log=$("<div></div>").append("Missing values for:"),name;if($(".needForTable").each((i,e)=>{if(!$(e).val())valid=false,name=$(e).attr("id"),fail_log.append("<br/>"+name)}),
!valid)$errorMsg.html("<span style='color:red; font-size:36px;'>"+"Please fill out all elements marked by a"+"</span><span style='color:blue; font-size:36px;'>"+" blue #"+"</span>"),$errorMsg.append(fail_log);else $errorMsg.html("");return this.resize(),valid},
runIfConfirmed:function(text,functionToCall,elForHeight=null){var thisMessage="Are you sure?";if(text)thisMessage=text;var top="auto";if(elForHeight)top=elForHeight.offsetTop+"px";bootbox.confirm({message:thisMessage,callback:proceed=>{if(proceed)functionToCall()}}),$(".modal-dialog").css("top",top)
},dialogConfirm:function(text,functionToCall,elForHeight=null){var thisMessage="Do you want to proceed?";if(text)thisMessage=text;var top="auto";if(elForHeight)top=elForHeight.offsetTop+"px";bootbox.confirm({message:thisMessage,callback:result=>{functionToCall(result)}}),
$(".modal-dialog").css("top",top)},runBasedOnInput:function(prompt,functionToCall,elForHeight=null){var thisTitle="Enter value:";if(prompt)thisTitle=prompt;var top="auto";if(elForHeight)top=elForHeight.offsetTop+"px";bootbox.prompt({title:thisTitle,callback:result=>{functionToCall(result)}}),
$(".modal-dialog").css("top",top)},checkInArray:function(searchVal,array){var proceed=-1!==$.inArray(searchVal,array);return proceed},dataSearch:function(dataName,dataValue){var dataSearch="[data-"+dataName+"='"+dataValue+"']";return dataSearch},tableSearch:function(table){
var tableSearch=this.dataSearch("table",table);return tableSearch},calcSearch:function(calc){var calcSearch=this.dataSearch("calc",calc);return calcSearch},watchSearch:function(watch){var watchSearch=this.dataSearch("watch",watch);return watchSearch},daySearch:function(day){
var daySearch=this.dataSearch("day",day);return daySearch},mouseSearch:function(mouse){var mouseSearch=this.dataSearch("mouse",mouse);return mouseSearch},plateSearch:function(plate){var plateSearch=this.dataSearch("plate",plate);return plateSearch},wellSearch:function(well){
var wellSearch=this.dataSearch("well",well);return wellSearch},groupSearch:function(group){var groupSearch=this.dataSearch("group",group);return groupSearch},updateCalcFromEl:function(el){var calc=el.id,val=el.value,calcSearch=this.calcSearch(calc);$(calcSearch).html(val),this.resize()},
updateCalcFromVal:function(calc,val){var calcSearch=this.calcSearch(calc);$(calcSearch).text(val),this.resize()},watchValue:function($el){var watch=$el.data("watch"),calcSearch=my_widget_script.calcSearch(watch),groupNum=$el.data("group"),mouseNum=$el.data("mouse"),val=$el.val()
;if(groupNum)calcSearch+=my_widget_script.groupSearch(groupNum);if(mouseNum)calcSearch+=my_widget_script.mouseSearch(mouseNum);if("plateID"==watch)if(!val);if($(calcSearch).html(val),groupNum&&this.checkInArray(watch,this.entryTypes)){var wellIDs=this.getWellIDsFromGroupNum(groupNum)
;this.fillWells(watch,wellIDs,val)}my_widget_script.resize()},toggleTableFuncs:function($table){this.data_valid_form(),$table.toggle(),this.resize()},toCSVFuncs:function(fileName,tableID,$errorMsg){var data_valid=this.data_valid_form($errorMsg);if(data_valid)this.exportTableToCSV(fileName,tableID),
$errorMsg.html("<span style='color:grey; font-size:24px;'>Saved successfully</span>");else $errorMsg.append("<br/><span style='color:grey; font-size:24px;'>Did not export</span>")},downloadCSV:function(csv,filename){var csvFile,downloadLink;csvFile=new Blob([csv],{type:"text/csv"}),
downloadLink=document.createElement("a"),downloadLink.download=filename,downloadLink.href=window.URL.createObjectURL(csvFile),downloadLink.style.display="none",document.body.appendChild(downloadLink),downloadLink.click()},exportTableToCSV:function(filename,table){
var tableArray=this.getTableArray($("."+table).find("table"),copyHead=true,transpose=false),tableString=this.convertRowArrayToString(tableArray,",","\n");this.downloadCSV(tableString,filename)},buildPlateID:function(){var date=$("#date").val();if(!date)date=luxon.DateTime.now().toISODate()
;var plateNum=parseInt($("#plateNumber").val()),plateLetter="a";if(plateNum>0)plateLetter=String.fromCharCode(plateNum-1+"a".charCodeAt(0));var plateID=date+plateLetter;return plateID},buildFileName:function(){
var fileName=this.buildPlateID(),initials=$("#initials").val(),kitLot=$("#kitLot").val(),cortLot=$("#cortLot").val();if(initials)fileName+="_by"+initials;if(kitLot)fileName+="_kit"+kitLot;if(cortLot)fileName+="_cort"+cortLot;return fileName},exportAllTablesToCSV:function(filename){
for(var csv=[],i=0;i<this.plateTypes.length;i++){var plateType=this.plateTypes[i],$plate=$(".plateImg"+this.plateSearch(plateType)),tableArray=this.getTableArray($plate,copyHead=true,transpose=false),tableString=this.convertRowArrayToString(tableArray,",","\n");csv.push(tableString)}
this.downloadCSV(csv.join("\n\n"),filename)},copyDataFuncs:function(copyHead=true,$tableToCopy,$tableDiv,$errorMsg,$divForCopy){var data_valid=this.data_valid_form($errorMsg),transpose=false;if(data_valid)$tableDiv.show(),this.resize(),
this.copyTable($tableToCopy,copyHead,$divForCopy,$errorMsg,transpose);else $errorMsg.append("<br/><span style='color:grey; font-size:24px;'>Nothing was copied</span>")},copyTable:function($table,copyHead,$divForCopy,$errorMsg,transpose){
var tableArray=this.getTableArray($table,copyHead,transpose),tableString=this.convertRowArrayToString(tableArray,"\t","\n");this.copyStringToClipboard(tableString,$divForCopy,$errorMsg)},getTableArray:function($table,copyHead,transpose){var rows=[],rowNum=0
;if(copyHead)$table.find("thead").children("tr").each((i,e)=>{if(transpose)rowNum=0;if($(e).find("td, th").each((i,e)=>{if(void 0===rows[rowNum])rows[rowNum]=[];if(rows[rowNum].push($(e).text()),transpose)rowNum++}),!transpose)rowNum++});return $table.find("tbody").children("tr").each((i,e)=>{
if(transpose)rowNum=0;if($(e).find("td, th").each((i,e)=>{if(void 0===rows[rowNum])rows[rowNum]=[];if(rows[rowNum].push($(e).text()),transpose)rowNum++}),!transpose)rowNum++}),rows},convertRowArrayToString:function(rowArray,cellSepString="\t",newRowString="\n"){var rowString=[]
;rowArray.forEach(row=>{if(row.length)row.forEach((cell,i)=>{if(cell.includes(cellSepString)||cell.includes(newRowString))row[i]='"'+cell+'"'}),rowString.push(row.join(cellSepString))});var tableString=rowString.join(newRowString);return tableString},
copyStringToClipboard:function(textStr,$divForCopy,$errorMsg){var $temp=$("<text"+"area style='opacity:0;'></text"+"area>");if(textStr)errorStr="Copy attempted",$errorMsg.html("<span style='color:grey; font-size:24px;'>Copy attempted</span>");else textStr=" ",
$errorMsg.html("<span style='color:red; font-size:24px;'>Nothing to copy</span>");$temp.text(textStr),$temp.appendTo($divForCopy).select(),document.execCommand("copy"),$temp.remove(),this.resize()},exportMetaDataCSV:function(){
var headers=["plateID","date","initials","kitLot","cortLot","experiment","description"],date=$("#date").val();if(!date)date=luxon.DateTime.now().toISODate()
;var vals=[this.buildPlateID(),date,$("#initials").val(),$("#kitLot").val(),$("#cortLot").val(),$("#experiment").val(),$("#description").val()],tableArray=[headers,vals],tableString=this.convertRowArrayToString(tableArray,",","\n"),fileName="cortInfo_"+this.buildFileName()
;this.downloadCSV(tableString,fileName)},toggleCard:function($cardHead){$cardHead.next().toggleClass("collapse"),$cardHead.next().find("textarea.autoAdjust").each((i,e)=>{if(!$(e).is(":hidden"))e.setAttribute("style","height:"+e.scrollHeight+"px;overflow-y:hidden;")}),this.resize()},
makeCard:function($div,cardHeadContent,cardBodyContent){$div.append($("<div></div>",{class:"card"}).append($("<button></button>",{type:"button",class:"card-header"}).on("click",e=>{this.toggleCard($(e.currentTarget))}).append(cardHeadContent)).append($("<div></div>",{class:"card-body collapse"
}).append(cardBodyContent))),this.resize()},plateTypes:["plateID","netOD","mouseID","time","type","stdPgPerWell","volPerWell","dilutionFactor"],entryTypes:["plateID","mouseID","time","type","stdPgPerWell","volPerWell","dilutionFactor"],
entryTypesNice:["Label","Mouse","Time","Sample Type","STD pg/well","mL/well","Dilution Factor"],sampleTypes:{"":{label:"blank",plateID:"",mouseID:"",time:"",stdPgPerWell:"",volPerWell:"",dilutionFactor:""},NSB:{label:"NSB",plateID:"NSB",mouseID:"",time:"",stdPgPerWell:"",volPerWell:"",
dilutionFactor:""},STD:{label:"standard",plateID:"STD",mouseID:"",time:"",volPerWell:.05,dilutionFactor:1},bufferCtrl:{label:"buffer control",plateID:"bufferCtrl",mouseID:"",time:"",stdPgPerWell:"",volPerWell:"",dilutionFactor:""},QC:{label:"quality control",plateID:"C_3",mouseID:"",time:"",
stdPgPerWell:"",volPerWell:.05,dilutionFactor:100},sample:{label:"sample",stdPgPerWell:"",volPerWell:.05,dilutionFactor:100}},wellGroups:48,cols:[1,2,3,4,5,6,7,8,9,10,11,12],rows:["A","B","C","D","E","F","G","H"],row1:["A","C","E","G"],row2:["B","D","F","H"],sampleTimes:[],makePlates:function(){
var $platesDiv=$("#platesWrapper");$platesDiv.html("");for(var i=0;i<this.plateTypes.length;i++){var plateType=this.plateTypes[i],$div=this.makePlateDiv(plateType,i+1);$platesDiv.append($div);var $table=this.makePlateTable(plateType),plateSearch=this.plateSearch(plateType)
;$(".plateDiv"+plateSearch).append($table)}},makePlateDiv:function(plateType,plateNum){var $header="<h3>"+plateType+"</h3>",$body=$("<div></div>",{class:"container mt-4 plateContainer","data-plate":plateType}).append($("<div></div>",{class:"row mt-2"}).append($("<div></div>",{
class:"col-12 col-sm-6 col-md-3"}).append($("<input></input>",{type:"button",class:"copyPlate fullWidth","data-plate":plateType,value:"COPY PLATE",name:"copyplate"+plateNum})))).append($("<div></div>",{class:"row mt-2"}).append($("<div></div>",{class:"col-12 errorMsg","data-plate":plateType
})).append($("<div></div>",{class:"col-12 forCopy","data-plate":plateType}))).append($("<div></div>",{class:"mt-2 table-responsive xsTableDiv plateDiv","data-plate":plateType})),$div=$("<div></div>",{class:"plateCard","data-plate":plateType});return this.makeCard($div,$header,$body),$div},
makePlateTable:function(plateType){var $table=$("<table></table>",{class:"table plateImg","data-plate":plateType});$table.append($("<tr></tr>",{class:"row0"}))
;for(var $tableRow=$table.find(".row0"),col=0;col<13;col++)if(0==col)$tableRow.append($("<th></th>").append(plateType));else $tableRow.append($("<th></th>",{class:"col"+col}).append(col));for(var rowLetters=["","A","B","C","D","E","F","G","H"],rowPairs1=[1,2,5,6],shading,row=1;row<9;row++){
$table.append($("<tr></tr>",{class:"row"+rowLetters[row]})),$tableRow=$table.find(".row"+rowLetters[row]);for(var col=0;col<13;col++){if(this.isEven(col))if(rowPairs1.includes(row))shading="light";else shading="dark";else if(rowPairs1.includes(row))shading="dark";else shading="light"
;if(0==col)$tableRow.append($("<th></th>",{class:"row"+rowLetters[row]}).append(rowLetters[row]));else $tableRow.append($("<td/>",{class:"col"+col+" row"+rowLetters[row]+" well "+shading,"data-well":col+rowLetters[row]}))}}return $table},isEven:function(value){
if(value%2==0)return true;else return false},makeWellEntries:function(){for($("#entryWrapper").html(""),i=0;i<this.wellGroups;i++){var wellGroup=i+1,$cardDiv=this.makeWellEntry(wellGroup);$("#entryWrapper").append($cardDiv)}},makeWellEntry:function(wellGroup){for(var $div=$("<div></div>",{
class:"col-6 col-md-4 col-lg-3 col-xl-2","data-group":wellGroup}),$header=wellGroup+". <span data-group='"+wellGroup+"' data-calc='plateID'>Sample "+wellGroup+"</span>",inputTypes=this.entryTypes,$body=$("<div></div>",{class:"container"}),i=0;i<inputTypes.length;i++){
var inputType=inputTypes[i],inputObject={class:"fullWidth watch "+inputType,id:inputType+wellGroup,name:inputType.toLowerCase()+wellGroup,"data-group":wellGroup,"data-watch":inputType},$input;if("type"===inputType)for(type in $input=$("<select></select>",inputObject),
this.sampleTypes)$input.append($("<option></option>",{value:type}).append(this.sampleTypes[type]["label"]));else{if("mouseID"===inputType||"plateID"===inputType)inputObject.type="text";else inputObject.type="number";$input=$("<input></input>",inputObject)}$body.append($("<div></div>",{class:"row",
"data-entry":inputType,"data-group":wellGroup}).append($("<div></div>",{class:"col-12 font-weight-bold"}).append(this.entryTypesNice[i])).append($("<div></div>",{class:"col"}).append($input)))}return this.makeCard($div,$header,$body),$div},getWellIDsFromGroupNum:function(wellGroup){var well1,well2
;if(wellGroup>0&&wellGroup<=48){var colIndex=Math.ceil(wellGroup/4)-1,col=this.cols[colIndex],remainder=(wellGroup-1)%4,row1=this.row1[remainder],row2=this.row2[remainder];well1=col+row1,well2=col+row2}var wells={well1:well1,well2:well2};return wells},fillWells:function(plateType,wells,val){
var plateSearch=this.plateSearch(plateType),well1Search=this.wellSearch(wells.well1),well2Search=this.wellSearch(wells.well2);$(".plateImg"+plateSearch).find(".well"+well1Search).text(val),$(".plateImg"+plateSearch).find(".well"+well2Search).text(val),this.resize()},
adjustViewByType:function($sampleType){var type=$sampleType.val(),infoObj=this.sampleTypes[type],wellGroup=$sampleType.data("group"),groupSearch=this.groupSearch(wellGroup),wellIDs=this.getWellIDsFromGroupNum(wellGroup);for(info in $(groupSearch+"[data-entry]").show(),infoObj)if("label"!==info){
var watchSearch=this.watchSearch(info),entrySearch=this.dataSearch("entry",info),val=infoObj[info];if(!val)$(groupSearch+entrySearch).hide()}this.resize()},fillByType:function($sampleType){
var type=$sampleType.val(),infoObj=this.sampleTypes[type],wellGroup=$sampleType.data("group"),groupSearch=this.groupSearch(wellGroup),wellIDs=this.getWellIDsFromGroupNum(wellGroup);for(info in $(groupSearch+"[data-entry]").show(),infoObj)if("label"!==info){
var watchSearch=this.watchSearch(info),entrySearch=this.dataSearch("entry",info),val=infoObj[info];if("STD"===val){var currentVal=$(watchSearch+groupSearch).val();if(currentVal.startsWith("STD"))val=currentVal}if($(watchSearch+groupSearch).val(val),
"plateID"===info)$(groupSearch+this.calcSearch("plateID")).text(val);if(this.fillWells(info,wellIDs,val),!val)$(groupSearch+entrySearch).hide()}this.resize()},calcNumAssignedWells:function(){var total=0;if($(".calcTotal").each((i,e)=>{if(e.value)total+=parseInt(e.value)}),
this.updateCalcFromVal("totalWellGroups",total),total>48)return $(this.calcSearch("totalWellGroups")).css("color","red"),$("#numWarning").text("You have entered too many samples to fit on the plate"),false;else return $(this.calcSearch("totalWellGroups")).css("color","black"),
$("#numWarning").text(""),true},checkAndUpdateWells:function(){var numNSB=$("#numNSB").val(),numSTD=$("#numSTD").val(),numBuffer=$("#numBuffer").val(),numQC=$("#numQC").val(),numSamples=$("#numSamples").val()
;if(this.calcNumAssignedWells())this.updateEntryWells(numNSB,numSTD,numBuffer,numQC,numSamples);else $("#numWarning").text("Did not update; too many samples");this.resize()},firstSampleGroup:0,updateEntryWells:function(numNSB,numSTD,numBuffer,numQC,numSamples){for(var i=0;i<this.wellGroups;i++){
var wellGroup=i+1,groupSearch=this.groupSearch(wellGroup),type;if(numNSB>0)type="NSB",numNSB--;else if(numSTD>0)type="STD",numSTD--;else if(numBuffer>0)type="bufferCtrl",numBuffer--;else if(numQC>0)type="QC",numQC--;else if(numSamples>0){if(type="sample",numSamples--,
0===this.firstSampleGroup)this.firstSampleGroup=wellGroup;else if(wellGroup<this.firstSampleGroup)this.firstSampleGroup=wellGroup}else type="";$(".type"+groupSearch).val(type);var wellIDs=this.getWellIDsFromGroupNum(wellGroup);this.fillWells("type",wellIDs,type)}this.updateSTDVals(),
$(".type").each((i,e)=>{this.fillByType($(e))}),this.resize()},updateSTDVals:function(){var stdVal=$("#largestSTD").val();stdVal=parseFloat(stdVal);var stdNum=0;$(".type").each((i,e)=>{if("STD"===$(e).val()){stdNum++;var wellGroup=$(e).data("group"),wellGroupSearch=this.groupSearch(wellGroup)
;$(".plateID"+wellGroupSearch).val("STD "+stdNum),$(".stdPgPerWell"+wellGroupSearch).val(stdVal);var wellIDs=this.getWellIDsFromGroupNum(wellGroup);this.fillWells("plateID",wellIDs,"STD "+stdNum),this.fillWells("stdPgPerWell",wellIDs,stdVal),stdVal/=2}}),this.resize()},
copyMouseIDs:function(listName,$divForCopy,numCopies){for(var $temp=$("<text"+"area style='opacity:0;'></text"+"area>"),addLine="",fullList=$("#"+listName).val(),splitList=fullList.split(/[\r\n]+/),addText,newList=[],i=0;i<splitList.length;i++){mouseID=splitList[i]
;for(var j=0;j<numCopies;j++)newList.push(mouseID)}$temp.text(newList.join("\n")),$temp.appendTo($divForCopy).select(),document.execCommand("copy"),$temp.remove()},fillSampleIDsFromList:function($list){
var fullList=$list.val(),splitList=fullList.split(/[\r\n]+/),currentNumSamples=$("#numSamples").val(),listLength=splitList.length;if($("#numSamples").val(listLength),!this.calcNumAssignedWells())return $("#numWarning").text("You've entered too many mice"),$("#numSamples").val(currentNumSamples),
void 0;this.checkAndUpdateWells();for(var firstSample=this.firstSampleGroup,wellGroup,wellGroupSearch,mouseID,lastMouseID,lastWellGroupSearch,lastWellIDs,isLastDup=false,numDups=1,i=0;i<listLength;i++){wellGroup=firstSample+i,wellGroupSearch=this.groupSearch(wellGroup)
;var wellIDs=this.getWellIDsFromGroupNum(wellGroup);mouseID=splitList[i];var thisID=mouseID,time=0;if(mouseID===lastMouseID){if(!isLastDup)$(".plateID"+lastWellGroupSearch).val(lastMouseID+" pre"),$(lastWellGroupSearch+this.calcSearch("plateID")).text(lastMouseID+" pre"),
this.fillWells("plateID",lastWellIDs,lastMouseID+" pre");time=NaN,isLastDup=true,numDups++,thisID=mouseID}else{if(isLastDup=false,2==numDups)$(".plateID"+lastWellGroupSearch).val(lastMouseID+" post"),$(lastWellGroupSearch+this.calcSearch("plateID")).text(lastMouseID+" post"),
this.fillWells("plateID",lastWellIDs,lastMouseID+" post"),$(".time"+lastWellGroupSearch).val(5),this.fillWells("time",lastWellIDs,5);numDups=1}$(".plateID"+wellGroupSearch).val(thisID),$(wellGroupSearch+this.calcSearch("plateID")).text(thisID),this.fillWells("plateID",wellIDs,thisID),
$(".mouseID"+wellGroupSearch).val(mouseID),this.fillWells("mouseID",wellIDs,mouseID),$(".time"+wellGroupSearch).val(time),this.fillWells("time",wellIDs,time),lastMouseID=mouseID,lastWellGroupSearch=wellGroupSearch,lastWellIDs=wellIDs}
if(2==numDups)$(".plateID"+lastWellGroupSearch).val(lastMouseID+" post"),$(lastWellGroupSearch+this.calcSearch("plateID")).text(lastMouseID+" post"),this.fillWells("plateID",lastWellIDs,lastMouseID+" post"),$(".time"+lastWellGroupSearch).val(5),this.fillWells("time",lastWellIDs,5);this.resize()},
fillSampleIDsFromList_old:function($list){var fullList=$list.val(),splitList=fullList.split(/[\r\n]+/),currentNumSamples=$("#numSamples").val(),listLength=splitList.length;if($("#numSamples").val(listLength),!this.calcNumAssignedWells())return $("#numWarning").text("You've entered too many mice"),
$("#numSamples").val(currentNumSamples),void 0;this.checkAndUpdateWells();for(var firstSample=this.firstSampleGroup,wellGroup,wellGroupSearch,mouseID,lastMouseID,lastWellGroupSearch,lastWellIDs,isLastDup=false,i=0;i<listLength;i++){wellGroup=firstSample+i,wellGroupSearch=this.groupSearch(wellGroup)
;var wellIDs=this.getWellIDsFromGroupNum(wellGroup);mouseID=splitList[i];var thisID=mouseID,time=0;if(mouseID===lastMouseID&&!isLastDup)$(".plateID"+lastWellGroupSearch).val(lastMouseID+" pre"),$(lastWellGroupSearch+this.calcSearch("plateID")).text(lastMouseID+" pre"),
this.fillWells("plateID",lastWellIDs,lastMouseID+" pre"),thisID=mouseID+" post",time=5,isLastDup=true;else isLastDup=false;$(".plateID"+wellGroupSearch).val(thisID),$(wellGroupSearch+this.calcSearch("plateID")).text(thisID),this.fillWells("plateID",wellIDs,thisID),
$(".mouseID"+wellGroupSearch).val(mouseID),this.fillWells("mouseID",wellIDs,mouseID),$(".time"+wellGroupSearch).val(time),this.fillWells("time",wellIDs,time),lastMouseID=mouseID,lastWellGroupSearch=wellGroupSearch,lastWellIDs=wellIDs}this.resize()},
rebuildTableFromStr:function(textStr,makeFirstRowHead,makeFirstColHead,$tableDiv){var rowArray=this.makeArrayFromStr(textStr);if(this.addedTable=textStr,
void 0===$tableDiv||!$tableDiv)this.createTable(rowArray,makeFirstRowHead,makeFirstColHead);else this.createTable(rowArray,makeFirstRowHead,makeFirstColHead,$tableDiv);this.resize()},makeArrayFromStr:function(textStr){var results=Papa.parse(textStr,{skipEmptyLines:true});return results.data},
preview:function(){var fileUpload=document.getElementById("fileUpload"),regex=/^([a-zA-Z0-9\s_\\.\-:])+(.csv|.txt)$/;if(regex.test(fileUpload.value.toLowerCase()))if("undefined"!=typeof FileReader){var reader=new FileReader;reader.onload=(e=>{
var csvText=e.target.result,makeFirstColHead=false,makeFirstRowHead=false,$divForTable=$(".forTable");this.rebuildTableFromStr(csvText,makeFirstRowHead,makeFirstColHead,$divForTable)}),reader.readAsText(fileUpload.files[0])
}else bootbox.alert("This browser does not support HTML5.");else bootbox.alert("Please upload a valid CSV file.")},netODvals:{},upload:function(){var tableStr=$("#pasteField").val();if(tableStr){this.netODvals={};var plate=Papa.parse(tableStr,{skipEmptyLines:true,header:false
}),plateData=plate.data,rowLetter,colNum;plateData.forEach((row,i)=>{rowLetter=String.fromCharCode(i+"A".charCodeAt(0)),row.forEach((col,i)=>{colNum=i+1,wellID=colNum+rowLetter,this.netODvals[wellID]=col})}),this.fillNetODVals()
}else bootbox.alert("Please either make an HTML table after pasting from Excel or preview a CSV file first")},fillNetODVals:function(){var $netODPlate=$(".plateImg"+this.plateSearch("netOD"));for(well in $netODPlate.find("td").text(""),
this.netODvals)$netODPlate.find(".well"+this.wellSearch(well)).text(this.netODvals[well]);this.resize()},createTable:function(tableData,makeFirstRowHead=false,makeFirstColHead=false,$tableDiv){var table=document.createElement("table");table.classList.add("table")
;var tableBody=document.createElement("tbody");if(makeFirstRowHead)var thead=document.createElement("thead");if(tableData.forEach((rowData,rowNum)=>{var row=document.createElement("tr");if(rowData.forEach((cellData,colNum)=>{
if(makeFirstRowHead&&0==rowNum||makeFirstColHead&&0==colNum)var cell=document.createElement("th");else var cell=document.createElement("td");cell.appendChild(document.createTextNode(cellData)),row.appendChild(cell)}),makeFirstRowHead&&0==rowNum)thead.appendChild(row),
table.appendChild(thead);else tableBody.appendChild(row)}),table.appendChild(tableBody),void 0===$tableDiv||!$tableDiv)console.log("appending generally"),document.body.appendChild(table);else $tableDiv.html(""),$tableDiv.append(table);this.resize()}};